(window.webpackJsonp=window.webpackJsonp||[]).push([[189],{720:function(e,a,t){"use strict";t.r(a);var o=t(1),s=Object(o.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"chain-upgrade-guide-to-v0-44"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chain-upgrade-guide-to-v0-44"}},[e._v("#")]),e._v(" Chain Upgrade Guide to v0.44")]),e._v(" "),t("p",{attrs:{synopsis:""}},[e._v("This document provides guidelines for a chain upgrade from v0.42 to v0.44 and an example of the upgrade process using "),t("code",[e._v("simapp")]),e._v(".")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",[e._v("You must upgrade to Stargate v0.42 before upgrading to v0.44. If you have not done so, please see "),t("RouterLink",{attrs:{to:"/v0.42/migrations/chain-upgrade-guide-040.html"}},[e._v("Chain Upgrade Guide to v0.42")]),e._v(". Please note, v0.43 was discontinued shortly after being released and all chains should upgrade directly to v0.44 from v0.42.")],1)]),e._v(" "),t("h2",{attrs:{id:"prerequisite-readings"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prerequisite-readings"}},[e._v("#")]),e._v(" Prerequisite Readings")]),e._v(" "),t("ul",[t("li",{attrs:{prereq:""}},[t("RouterLink",{attrs:{to:"/building-modules/upgrade.html"}},[e._v("Upgrading Modules")])],1),e._v(" "),t("li",{attrs:{prereq:""}},[t("RouterLink",{attrs:{to:"/core/upgrade.html"}},[e._v("In-Place Store Migrations")])],1),e._v(" "),t("li",{attrs:{prereq:""}},[t("RouterLink",{attrs:{to:"/run-node/cosmovisor.html"}},[e._v("Cosmovisor")])],1)]),e._v(" "),t("p",[e._v("Cosmos SDK v0.44 introduces a new way of handling chain upgrades that no longer requires exporting state to JSON, making the necessary changes, and then creating a new chain with the modified JSON as the new genesis file.")]),e._v(" "),t("p",[e._v("The IBC module for the Cosmos SDK has moved to its "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go",target:"_blank",rel:"noopener noreferrer"}},[e._v("own repository"),t("OutboundLink")],1),e._v(" for v0.42 and later versions. If you are using IBC, make sure to also go through the "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/docs/migrations/ibc-migration-043.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("IBC migration docs"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("Instead of starting a new chain, the upgrade binary will read the existing database and perform in-place store migrations. This new way of handling chain upgrades can be used alongside "),t("RouterLink",{attrs:{to:"/run-node/cosmovisor.html"}},[e._v("Cosmovisor")]),e._v(" to make the upgrade process seamless.")],1),e._v(" "),t("h2",{attrs:{id:"in-place-store-migrations"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#in-place-store-migrations"}},[e._v("#")]),e._v(" In-Place Store Migrations")]),e._v(" "),t("p",[e._v("We recommend using "),t("RouterLink",{attrs:{to:"/core/upgrade.html"}},[e._v("In-Place Store Migrations")]),e._v(" to upgrade your chain from v0.42 to v0.44. The first step is to make sure all your modules follow the "),t("RouterLink",{attrs:{to:"/building-modules/upgrade.html"}},[e._v("Module Upgrade Guide")]),e._v(". The second step is to add an "),t("RouterLink",{attrs:{to:"/core/upgrade.html#running-migrations"}},[e._v("upgrade handler")]),e._v(" to "),t("code",[e._v("app.go")]),e._v(".")],1),e._v(" "),t("p",[e._v("In this document, we'll provide an example of what the upgrade handler looks like for a chain upgrading module versions for the first time. It's critical to note that the initial version of each module must be set to "),t("code",[e._v("1")]),e._v(" rather than "),t("code",[e._v("0")]),e._v(" or else the upgrade handler will re-initialize each module.")]),e._v(" "),t("p",[e._v("In addition to migrating existing modules, the upgrade handler also performs store upgrades for new modules. In the example below, we'll be adding store migrations for two new modules made available in v0.44: "),t("code",[e._v("x/authz")]),e._v(" and "),t("code",[e._v("x/feegrant")]),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"using-cosmovisor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#using-cosmovisor"}},[e._v("#")]),e._v(" Using Cosmovisor")]),e._v(" "),t("p",[e._v("We recommend validators use "),t("RouterLink",{attrs:{to:"/run-node/cosmovisor.html"}},[e._v("Cosmovisor")]),e._v(", which is a process manager for running application binaries. For security reasons, we recommend validators build their own upgrade binaries rather than enabling the auto-download option. Validators may still choose to use the auto-download option if the necessary security guarantees are in place (i.e. the URL provided in the upgrade proposal for the downloadable upgrade binary includes a proper checksum).")],1),e._v(" "),t("p",[e._v("Validators can use the auto-restart option to prevent unecessary downtime during the upgrade process. The auto-restart option will automatically restart the chain with the upgrade binary once the chain has halted at the proposed upgrade height. With the auto-restart option, validators can prepare the upgrade binary in advance and then relax at the time of the upgrade.")]),e._v(" "),t("h2",{attrs:{id:"migrating-app-toml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#migrating-app-toml"}},[e._v("#")]),e._v(" Migrating app.toml")]),e._v(" "),t("p",[e._v("With the update to "),t("code",[e._v("v0.44")]),e._v(", new server configuration options have been added to "),t("code",[e._v("app.toml")]),e._v(". The updates include new configuration sections for Rosetta and gRPC Web as well as a new configuration option for State Sync. Check out the default "),t("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/release/v0.44.x/server/config/toml.go",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("app.toml")]),t("OutboundLink")],1),e._v(" file in the latest version of "),t("code",[e._v("v0.44")]),e._v(" for more information.")]),e._v(" "),t("h2",{attrs:{id:"example-simapp-upgrade"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-simapp-upgrade"}},[e._v("#")]),e._v(" Example: Simapp Upgrade")]),e._v(" "),t("p",[e._v("The following example will walk through the upgrade process using "),t("code",[e._v("simapp")]),e._v(" as our blockchain application. We will be upgrading "),t("code",[e._v("simapp")]),e._v(" from v0.42 to v0.44. We will be building the upgrade binary ourselves and enabling the auto-restart option.")]),e._v(" "),t("p",[t("em",[e._v("Note: In this example, we will be starting a new chain from "),t("code",[e._v("v0.42")]),e._v(". The binary for this version will be the genesis binary. For validators using Cosmovisor for the first time, the binary for the current version of the chain should be used as the genesis binary (i.e. the starting binary). For more information, see "),t("RouterLink",{attrs:{to:"/run-node/cosmovisor.html"}},[e._v("Cosmovisor")]),e._v(".")],1)]),e._v(" "),t("h3",{attrs:{id:"initial-setup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#initial-setup"}},[e._v("#")]),e._v(" Initial Setup")]),e._v(" "),t("p",[e._v("From within the "),t("code",[e._v("cosmos-sdk")]),e._v(" repository, check out the latest "),t("code",[e._v("v0.42.x")]),e._v(" release:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Z2l0IGNoZWNrb3V0IHJlbGVhc2UvdjAuNDIueAo="}}),e._v(" "),t("p",[e._v("Build the "),t("code",[e._v("simd")]),e._v(" binary for the latest "),t("code",[e._v("v0.42.x")]),e._v(" release (the genesis binary):")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"bWFrZSBidWlsZAo="}}),e._v(" "),t("p",[e._v("Reset "),t("code",[e._v("~/.simapp")]),e._v(" (never do this in a production environment):")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Li9idWlsZC9zaW1kIHVuc2FmZS1yZXNldC1hbGwK"}}),e._v(" "),t("p",[e._v("Configure the "),t("code",[e._v("simd")]),e._v(" binary for testing:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Li9idWlsZC9zaW1kIGNvbmZpZyBjaGFpbi1pZCB0ZXN0Ci4vYnVpbGQvc2ltZCBjb25maWcga2V5cmluZy1iYWNrZW5kIHRlc3QKLi9idWlsZC9zaW1kIGNvbmZpZyBicm9hZGNhc3QtbW9kZSBibG9jawo="}}),e._v(" "),t("p",[e._v("Initialize the node and overwrite any previous genesis file (never do this in a production environment):")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Li9idWlsZC9zaW1kIGluaXQgdGVzdCAtLWNoYWluLWlkIHRlc3QgLS1vdmVyd3JpdGUK"}}),e._v(" "),t("p",[e._v("Set the minimum gas price to "),t("code",[e._v("0stake")]),e._v(" in "),t("code",[e._v("~/.simapp/config/app.toml")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"bWluaW11bS1nYXMtcHJpY2VzID0gJnF1b3Q7MHN0YWtlJnF1b3Q7Cg=="}}),e._v(" "),t("p",[e._v("For the purpose of this demonstration, change "),t("code",[e._v("voting_period")]),e._v(" in "),t("code",[e._v("genesis.json")]),e._v(" to a reduced time of 20 seconds ("),t("code",[e._v("20s")]),e._v("):")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Y2F0ICZsdDsmbHQ7Jmx0OyAkKGpxICcuYXBwX3N0YXRlLmdvdi52b3RpbmdfcGFyYW1zLnZvdGluZ19wZXJpb2QgPSAmcXVvdDsyMHMmcXVvdDsnICRIT01FLy5zaW1hcHAvY29uZmlnL2dlbmVzaXMuanNvbikgJmd0OyAkSE9NRS8uc2ltYXBwL2NvbmZpZy9nZW5lc2lzLmpzb24K"}}),e._v(" "),t("p",[e._v("Create a new key for the validator, then add a genesis account and transaction:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Li9idWlsZC9zaW1kIGtleXMgYWRkIHZhbGlkYXRvcgouL2J1aWxkL3NpbWQgYWRkLWdlbmVzaXMtYWNjb3VudCB2YWxpZGF0b3IgNTAwMDAwMDAwMHN0YWtlIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QKLi9idWlsZC9zaW1kIGdlbnR4IHZhbGlkYXRvciAxMDAwMDAwc3Rha2UgLS1jaGFpbi1pZCB0ZXN0Ci4vYnVpbGQvc2ltZCBjb2xsZWN0LWdlbnR4cwo="}}),e._v(" "),t("p",[e._v("Now that our node is initialized and we are ready to start a new "),t("code",[e._v("simapp")]),e._v(" chain, let's set up "),t("code",[e._v("cosmovisor")]),e._v(" and the genesis binary.")]),e._v(" "),t("h3",{attrs:{id:"cosmovisor-setup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cosmovisor-setup"}},[e._v("#")]),e._v(" Cosmovisor Setup")]),e._v(" "),t("p",[e._v("First, install or update "),t("code",[e._v("cosmovisor")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Z28gZ2V0IGdpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsvY29zbW92aXNvci9jbWQvY29zbW92aXNvcgo="}}),e._v(" "),t("p",[e._v("Set the required environment variables:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ZXhwb3J0IERBRU1PTl9OQU1FPXNpbWQKZXhwb3J0IERBRU1PTl9IT01FPSRIT01FLy5zaW1hcHAK"}}),e._v(" "),t("p",[e._v("Set the optional environment variable to trigger an automatic restart:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ZXhwb3J0IERBRU1PTl9SRVNUQVJUX0FGVEVSX1VQR1JBREU9dHJ1ZQo="}}),e._v(" "),t("p",[e._v("Create the folder for the genesis binary and copy the "),t("code",[e._v("v0.42.x")]),e._v(" binary:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"bWtkaXIgLXAgJERBRU1PTl9IT01FL2Nvc21vdmlzb3IvZ2VuZXNpcy9iaW4KY3AgLi9idWlsZC9zaW1kICREQUVNT05fSE9NRS9jb3Ntb3Zpc29yL2dlbmVzaXMvYmluCg=="}}),e._v(" "),t("p",[e._v("Now that "),t("code",[e._v("cosmovisor")]),e._v(" is installed and the genesis binary has been added, let's add the upgrade handler to "),t("code",[e._v("simapp/app.go")]),e._v(" and prepare the upgrade binary.")]),e._v(" "),t("h3",{attrs:{id:"chain-upgrade"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chain-upgrade"}},[e._v("#")]),e._v(" Chain Upgrade")]),e._v(" "),t("p",[e._v("Check out "),t("code",[e._v("release/v0.44.x")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Z2l0IGNoZWNrb3V0IHJlbGVhc2UvdjAuNDQueAo="}}),e._v(" "),t("p",[e._v("Add the following to "),t("code",[e._v("simapp/app.go")]),e._v(" inside "),t("code",[e._v("NewSimApp")]),e._v(" and after "),t("code",[e._v("app.UpgradeKeeper")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"CWFwcC5yZWdpc3RlclVwZ3JhZGVIYW5kbGVycygpCg=="}}),e._v(" "),t("p",[e._v("Add the following to "),t("code",[e._v("simapp/app.go")]),e._v(" after "),t("code",[e._v("NewSimApp")]),e._v(" (to learn more about the upgrade handler, see the "),t("RouterLink",{attrs:{to:"/core/upgrade.html"}},[e._v("In-Place Store Migrations")]),e._v("):")],1),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoYXBwICpTaW1BcHApIHJlZ2lzdGVyVXBncmFkZUhhbmRsZXJzKCkgewoJYXBwLlVwZ3JhZGVLZWVwZXIuU2V0VXBncmFkZUhhbmRsZXIoJnF1b3Q7djAuNDQmcXVvdDssIGZ1bmMoY3R4IHNkay5Db250ZXh0LCBwbGFuIHVwZ3JhZGV0eXBlcy5QbGFuLCBfIG1vZHVsZS5WZXJzaW9uTWFwKSAobW9kdWxlLlZlcnNpb25NYXAsIGVycm9yKSB7CgkJLy8gMXN0LXRpbWUgcnVubmluZyBpbi1zdG9yZSBtaWdyYXRpb25zLCB1c2luZyAxIGFzIGZyb21WZXJzaW9uIHRvCgkJLy8gYXZvaWQgcnVubmluZyBJbml0R2VuZXNpcy4KCQlmcm9tVk0gOj0gbWFwW3N0cmluZ111aW50NjR7CgkJCSZxdW90O2F1dGgmcXVvdDs6ICAgICAgICAgMSwKCQkJJnF1b3Q7YmFuayZxdW90OzogICAgICAgICAxLAoJCQkmcXVvdDtjYXBhYmlsaXR5JnF1b3Q7OiAgIDEsCgkJCSZxdW90O2NyaXNpcyZxdW90OzogICAgICAgMSwKCQkJJnF1b3Q7ZGlzdHJpYnV0aW9uJnF1b3Q7OiAxLAoJCQkmcXVvdDtldmlkZW5jZSZxdW90OzogICAgIDEsCgkJCSZxdW90O2dvdiZxdW90OzogICAgICAgICAgMSwKCQkJJnF1b3Q7bWludCZxdW90OzogICAgICAgICAxLAoJCQkmcXVvdDtwYXJhbXMmcXVvdDs6ICAgICAgIDEsCgkJCSZxdW90O3NsYXNoaW5nJnF1b3Q7OiAgICAgMSwKCQkJJnF1b3Q7c3Rha2luZyZxdW90OzogICAgICAxLAoJCQkmcXVvdDt1cGdyYWRlJnF1b3Q7OiAgICAgIDEsCgkJCSZxdW90O3Zlc3RpbmcmcXVvdDs6ICAgICAgMSwKCQkJJnF1b3Q7aWJjJnF1b3Q7OiAgICAgICAgICAxLAoJCQkmcXVvdDtnZW51dGlsJnF1b3Q7OiAgICAgIDEsCgkJCSZxdW90O3RyYW5zZmVyJnF1b3Q7OiAgICAgMSwKCQl9CgoJCXJldHVybiBhcHAubW0uUnVuTWlncmF0aW9ucyhjdHgsIGFwcC5jb25maWd1cmF0b3IsIGZyb21WTSkKCX0pCgoJdXBncmFkZUluZm8sIGVyciA6PSBhcHAuVXBncmFkZUtlZXBlci5SZWFkVXBncmFkZUluZm9Gcm9tRGlzaygpCglpZiBlcnIgIT0gbmlsIHsKCQlwYW5pYyhlcnIpCgl9CgoJaWYgdXBncmFkZUluZm8uTmFtZSA9PSAmcXVvdDt2MC40NCZxdW90OyAmYW1wOyZhbXA7ICFhcHAuVXBncmFkZUtlZXBlci5Jc1NraXBIZWlnaHQodXBncmFkZUluZm8uSGVpZ2h0KSB7CgkJc3RvcmVVcGdyYWRlcyA6PSBzdG9yZXR5cGVzLlN0b3JlVXBncmFkZXN7CgkJCUFkZGVkOiBbXXN0cmluZ3smcXVvdDthdXRoeiZxdW90OywgJnF1b3Q7ZmVlZ3JhbnQmcXVvdDt9LAoJCX0KCgkJLy8gY29uZmlndXJlIHN0b3JlIGxvYWRlciB0aGF0IGNoZWNrcyBpZiB2ZXJzaW9uID09IHVwZ3JhZGVIZWlnaHQgYW5kIGFwcGxpZXMgc3RvcmUgdXBncmFkZXMKCQlhcHAuU2V0U3RvcmVMb2FkZXIodXBncmFkZXR5cGVzLlVwZ3JhZGVTdG9yZUxvYWRlcih1cGdyYWRlSW5mby5IZWlnaHQsICZhbXA7c3RvcmVVcGdyYWRlcykpCgl9Cn0K"}}),e._v(" "),t("p",[e._v("Add "),t("code",[e._v("storetypes")]),e._v(" to imports:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"CXN0b3JldHlwZXMgJnF1b3Q7Z2l0aHViLmNvbS9jb3Ntb3MvY29zbW9zLXNkay9zdG9yZS90eXBlcyZxdW90Owo="}}),e._v(" "),t("p",[e._v("Build the "),t("code",[e._v("simd")]),e._v(" binary for "),t("code",[e._v("v0.44.x")]),e._v(" (the upgrade binary):")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"bWFrZSBidWlsZAo="}}),e._v(" "),t("p",[e._v("Create the folder for the upgrade binary and copy the "),t("code",[e._v("v0.44.x")]),e._v(" binary:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"bWtkaXIgLXAgJERBRU1PTl9IT01FL2Nvc21vdmlzb3IvdXBncmFkZXMvdjAuNDQvYmluCmNwIC4vYnVpbGQvc2ltZCAkREFFTU9OX0hPTUUvY29zbW92aXNvci91cGdyYWRlcy92MC40NC9iaW4K"}}),e._v(" "),t("p",[e._v("Now that we have added the upgrade handler and prepared the upgrade binary, we are ready to start "),t("code",[e._v("cosmovisor")]),e._v(" and simulate the upgrade proposal process.")]),e._v(" "),t("h3",{attrs:{id:"upgrade-proposal"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#upgrade-proposal"}},[e._v("#")]),e._v(" Upgrade Proposal")]),e._v(" "),t("p",[e._v("Start the node using "),t("code",[e._v("cosmovisor")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Y29zbW92aXNvciBzdGFydAo="}}),e._v(" "),t("p",[e._v("Open a new terminal window and submit an upgrade proposal along with a deposit and a vote (these commands must be run within 20 seconds of each other):")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Li9idWlsZC9zaW1kIHR4IGdvdiBzdWJtaXQtcHJvcG9zYWwgc29mdHdhcmUtdXBncmFkZSB2MC40NCAtLXRpdGxlIHVwZ3JhZGUgLS1kZXNjcmlwdGlvbiB1cGdyYWRlIC0tdXBncmFkZS1oZWlnaHQgMjAgLS1mcm9tIHZhbGlkYXRvciAtLXllcwouL2J1aWxkL3NpbWQgdHggZ292IGRlcG9zaXQgMSAxMDAwMDAwMHN0YWtlIC0tZnJvbSB2YWxpZGF0b3IgLS15ZXMKLi9idWlsZC9zaW1kIHR4IGdvdiB2b3RlIDEgeWVzIC0tZnJvbSB2YWxpZGF0b3IgLS15ZXMK"}}),e._v(" "),t("p",[e._v("Confirm the chain automatically upgrades at height 20.")])],1)}),[],!1,null,null,null);a.default=s.exports}}]);