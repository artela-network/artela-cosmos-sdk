<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-core/baseapp">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">BaseApp | Cosmos SDK</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.cosmos.network/img/banner.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.cosmos.network/img/banner.jpg"><meta data-rh="true" property="og:url" content="https://docs.cosmos.network/main/core/baseapp"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="BaseApp | Cosmos SDK"><meta data-rh="true" name="description" content="This document describes BaseApp, the abstraction that implements the core functionalities of a Cosmos SDK application."><meta data-rh="true" property="og:description" content="This document describes BaseApp, the abstraction that implements the core functionalities of a Cosmos SDK application."><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://docs.cosmos.network/main/core/baseapp"><link data-rh="true" rel="alternate" href="https://docs.cosmos.network/main/core/baseapp" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.cosmos.network/main/core/baseapp" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QLS2QSP47E-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Cosmos SDK" href="/opensearch.xml">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51029217-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.e98ee2b8.css">
<link rel="preload" href="/assets/js/runtime~main.375ada2f.js" as="script">
<link rel="preload" href="/assets/js/main.e8d6e5a5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://docs.cosmos.network" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo-sdk.svg" alt="Cosmos SDK Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-sdk.svg" alt="Cosmos SDK Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Cosmos SDK</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/main">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/main/core/baseapp">Next</a></li><li><a class="dropdown__link" href="/v0.50/core/baseapp">v0.50</a></li><li><a class="dropdown__link" href="/v0.47/core/baseapp">v0.47</a></li><li><a href="https://docs.cosmos.network/v0.46/" target="_self" rel="noopener noreferrer" class="dropdown__link">v0.46<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://docs.cosmos.network/v0.45/" target="_self" rel="noopener noreferrer" class="dropdown__link">v0.45<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/cosmos/cosmos-sdk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="github-icon">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 0.300049C5.4 0.300049 0 5.70005 0 12.3001C0 17.6001 3.4 22.1001 8.2 23.7001C8.8 23.8001 9 23.4001 9 23.1001C9 22.8001 9 22.1001 9 21.1001C5.7 21.8001 5 19.5001 5 19.5001C4.5 18.1001 3.7 17.7001 3.7 17.7001C2.5 17.0001 3.7 17.0001 3.7 17.0001C4.9 17.1001 5.5 18.2001 5.5 18.2001C6.6 20.0001 8.3 19.5001 9 19.2001C9.1 18.4001 9.4 17.9001 9.8 17.6001C7.1 17.3001 4.3 16.3001 4.3 11.7001C4.3 10.4001 4.8 9.30005 5.5 8.50005C5.5 8.10005 5 6.90005 5.7 5.30005C5.7 5.30005 6.7 5.00005 9 6.50005C10 6.20005 11 6.10005 12 6.10005C13 6.10005 14 6.20005 15 6.50005C17.3 4.90005 18.3 5.30005 18.3 5.30005C19 7.00005 18.5 8.20005 18.4 8.50005C19.2 9.30005 19.6 10.4001 19.6 11.7001C19.6 16.3001 16.8 17.3001 14.1 17.6001C14.5 18.0001 14.9 18.7001 14.9 19.8001C14.9 21.4001 14.9 22.7001 14.9 23.1001C14.9 23.4001 15.1 23.8001 15.7 23.7001C20.5 22.1001 23.9 17.6001 23.9 12.3001C24 5.70005 18.6 0.300049 12 0.300049Z" fill="currentColor"/>
            </svg>
            </a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/main">Cosmos SDK Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/intro/overview">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/basics/app-anatomy">Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/main/core/baseapp">Core Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/main/core/baseapp">BaseApp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/transactions">Transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/context">Context</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/node">Node Client (Daemon)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/store">Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/encoding">Encoding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/grpc_rest">gRPC, REST, and CometBFT Endpoints</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/cli">Command-Line Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/events">Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/telemetry">Telemetry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/ocap">Object-Capability Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/runtx_middleware">RunTx recovery middleware</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/simulation">Cosmos Blockchain Simulator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/proto-docs">Protobuf Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/tips">Transaction Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/upgrade">In-Place Store Migrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/core/config">Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/building-modules/intro">Building Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/building-apps/app-go">Building Apps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/run-node/keyring">Running a Node, API and CLI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/migrations/intro">SDK Migrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/modules">SDK Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/packages">Packages</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/tooling">Tooling</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/architecture">ADRs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/rfc">RFCs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/spec">Specifications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a href="https://tutorials.cosmos.network" target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true">Resources</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://tutorials.cosmos.network" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Tutorials<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://pkg.go.dev/github.com/cosmos/cosmos-sdk" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">SDK API Reference<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://docs.cosmos.network/swagger/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">REST API Spec<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://github.com/cosmos/awesome-cosmos" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Awesome Cosmos<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://github.com/orgs/cosmos/discussions" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Support<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Cosmos SDK<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/v0.47/core/baseapp">latest version</a></b> (<!-- -->v0.47<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><span class="breadcrumbs__link">Core Concepts</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">BaseApp</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>BaseApp</h1><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Synopsis</div><div class="admonitionContent_S0QG"><p>This document describes <code>BaseApp</code>, the abstraction that implements the core functionalities of a Cosmos SDK application.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Pre-requisite Readings</div><div class="admonitionContent_S0QG"><ul><li><a href="/main/basics/app-anatomy">Anatomy of a Cosmos SDK application</a></li><li><a href="/main/basics/tx-lifecycle">Lifecycle of a Cosmos SDK transaction</a></li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p><code>BaseApp</code> is a base type that implements the core of a Cosmos SDK application, namely:</p><ul><li>The <a href="#main-abci-messages">Application Blockchain Interface</a>, for the state-machine to communicate with the underlying consensus engine (e.g. CometBFT).</li><li><a href="#service-routers">Service Routers</a>, to route messages and queries to the appropriate module.</li><li>Different <a href="#state-updates">states</a>, as the state-machine can have different volatile states updated based on the ABCI message received.</li></ul><p>The goal of <code>BaseApp</code> is to provide the fundamental layer of a Cosmos SDK application
that developers can easily extend to build their own custom application. Usually,
developers will create a custom type for their application, like so:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> App </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// reference to a BaseApp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">baseapp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BaseApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// list of application store keys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// list of application keepers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// module manager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Extending the application with <code>BaseApp</code> gives the former access to all of <code>BaseApp</code>&#x27;s methods.
This allows developers to compose their custom application with the modules they want, while not
having to concern themselves with the hard work of implementing the ABCI, the service routers and state
management logic.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="type-definition">Type Definition<a href="#type-definition" class="hash-link" aria-label="Direct link to Type Definition" title="Direct link to Type Definition">​</a></h2><p>The <code>BaseApp</code> type holds many important parameters for any Cosmos SDK based application.</p><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">baseapp/baseapp.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/baseapp/baseapp.go#L58-L182" target="_blank">See full example on GitHub</a></div></div><p>Let us go through the most important components.</p><blockquote><p><strong>Note</strong>: Not all parameters are described, only the most important ones. Refer to the
type definition for the full list.</p></blockquote><p>First, the important parameters that are initialized during the bootstrapping of the application:</p><ul><li><a href="/main/core/store#commitmultistore"><code>CommitMultiStore</code></a>: This is the main store of the application,
which holds the canonical state that is committed at the <a href="#commit">end of each block</a>. This store
is <strong>not</strong> cached, meaning it is not used to update the application&#x27;s volatile (un-committed) states.
The <code>CommitMultiStore</code> is a multi-store, meaning a store of stores. Each module of the application
uses one or multiple <code>KVStores</code> in the multi-store to persist their subset of the state.</li><li>Database: The <code>db</code> is used by the <code>CommitMultiStore</code> to handle data persistence.</li><li><a href="#msg-service-router"><code>Msg</code> Service Router</a>: The <code>msgServiceRouter</code> facilitates the routing of <code>sdk.Msg</code> requests to the appropriate
module <code>Msg</code> service for processing. Here a <code>sdk.Msg</code> refers to the transaction component that needs to be
processed by a service in order to update the application state, and not to ABCI message which implements
the interface between the application and the underlying consensus engine.</li><li><a href="#grpc-query-router">gRPC Query Router</a>: The <code>grpcQueryRouter</code> facilitates the routing of gRPC queries to the
appropriate module for it to be processed. These queries are not ABCI messages themselves, but they
are relayed to the relevant module&#x27;s gRPC <code>Query</code> service.</li><li><a href="https://pkg.go.dev/github.com/cosmos/cosmos-sdk/types#TxDecoder" target="_blank" rel="noopener noreferrer"><code>TxDecoder</code></a>: It is used to decode
raw transaction bytes relayed by the underlying CometBFT engine.</li><li><a href="#antehandler"><code>AnteHandler</code></a>: This handler is used to handle signature verification, fee payment,
and other pre-message execution checks when a transaction is received. It&#x27;s executed during
<a href="#checktx"><code>CheckTx/RecheckTx</code></a> and <a href="#finalizeblock"><code>FinalizeBlock</code></a>.</li><li><a href="/main/basics/app-anatomy#initchainer"><code>InitChainer</code></a>,
<a href="/main/basics/app-anatomy#beginblocker-and-endblocker"><code>BeginBlocker</code> and <code>EndBlocker</code></a>: These are
the functions executed when the application receives the <code>InitChain</code> and <code>FinalizeBlock</code>
ABCI messages from the underlying CometBFT engine.</li></ul><p>Then, parameters used to define <a href="#state-updates">volatile states</a> (i.e. cached states):</p><ul><li><code>checkState</code>: This state is updated during <a href="#checktx"><code>CheckTx</code></a>, and reset on <a href="#commit"><code>Commit</code></a>.</li><li><code>finalizeBlockState</code>: This state is updated during <a href="#finalizeblock"><code>FinalizeBlock</code></a>, and set to <code>nil</code> on
<a href="#commit"><code>Commit</code></a> and gets re-initialized on <code>FinalizeBlock</code>.</li><li><code>processProposalState</code>: This state is updated during <a href="#process-proposal"><code>ProcessProposal</code></a>.</li><li><code>prepareProposalState</code>: This state is updated during <a href="#prepare-proposal"><code>PrepareProposal</code></a>.</li></ul><p>Finally, a few more important parameters:</p><ul><li><code>voteInfos</code>: This parameter carries the list of validators whose precommit is missing, either
because they did not vote or because the proposer did not include their vote. This information is
carried by the <a href="/main/core/context">Context</a> and can be used by the application for various things like
punishing absent validators.</li><li><code>minGasPrices</code>: This parameter defines the minimum gas prices accepted by the node. This is a
<strong>local</strong> parameter, meaning each full-node can set a different <code>minGasPrices</code>. It is used in the
<code>AnteHandler</code> during <a href="#checktx"><code>CheckTx</code></a>, mainly as a spam protection mechanism. The transaction
enters the <a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_basic_concepts.md#mempool-methods" target="_blank" rel="noopener noreferrer">mempool</a>
only if the gas prices of the transaction are greater than one of the minimum gas price in
<code>minGasPrices</code> (e.g. if <code>minGasPrices == 1uatom,1photon</code>, the <code>gas-price</code> of the transaction must be
greater than <code>1uatom</code> OR <code>1photon</code>).</li><li><code>appVersion</code>: Version of the application. It is set in the
<a href="/main/basics/app-anatomy#constructor-function">application&#x27;s constructor function</a>.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="constructor">Constructor<a href="#constructor" class="hash-link" aria-label="Direct link to Constructor" title="Direct link to Constructor">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewBaseApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> logger log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> db dbm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DB</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> txDecoder sdk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">TxDecoder</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">...</span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">BaseApp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">BaseApp </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>BaseApp</code> constructor function is pretty straightforward. The only thing worth noting is the
possibility to provide additional <a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/baseapp/options.go" target="_blank" rel="noopener noreferrer"><code>options</code></a>
to the <code>BaseApp</code>, which will execute them in order. The <code>options</code> are generally <code>setter</code> functions
for important parameters, like <code>SetPruning()</code> to set pruning options or <code>SetMinGasPrices()</code> to set
the node&#x27;s <code>min-gas-prices</code>.</p><p>Naturally, developers can add additional <code>options</code> based on their application&#x27;s needs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="state-updates">State Updates<a href="#state-updates" class="hash-link" aria-label="Direct link to State Updates" title="Direct link to State Updates">​</a></h2><p>The <code>BaseApp</code> maintains four primary volatile states and a root or main state. The main state
is the canonical state of the application and the volatile states, <code>checkState</code>, <code>prepareProposalState</code>, <code>processProposalState</code> and <code>finalizeBlockState</code>
are used to handle state transitions in-between the main state made during <a href="#commit"><code>Commit</code></a>.</p><p>Internally, there is only a single <code>CommitMultiStore</code> which we refer to as the main or root state.
From this root state, we derive four volatile states by using a mechanism called <em>store branching</em> (performed by <code>CacheWrap</code> function).
The types can be illustrated as follows:</p><p><img loading="lazy" alt="Types" src="/assets/images/baseapp_state-c6660bdfda8fa3aeb44239780b465ecc.png" width="805" height="933" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="initchain-state-updates">InitChain State Updates<a href="#initchain-state-updates" class="hash-link" aria-label="Direct link to InitChain State Updates" title="Direct link to InitChain State Updates">​</a></h3><p>During <code>InitChain</code>, the four volatile states, <code>checkState</code>, <code>prepareProposalState</code>, <code>processProposalState</code>
and <code>finalizeBlockState</code> are set by branching the root <code>CommitMultiStore</code>. Any subsequent reads and writes happen
on branched versions of the <code>CommitMultiStore</code>.
To avoid unnecessary roundtrip to the main state, all reads to the branched store are cached.</p><p><img loading="lazy" alt="InitChain" src="/assets/images/baseapp_state-initchain-62da1a79d5dd67a6d1ab07f2805040da.png" width="735" height="292" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="checktx-state-updates">CheckTx State Updates<a href="#checktx-state-updates" class="hash-link" aria-label="Direct link to CheckTx State Updates" title="Direct link to CheckTx State Updates">​</a></h3><p>During <code>CheckTx</code>, the <code>checkState</code>, which is based off of the last committed state from the root
store, is used for any reads and writes. Here we only execute the <code>AnteHandler</code> and verify a service router
exists for every message in the transaction. Note, when we execute the <code>AnteHandler</code>, we branch
the already branched <code>checkState</code>.
This has the side effect that if the <code>AnteHandler</code> fails, the state transitions won&#x27;t be reflected in the <code>checkState</code>
-- i.e. <code>checkState</code> is only updated on success.</p><p><img loading="lazy" alt="CheckTx" src="/assets/images/baseapp_state-checktx-5bb98c17c37b2b93e98cc681b6c1c9d6.png" width="826" height="397" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prepareproposal-state-updates">PrepareProposal State Updates<a href="#prepareproposal-state-updates" class="hash-link" aria-label="Direct link to PrepareProposal State Updates" title="Direct link to PrepareProposal State Updates">​</a></h3><p>During <code>PrepareProposal</code>, the <code>prepareProposalState</code> is set by branching the root <code>CommitMultiStore</code>.
The <code>prepareProposalState</code> is used for any reads and writes that occur during the <code>PrepareProposal</code> phase.
The function uses the <code>Select()</code> method of the mempool to iterate over the transactions. <code>runTx</code> is then called,
which encodes and validates each transaction and from there the <code>AnteHandler</code> is executed.
If successful, valid transactions are returned inclusive of the events, tags, and data generated
during the execution of the proposal.
The described behavior is that of the default handler, applications have the flexibility to define their own
<a href="https://docs.cosmos.network/main/building-apps/app-mempool#custom-mempool-handlers" target="_blank" rel="noopener noreferrer">custom mempool handlers</a>.</p><p><img loading="lazy" alt="ProcessProposal" src="/assets/images/baseapp_state-prepareproposal-bc5c8099ad94b823c376d1bde26d584a.png" width="966" height="539" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="processproposal-state-updates">ProcessProposal State Updates<a href="#processproposal-state-updates" class="hash-link" aria-label="Direct link to ProcessProposal State Updates" title="Direct link to ProcessProposal State Updates">​</a></h3><p>During <code>ProcessProposal</code>, the <code>processProposalState</code> is set based off of the last committed state
from the root store and is used to process a signed proposal received from a validator.
In this state, <code>runTx</code> is called and the <code>AnteHandler</code> is executed and the context used in this state is built with information
from the header and the main state, including the minimum gas prices, which are also set.
Again we want to highlight that the described behavior is that of the default handler and applications have the flexibility to define their own
<a href="https://docs.cosmos.network/main/building-apps/app-mempool#custom-mempool-handlers" target="_blank" rel="noopener noreferrer">custom mempool handlers</a>.</p><p><img loading="lazy" alt="ProcessProposal" src="/assets/images/baseapp_state-processproposal-486265a078da51c6f72ce7248e8021b3.png" width="711" height="351" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="finalizeblock-state-updates">FinalizeBlock State Updates<a href="#finalizeblock-state-updates" class="hash-link" aria-label="Direct link to FinalizeBlock State Updates" title="Direct link to FinalizeBlock State Updates">​</a></h3><p>During <code>FinalizeBlock</code>, the <code>finalizeBlockState</code> is set for use during transaction execution and endblock. The
<code>finalizeBlockState</code> is based off of the last committed state from the root store and is branched.
Note, the <code>finalizeBlockState</code> is set to <code>nil</code> on <a href="#commit"><code>Commit</code></a>.</p><p>The state flow for transcation execution is nearly identical to <code>CheckTx</code> except state transitions occur on
the <code>finalizeBlockState</code> and messages in a transaction are executed. Similarly to <code>CheckTx</code>, state transitions
occur on a doubly branched state -- <code>finalizeBlockState</code>. Successful message execution results in
writes being committed to <code>finalizeBlockState</code>. Note, if message execution fails, state transitions from
the AnteHandler are persisted.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="commit-state-updates">Commit State Updates<a href="#commit-state-updates" class="hash-link" aria-label="Direct link to Commit State Updates" title="Direct link to Commit State Updates">​</a></h3><p>During <code>Commit</code> all the state transitions that occurred in the <code>finalizeBlockState</code> are finally written to
the root <code>CommitMultiStore</code> which in turn is committed to disk and results in a new application
root hash. These state transitions are now considered final. Finally, the <code>checkState</code> is set to the
newly committed state and <code>finalizeBlockState</code> is set to <code>nil</code> to be reset on <code>FinalizeBlock</code>.</p><p><img loading="lazy" alt="Commit" src="/assets/images/baseapp_state-commit-247373784511c1db3ed2175551b22abb.png" width="641" height="320" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="paramstore">ParamStore<a href="#paramstore" class="hash-link" aria-label="Direct link to ParamStore" title="Direct link to ParamStore">​</a></h2><p>During <code>InitChain</code>, the <code>RequestInitChain</code> provides <code>ConsensusParams</code> which contains parameters
related to block execution such as maximum gas and size in addition to evidence parameters. If these
parameters are non-nil, they are set in the BaseApp&#x27;s <code>ParamStore</code>. Behind the scenes, the <code>ParamStore</code>
is managed by an <code>x/consensus_params</code> module. This allows the parameters to be tweaked via
on-chain governance.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="service-routers">Service Routers<a href="#service-routers" class="hash-link" aria-label="Direct link to Service Routers" title="Direct link to Service Routers">​</a></h2><p>When messages and queries are received by the application, they must be routed to the appropriate module in order to be processed. Routing is done via <code>BaseApp</code>, which holds a <code>msgServiceRouter</code> for messages, and a <code>grpcQueryRouter</code> for queries.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="msg-service-router"><code>Msg</code> Service Router<a href="#msg-service-router" class="hash-link" aria-label="Direct link to msg-service-router" title="Direct link to msg-service-router">​</a></h3><p><a href="/main/building-modules/messages-and-queries#messages"><code>sdk.Msg</code>s</a> need to be routed after they are extracted from transactions, which are sent from the underlying CometBFT engine via the <a href="#checktx"><code>CheckTx</code></a> and <a href="#finalizeblock"><code>FinalizeBlock</code></a> ABCI messages. To do so, <code>BaseApp</code> holds a <code>msgServiceRouter</code> which maps fully-qualified service methods (<code>string</code>, defined in each module&#x27;s Protobuf  <code>Msg</code> service) to the appropriate module&#x27;s <code>MsgServer</code> implementation.</p><p>The <a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/baseapp/msg_service_router.go" target="_blank" rel="noopener noreferrer">default <code>msgServiceRouter</code> included in <code>BaseApp</code></a> is stateless. However, some applications may want to make use of more stateful routing mechanisms such as allowing governance to disable certain routes or point them to new modules for upgrade purposes. For this reason, the <code>sdk.Context</code> is also passed into each <a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/baseapp/msg_service_router.go#L31-L32" target="_blank" rel="noopener noreferrer">route handler inside <code>msgServiceRouter</code></a>. For a stateless router that doesn&#x27;t want to make use of this, you can just ignore the <code>ctx</code>.</p><p>The application&#x27;s <code>msgServiceRouter</code> is initialized with all the routes using the application&#x27;s <a href="/main/building-modules/module-manager#manager">module manager</a> (via the <code>RegisterServices</code> method), which itself is initialized with all the application&#x27;s modules in the application&#x27;s <a href="/main/basics/app-anatomy#constructor-function">constructor</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="grpc-query-router">gRPC Query Router<a href="#grpc-query-router" class="hash-link" aria-label="Direct link to gRPC Query Router" title="Direct link to gRPC Query Router">​</a></h3><p>Similar to <code>sdk.Msg</code>s, <a href="/main/building-modules/messages-and-queries#queries"><code>queries</code></a> need to be routed to the appropriate module&#x27;s <a href="/main/building-modules/query-services"><code>Query</code> service</a>. To do so, <code>BaseApp</code> holds a <code>grpcQueryRouter</code>, which maps modules&#x27; fully-qualified service methods (<code>string</code>, defined in their Protobuf <code>Query</code> gRPC) to their <code>QueryServer</code> implementation. The <code>grpcQueryRouter</code> is called during the initial stages of query processing, which can be either by directly sending a gRPC query to the gRPC endpoint, or via the <a href="#query"><code>Query</code> ABCI message</a> on the CometBFT RPC endpoint.</p><p>Just like the <code>msgServiceRouter</code>, the <code>grpcQueryRouter</code> is initialized with all the query routes using the application&#x27;s <a href="/main/building-modules/module-manager">module manager</a> (via the <code>RegisterServices</code> method), which itself is initialized with all the application&#x27;s modules in the application&#x27;s <a href="/main/basics/app-anatomy#app-constructor">constructor</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="main-abci-20-messages">Main ABCI 2.0 Messages<a href="#main-abci-20-messages" class="hash-link" aria-label="Direct link to Main ABCI 2.0 Messages" title="Direct link to Main ABCI 2.0 Messages">​</a></h2><p>The <a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_basic_concepts.md" target="_blank" rel="noopener noreferrer">Application-Blockchain Interface</a> (ABCI) is a generic interface that connects a state-machine with a consensus engine to form a functional full-node. It can be wrapped in any language, and needs to be implemented by each application-specific blockchain built on top of an ABCI-compatible consensus engine like CometBFT.</p><p>The consensus engine handles two main tasks:</p><ul><li>The networking logic, which mainly consists in gossiping block parts, transactions and consensus votes.</li><li>The consensus logic, which results in the deterministic ordering of transactions in the form of blocks.</li></ul><p>It is <strong>not</strong> the role of the consensus engine to define the state or the validity of transactions. Generally, transactions are handled by the consensus engine in the form of <code>[]bytes</code>, and relayed to the application via the ABCI to be decoded and processed. At keys moments in the networking and consensus processes (e.g. beginning of a block, commit of a block, reception of an unconfirmed transaction, ...), the consensus engine emits ABCI messages for the state-machine to act on.</p><p>Developers building on top of the Cosmos SDK need not implement the ABCI themselves, as <code>BaseApp</code> comes with a built-in implementation of the interface. Let us go through the main ABCI messages that <code>BaseApp</code> implements:</p><ul><li><a href="#prepare-proposal"><code>Prepare Proposal</code></a></li><li><a href="#process-proposal"><code>Process Proposal</code></a></li><li><a href="#checktx"><code>CheckTx</code></a></li><li><a href="#finalizeblock"><code>FinalizeBlock</code></a></li><li><a href="#extendvote"><code>ExtendVote</code></a></li><li><a href="#verifyvoteextension"><code>VerifyVoteExtension</code></a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-proposal">Prepare Proposal<a href="#prepare-proposal" class="hash-link" aria-label="Direct link to Prepare Proposal" title="Direct link to Prepare Proposal">​</a></h3><p>The <code>PrepareProposal</code> function is part of the new methods introduced in Application Blockchain Interface (ABCI++) in CometBFT and is an important part of the application&#x27;s overall governance system. In the Cosmos SDK, it allows the application to have more fine-grained control over the transactions that are processed, and ensures that only valid transactions are committed to the blockchain.</p><p>Here is how the <code>PrepareProposal</code> function can be implemented:</p><ol><li>Extract the <code>sdk.Msg</code>s from the transaction.</li><li>Perform <em>stateful</em> checks by calling <code>Validate()</code> on each of the <code>sdk.Msg</code>&#x27;s. This is done after <em>stateless</em> checks as <em>stateful</em> checks are more computationally expensive. If <code>Validate()</code> fails, <code>PrepareProposal</code> returns before running further checks, which saves resources.</li><li>Perform any additional checks that are specific to the application, such as checking account balances, or ensuring that certain conditions are met before a transaction is proposed.hey are processed by the consensus engine, if necessary.</li><li>Return the updated transactions to be processed by the consensus engine</li></ol><p>Note that, unlike <code>CheckTx()</code>, <code>PrepareProposal</code> process <code>sdk.Msg</code>s, so it can directly update the state. However, unlike <code>FinalizeBlock()</code>, it does not commit the state updates. It&#x27;s important to exercise caution when using <code>PrepareProposal</code> as incorrect coding could affect the overall liveness of the network.</p><p>It&#x27;s important to note that <code>PrepareProposal</code> complements the <code>ProcessProposal</code> method which is executed after this method. The combination of these two methods means that it is possible to guarantee that no invalid transactions are ever committed. Furthermore, such a setup can give rise to other interesting use cases such as Oracles, threshold decryption and more.</p><p><code>PrepareProposal</code> returns a response to the underlying consensus engine of type <a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_methods.md#processproposal" target="_blank" rel="noopener noreferrer"><code>abci.ResponseCheckTx</code></a>. The response contains:</p><ul><li><code>Code (uint32)</code>: Response Code. <code>0</code> if successful.</li><li><code>Data ([]byte)</code>: Result bytes, if any.</li><li><code>Log (string):</code> The output of the application&#x27;s logger. May be non-deterministic.</li><li><code>Info (string):</code> Additional information. May be non-deterministic.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="process-proposal">Process Proposal<a href="#process-proposal" class="hash-link" aria-label="Direct link to Process Proposal" title="Direct link to Process Proposal">​</a></h3><p>The <code>ProcessProposal</code> function is called by the BaseApp as part of the ABCI message flow, and is executed during the <code>FinalizeBlock</code> phase of the consensus process. The purpose of this function is to give more control to the application for block validation, allowing it to check all transactions in a proposed block before the validator sends the prevote for the block. It allows a validator to perform application-dependent work in a proposed block, enabling features such as immediate block execution, and allows the Application to reject invalid blocks.</p><p>The <code>ProcessProposal</code> function performs several key tasks, including:</p><ol><li>Validating the proposed block by checking all transactions in it.</li><li>Checking the proposed block against the current state of the application, to ensure that it is valid and that it can be executed.</li><li>Updating the application&#x27;s state based on the proposal, if it is valid and passes all checks.</li><li>Returning a response to CometBFT indicating the result of the proposal processing.</li></ol><p>The <code>ProcessProposal</code> is an important part of the application&#x27;s overall governance system. It is used to manage the network&#x27;s parameters and other key aspects of its operation. It also ensures that the coherence property is adhered to i.e. all honest validators must accept a proposal by an honest proposer.</p><p>It&#x27;s important to note that <code>ProcessProposal</code> complements the <code>PrepareProposal</code> method which enables the application to have more fine-grained transaction control by allowing it to reorder, drop, delay, modify, and even add transactions as they see necessary. The combination of these two methods means that it is possible to guarantee that no invalid transactions are ever committed. Furthermore, such a setup can give rise to other interesting use cases such as Oracles, threshold decryption and more.</p><p>CometBFT calls it when it receives a proposal and the CometBFT algorithm has not locked on a value. The Application cannot modify the proposal at this point but can reject it if it is invalid. If that is the case, CometBFT will prevote <code>nil</code> on the proposal, which has strong liveness implications for CometBFT. As a general rule, the Application SHOULD accept a prepared proposal passed via <code>ProcessProposal</code>, even if a part of the proposal is invalid (e.g., an invalid transaction); the Application can ignore the invalid part of the prepared proposal at block execution time.</p><p>However, developers must exercise greater caution when using these methods. Incorrectly coding these methods could affect liveness as CometBFT is unable to receive 2/3 valid precommits to finalize a block.</p><p><code>ProcessProposal</code> returns a response to the underlying consensus engine of type <a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_methods.md#processproposal" target="_blank" rel="noopener noreferrer"><code>abci.ResponseCheckTx</code></a>. The response contains:</p><ul><li><code>Code (uint32)</code>: Response Code. <code>0</code> if successful.</li><li><code>Data ([]byte)</code>: Result bytes, if any.</li><li><code>Log (string):</code> The output of the application&#x27;s logger. May be non-deterministic.</li><li><code>Info (string):</code> Additional information. May be non-deterministic.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="checktx">CheckTx<a href="#checktx" class="hash-link" aria-label="Direct link to CheckTx" title="Direct link to CheckTx">​</a></h3><p><code>CheckTx</code> is sent by the underlying consensus engine when a new unconfirmed (i.e. not yet included in a valid block)
transaction is received by a full-node. The role of <code>CheckTx</code> is to guard the full-node&#x27;s mempool
(where unconfirmed transactions are stored until they are included in a block) from spam transactions.
Unconfirmed transactions are relayed to peers only if they pass <code>CheckTx</code>.</p><p><code>CheckTx()</code> can perform both <em>stateful</em> and <em>stateless</em> checks, but developers should strive to
make the checks <strong>lightweight</strong> because gas fees are not charged for the resources (CPU, data load...) used during the <code>CheckTx</code>. </p><p>In the Cosmos SDK, after <a href="/main/core/encoding">decoding transactions</a>, <code>CheckTx()</code> is implemented
to do the following checks:</p><ol><li>Extract the <code>sdk.Msg</code>s from the transaction.</li><li><strong>Optionally</strong> perform <em>stateless</em> checks by calling <code>ValidateBasic()</code> on each of the <code>sdk.Msg</code>s. This is done
first, as <em>stateless</em> checks are less computationally expensive than <em>stateful</em> checks. If
<code>ValidateBasic()</code> fail, <code>CheckTx</code> returns before running <em>stateful</em> checks, which saves resources.
This check is still performed for messages that have not yet migrated to the new message validation mechanism defined in <a href="https://docs.cosmos.network/main/rfc/rfc-001-tx-validation" target="_blank" rel="noopener noreferrer">RFC 001</a> and still have a <code>ValidateBasic()</code> method.</li><li>Perform non-module related <em>stateful</em> checks on the <a href="/main/basics/accounts">account</a>. This step is mainly about checking
that the <code>sdk.Msg</code> signatures are valid, that enough fees are provided and that the sending account
has enough funds to pay for said fees. Note that no precise <a href="/main/basics/gas-fees"><code>gas</code></a> counting occurs here,
as <code>sdk.Msg</code>s are not processed. Usually, the <a href="/main/basics/gas-fees#antehandler"><code>AnteHandler</code></a> will check that the <code>gas</code> provided
with the transaction is superior to a minimum reference gas amount based on the raw transaction size,
in order to avoid spam with transactions that provide 0 gas.</li></ol><p><code>CheckTx</code> does <strong>not</strong> process <code>sdk.Msg</code>s -  they only need to be processed when the canonical state need to be updated, which happens during <code>FinalizeBlock</code>.</p><p>Steps 2. and 3. are performed by the <a href="/main/basics/gas-fees#antehandler"><code>AnteHandler</code></a> in the <a href="#runtx-antehandler-and-runmsgs"><code>RunTx()</code></a>
function, which <code>CheckTx()</code> calls with the <code>runTxModeCheck</code> mode. During each step of <code>CheckTx()</code>, a
special <a href="#state-updates">volatile state</a> called <code>checkState</code> is updated. This state is used to keep
track of the temporary changes triggered by the <code>CheckTx()</code> calls of each transaction without modifying
the <a href="#main-state">main canonical state</a>. For example, when a transaction goes through <code>CheckTx()</code>, the
transaction&#x27;s fees are deducted from the sender&#x27;s account in <code>checkState</code>. If a second transaction is
received from the same account before the first is processed, and the account has consumed all its
funds in <code>checkState</code> during the first transaction, the second transaction will fail <code>CheckTx</code>() and
be rejected. In any case, the sender&#x27;s account will not actually pay the fees until the transaction
is actually included in a block, because <code>checkState</code> never gets committed to the main state. The
<code>checkState</code> is reset to the latest state of the main state each time a blocks gets <a href="#commit">committed</a>.</p><p><code>CheckTx</code> returns a response to the underlying consensus engine of type <a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_methods.md#checktx" target="_blank" rel="noopener noreferrer"><code>abci.ResponseCheckTx</code></a>.
The response contains:</p><ul><li><code>Code (uint32)</code>: Response Code. <code>0</code> if successful.</li><li><code>Data ([]byte)</code>: Result bytes, if any.</li><li><code>Log (string):</code> The output of the application&#x27;s logger. May be non-deterministic.</li><li><code>Info (string):</code> Additional information. May be non-deterministic.</li><li><code>GasWanted (int64)</code>: Amount of gas requested for transaction. It is provided by users when they generate the transaction.</li><li><code>GasUsed (int64)</code>: Amount of gas consumed by transaction. During <code>CheckTx</code>, this value is computed by multiplying the standard cost of a transaction byte by the size of the raw transaction. Next is an example:</li></ul><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">x/auth/ante/basic.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/x/auth/ante/basic.go#L102" target="_blank">See full example on GitHub</a></div></div><ul><li><code>Events ([]cmn.KVPair)</code>: Key-Value tags for filtering and indexing transactions (eg. by account). See <a href="/main/core/events"><code>event</code>s</a> for more.</li><li><code>Codespace (string)</code>: Namespace for the Code.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="rechecktx">RecheckTx<a href="#rechecktx" class="hash-link" aria-label="Direct link to RecheckTx" title="Direct link to RecheckTx">​</a></h4><p>After <code>Commit</code>, <code>CheckTx</code> is run again on all transactions that remain in the node&#x27;s local mempool
excluding the transactions that are included in the block. To prevent the mempool from rechecking all transactions
every time a block is committed, the configuration option <code>mempool.recheck=false</code> can be set. As of
Tendermint v0.32.1, an additional <code>Type</code> parameter is made available to the <code>CheckTx</code> function that
indicates whether an incoming transaction is new (<code>CheckTxType_New</code>), or a recheck (<code>CheckTxType_Recheck</code>).
This allows certain checks like signature verification can be skipped during <code>CheckTxType_Recheck</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="runtx-antehandler-runmsgs-posthandler">RunTx, AnteHandler, RunMsgs, PostHandler<a href="#runtx-antehandler-runmsgs-posthandler" class="hash-link" aria-label="Direct link to RunTx, AnteHandler, RunMsgs, PostHandler" title="Direct link to RunTx, AnteHandler, RunMsgs, PostHandler">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="runtx">RunTx<a href="#runtx" class="hash-link" aria-label="Direct link to RunTx" title="Direct link to RunTx">​</a></h3><p><code>RunTx</code> is called from <code>CheckTx</code>/<code>Finalizeblock</code> to handle the transaction, with <code>execModeCheck</code> or <code>execModeFinalize</code> as parameter to differentiate between the two modes of execution. Note that when <code>RunTx</code> receives a transaction, it has already been decoded.</p><p>The first thing <code>RunTx</code> does upon being called is to retrieve the <code>context</code>&#x27;s <code>CacheMultiStore</code> by calling the <code>getContextForTx()</code> function with the appropriate mode (either <code>runTxModeCheck</code> or <code>execModeFinalize</code>). This <code>CacheMultiStore</code> is a branch of the main store, with cache functionality (for query requests), instantiated during <code>FinalizeBlock</code> for transaction execution and during the <code>Commit</code> of the previous block for <code>CheckTx</code>. After that, two <code>defer func()</code> are called for <a href="/main/basics/gas-fees"><code>gas</code></a> management. They are executed when <code>runTx</code> returns and make sure <code>gas</code> is actually consumed, and will throw errors, if any.</p><p>After that, <code>RunTx()</code> calls <code>ValidateBasic()</code>, when available and for backward compatibility, on each <code>sdk.Msg</code>in the <code>Tx</code>, which runs preliminary <em>stateless</em> validity checks. If any <code>sdk.Msg</code> fails to pass <code>ValidateBasic()</code>, <code>RunTx()</code> returns with an error.</p><p>Then, the <a href="#antehandler"><code>anteHandler</code></a> of the application is run (if it exists). In preparation of this step, both the <code>checkState</code>/<code>finalizeBlockState</code>&#x27;s <code>context</code> and <code>context</code>&#x27;s <code>CacheMultiStore</code> are branched using the <code>cacheTxContext()</code> function.</p><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">baseapp/baseapp.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/baseapp/baseapp.go#L663-L680" target="_blank">See full example on GitHub</a></div></div><p>This allows <code>RunTx</code> not to commit the changes made to the state during the execution of <code>anteHandler</code> if it ends up failing. It also prevents the module implementing the <code>anteHandler</code> from writing to state, which is an important part of the <a href="/main/core/ocap">object-capabilities</a> of the Cosmos SDK.</p><p>Finally, the <a href="#runmsgs"><code>RunMsgs()</code></a> function is called to process the <code>sdk.Msg</code>s in the <code>Tx</code>. In preparation of this step, just like with the <code>anteHandler</code>, both the <code>checkState</code>/<code>finalizeBlockState</code>&#x27;s <code>context</code> and <code>context</code>&#x27;s <code>CacheMultiStore</code> are branched using the <code>cacheTxContext()</code> function.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="antehandler">AnteHandler<a href="#antehandler" class="hash-link" aria-label="Direct link to AnteHandler" title="Direct link to AnteHandler">​</a></h3><p>The <code>AnteHandler</code> is a special handler that implements the <code>AnteHandler</code> interface and is used to authenticate the transaction before the transaction&#x27;s internal messages are processed.</p><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">types/handler.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/types/handler.go#L6-L8" target="_blank">See full example on GitHub</a></div></div><p>The <code>AnteHandler</code> is theoretically optional, but still a very important component of public blockchain networks. It serves 3 primary purposes:</p><ul><li>Be a primary line of defense against spam and second line of defense (the first one being the mempool) against transaction replay with fees deduction and <a href="/main/core/transactions#transaction-generation"><code>sequence</code></a> checking.</li><li>Perform preliminary <em>stateful</em> validity checks like ensuring signatures are valid or that the sender has enough funds to pay for fees.</li><li>Play a role in the incentivisation of stakeholders via the collection of transaction fees.</li></ul><p><code>BaseApp</code> holds an <code>anteHandler</code> as parameter that is initialized in the <a href="/main/basics/app-anatomy#application-constructor">application&#x27;s constructor</a>. The most widely used <code>anteHandler</code> is the <a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/x/auth/ante/ante.go" target="_blank" rel="noopener noreferrer"><code>auth</code> module</a>.</p><p>Click <a href="/main/basics/gas-fees#antehandler">here</a> for more on the <code>anteHandler</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="runmsgs">RunMsgs<a href="#runmsgs" class="hash-link" aria-label="Direct link to RunMsgs" title="Direct link to RunMsgs">​</a></h3><p><code>RunMsgs</code> is called from <code>RunTx</code> with <code>runTxModeCheck</code> as parameter to check the existence of a route for each message the transaction, and with <code>execModeFinalize</code> to actually process the <code>sdk.Msg</code>s.</p><p>First, it retrieves the <code>sdk.Msg</code>&#x27;s fully-qualified type name, by checking the <code>type_url</code> of the Protobuf <code>Any</code> representing the <code>sdk.Msg</code>. Then, using the application&#x27;s <a href="#msg-service-router"><code>msgServiceRouter</code></a>, it checks for the existence of <code>Msg</code> service method related to that <code>type_url</code>. At this point, if <code>mode == runTxModeCheck</code>, <code>RunMsgs</code> returns. Otherwise, if <code>mode == execModeFinalize</code>, the <a href="/main/building-modules/msg-services"><code>Msg</code> service</a> RPC is executed, before <code>RunMsgs</code> returns.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="posthandler">PostHandler<a href="#posthandler" class="hash-link" aria-label="Direct link to PostHandler" title="Direct link to PostHandler">​</a></h3><p><code>PostHandler</code> is similar to <code>AnteHandler</code>, but it, as the name suggests, executes custom post tx processing logic after <a href="#runmsgs"><code>RunMsgs</code></a> is called. <code>PostHandler</code> receives the <code>Result</code> of the the <code>RunMsgs</code> in order to enable this customizable behavior.</p><p>Like <code>AnteHandler</code>s, <code>PostHandler</code>s are theoretically optional, one use case for <code>PostHandler</code>s is transaction tips (enabled by default in simapp).
Other use cases like unused gas refund can also be enabled by <code>PostHandler</code>s.</p><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">x/auth/posthandler/post.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/x/auth/posthandler/post.go#L1-L15" target="_blank">See full example on GitHub</a></div></div><p>Note, when <code>PostHandler</code>s fail, the state from <code>runMsgs</code> is also reverted, effectively making the transaction fail.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-abci-messages">Other ABCI Messages<a href="#other-abci-messages" class="hash-link" aria-label="Direct link to Other ABCI Messages" title="Direct link to Other ABCI Messages">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="initchain">InitChain<a href="#initchain" class="hash-link" aria-label="Direct link to InitChain" title="Direct link to InitChain">​</a></h3><p>The <a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_basic_concepts.md#method-overview" target="_blank" rel="noopener noreferrer"><code>InitChain</code> ABCI message</a> is sent from the underlying CometBFT engine when the chain is first started. It is mainly used to <strong>initialize</strong> parameters and state like:</p><ul><li><a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_app_requirements.md#consensus-parameters" target="_blank" rel="noopener noreferrer">Consensus Parameters</a> via <code>setConsensusParams</code>.</li><li><a href="#state-updates"><code>checkState</code> and <code>finalizeBlockState</code></a> via <code>setState</code>.</li><li>The <a href="/main/basics/gas-fees#block-gas-meter">block gas meter</a>, with infinite gas to process genesis transactions.</li></ul><p>Finally, the <code>InitChain(req abci.RequestInitChain)</code> method of <code>BaseApp</code> calls the <a href="/main/basics/app-anatomy#initchainer"><code>initChainer()</code></a> of the application in order to initialize the main state of the application from the <code>genesis file</code> and, if defined, call the <a href="/main/building-modules/genesis#initgenesis"><code>InitGenesis</code></a> function of each of the application&#x27;s modules.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="finalizeblock">FinalizeBlock<a href="#finalizeblock" class="hash-link" aria-label="Direct link to FinalizeBlock" title="Direct link to FinalizeBlock">​</a></h3><p>The <a href="https://github.com/cometbft/cometbft/blob/v0.38.x/spec/abci/abci++_basic_concepts.md#method-overview" target="_blank" rel="noopener noreferrer"><code>FinalizeBlock</code> ABCI message</a> is sent from the underlying CometBFT engine when a block proposal created by the correct proposer is received. The previous <code>BeginBlock, DeliverTx and Endblock</code> calls are private methods on the BaseApp struct.</p><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">baseapp/abci.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/baseapp/abci.go#L623" target="_blank">See full example on GitHub</a></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="beginblock">BeginBlock<a href="#beginblock" class="hash-link" aria-label="Direct link to BeginBlock" title="Direct link to BeginBlock">​</a></h4><ul><li><p>Initialize <a href="#state-updates"><code>finalizeBlockState</code></a> with the latest header using the <code>req abci.RequestFinalizeBlock</code> passed as parameter via the <code>setState</code> function.</p><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">baseapp/baseapp.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/baseapp/baseapp.go#L682-L706" target="_blank">See full example on GitHub</a></div></div><p>This function also resets the <a href="/main/basics/gas-fees#main-gas-meter">main gas meter</a>.</p></li><li><p>Initialize the <a href="/main/basics/gas-fees#block-gas-meter">block gas meter</a> with the <code>maxGas</code> limit. The <code>gas</code> consumed within the block cannot go above <code>maxGas</code>. This parameter is defined in the application&#x27;s consensus parameters.</p></li><li><p>Run the application&#x27;s <a href="/main/basics/app-anatomy#beginblocker-and-endblock"><code>beginBlocker()</code></a>, which mainly runs the <a href="/main/building-modules/beginblock-endblock#beginblock"><code>BeginBlocker()</code></a> method of each of the application&#x27;s modules.</p></li><li><p>Set the <a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_methods.md#voteinfo" target="_blank" rel="noopener noreferrer"><code>VoteInfos</code></a> of the application, i.e. the list of validators whose <em>precommit</em> for the previous block was included by the proposer of the current block. This information is carried into the <a href="/main/core/context"><code>Context</code></a> so that it can be used during transaction execution and EndBlock.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-execution">Transaction Execution<a href="#transaction-execution" class="hash-link" aria-label="Direct link to Transaction Execution" title="Direct link to Transaction Execution">​</a></h4><p>When the underlying consensus engine receives a block proposal, each transaction in the block needs to be processed by the application. To that end, the underlying consensus engine sends the transactions in FinalizeBlock message to the application for each transaction in a sequential order.</p><p>Before the first transaction of a given block is processed, a <a href="#state-updates">volatile state</a> called <code>finalizeBlockState</code> is initialized during FinalizeBlock. This state is updated each time a transaction is processed via <code>FinalizeBlock</code>, and committed to the <a href="#main-state">main state</a> when the block is <a href="#commit">committed</a>, after what it is set to <code>nil</code>.</p><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">baseapp/baseapp.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/baseapp/baseapp.go#LL708-L743" target="_blank">See full example on GitHub</a></div></div><p>Transaction execution within <code>FinalizeBlock</code> performs the <strong>exact same steps as <code>CheckTx</code></strong>, with a little caveat at step 3 and the addition of a fifth step:</p><ol><li>The <code>AnteHandler</code> does <strong>not</strong> check that the transaction&#x27;s <code>gas-prices</code> is sufficient. That is because the <code>min-gas-prices</code> value <code>gas-prices</code> is checked against is local to the node, and therefore what is enough for one full-node might not be for another. This means that the proposer can potentially include transactions for free, although they are not incentivised to do so, as they earn a bonus on the total fee of the block they propose.</li><li>For each <code>sdk.Msg</code> in the transaction, route to the appropriate module&#x27;s Protobuf <a href="/main/building-modules/msg-services"><code>Msg</code> service</a>. Additional <em>stateful</em> checks are performed, and the branched multistore held in <code>finalizeBlockState</code>&#x27;s <code>context</code> is updated by the module&#x27;s <code>keeper</code>. If the <code>Msg</code> service returns successfully, the branched multistore held in <code>context</code> is written to <code>finalizeBlockState</code> <code>CacheMultiStore</code>.</li></ol><p>During the additional fifth step outlined in (2), each read/write to the store increases the value of <code>GasConsumed</code>. You can find the default cost of each operation:</p><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">store/types/gas.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/store/types/gas.go#L230-L241" target="_blank">See full example on GitHub</a></div></div><p>At any point, if <code>GasConsumed &gt; GasWanted</code>, the function returns with <code>Code != 0</code> and the execution fails.</p><p>Each transactions returns a response to the underlying consensus engine of type <a href="https://github.com/cometbft/cometbft/blob/v0.38.0-rc1/spec/abci/abci%2B%2B_methods.md#exectxresult" target="_blank" rel="noopener noreferrer"><code>abci.ExecTxResult</code></a>. The response contains:</p><ul><li><code>Code (uint32)</code>: Response Code. <code>0</code> if successful.</li><li><code>Data ([]byte)</code>: Result bytes, if any.</li><li><code>Log (string):</code> The output of the application&#x27;s logger. May be non-deterministic.</li><li><code>Info (string):</code> Additional information. May be non-deterministic.</li><li><code>GasWanted (int64)</code>: Amount of gas requested for transaction. It is provided by users when they generate the transaction.</li><li><code>GasUsed (int64)</code>: Amount of gas consumed by transaction. During transaction execution, this value is computed by multiplying the standard cost of a transaction byte by the size of the raw transaction, and by adding gas each time a read/write to the store occurs.</li><li><code>Events ([]cmn.KVPair)</code>: Key-Value tags for filtering and indexing transactions (eg. by account). See <a href="/main/core/events"><code>event</code>s</a> for more.</li><li><code>Codespace (string)</code>: Namespace for the Code.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="endblock">EndBlock<a href="#endblock" class="hash-link" aria-label="Direct link to EndBlock" title="Direct link to EndBlock">​</a></h4><p>EndBlock is run after transaction execution completes. It allows developers to have logic be executed at the end of each block. In the Cosmos SDK, the bulk EndBlock() method is to run the application&#x27;s EndBlocker(), which mainly runs the EndBlocker() method of each of the application&#x27;s modules.</p><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">baseapp/baseapp.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/baseapp/baseapp.go#L747-L769" target="_blank">See full example on GitHub</a></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="commit">Commit<a href="#commit" class="hash-link" aria-label="Direct link to Commit" title="Direct link to Commit">​</a></h3><p>The <a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_basic_concepts.md#method-overview" target="_blank" rel="noopener noreferrer"><code>Commit</code> ABCI message</a> is sent from the underlying CometBFT engine after the full-node has received <em>precommits</em> from 2/3+ of validators (weighted by voting power). On the <code>BaseApp</code> end, the <code>Commit(res abci.ResponseCommit)</code> function is implemented to commit all the valid state transitions that occurred during <code>FinalizeBlock</code> and to reset state for the next block.</p><p>To commit state-transitions, the <code>Commit</code> function calls the <code>Write()</code> function on <code>finalizeBlockState.ms</code>, where <code>finalizeBlockState.ms</code> is a branched multistore of the main store <code>app.cms</code>. Then, the <code>Commit</code> function sets <code>checkState</code> to the latest header (obtained from <code>finalizeBlockState.ctx.BlockHeader</code>) and <code>finalizeBlockState</code> to <code>nil</code>.</p><p>Finally, <code>Commit</code> returns the hash of the commitment of <code>app.cms</code> back to the underlying consensus engine. This hash is used as a reference in the header of the next block.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="info">Info<a href="#info" class="hash-link" aria-label="Direct link to Info" title="Direct link to Info">​</a></h3><p>The <a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_basic_concepts.md#info-methods" target="_blank" rel="noopener noreferrer"><code>Info</code> ABCI message</a> is a simple query from the underlying consensus engine, notably used to sync the latter with the application during a handshake that happens on startup. When called, the <code>Info(res abci.ResponseInfo)</code> function from <code>BaseApp</code> will return the application&#x27;s name, version and the hash of the last commit of <code>app.cms</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="query">Query<a href="#query" class="hash-link" aria-label="Direct link to Query" title="Direct link to Query">​</a></h3><p>The <a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_basic_concepts.md#info-methods" target="_blank" rel="noopener noreferrer"><code>Query</code> ABCI message</a> is used to serve queries received from the underlying consensus engine, including queries received via RPC like CometBFT RPC. It used to be the main entrypoint to build interfaces with the application, but with the introduction of <a href="/main/building-modules/query-services">gRPC queries</a> in Cosmos SDK v0.40, its usage is more limited. The application must respect a few rules when implementing the <code>Query</code> method, which are outlined <a href="https://github.com/cometbft/cometbft/blob/v0.37.x/spec/abci/abci++_app_requirements.md#query" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Each CometBFT <code>query</code> comes with a <code>path</code>, which is a <code>string</code> which denotes what to query. If the <code>path</code> matches a gRPC fully-qualified service method, then <code>BaseApp</code> will defer the query to the <code>grpcQueryRouter</code> and let it handle it like explained <a href="#grpc-query-router">above</a>. Otherwise, the <code>path</code> represents a query that is not (yet) handled by the gRPC router. <code>BaseApp</code> splits the <code>path</code> string with the <code>/</code> delimiter. By convention, the first element of the split string (<code>split[0]</code>) contains the category of <code>query</code> (<code>app</code>, <code>p2p</code>, <code>store</code> or <code>custom</code> ). The <code>BaseApp</code> implementation of the <code>Query(req abci.RequestQuery)</code> method is a simple dispatcher serving these 4 main categories of queries:</p><ul><li>Application-related queries like querying the application&#x27;s version, which are served via the <code>handleQueryApp</code> method.</li><li>Direct queries to the multistore, which are served by the <code>handlerQueryStore</code> method. These direct queries are different from custom queries which go through <code>app.queryRouter</code>, and are mainly used by third-party service provider like block explorers.</li><li>P2P queries, which are served via the <code>handleQueryP2P</code> method. These queries return either <code>app.addrPeerFilter</code> or <code>app.ipPeerFilter</code> that contain the list of peers filtered by address or IP respectively. These lists are first initialized via <code>options</code> in <code>BaseApp</code>&#x27;s <a href="#constructor">constructor</a>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extendvote">ExtendVote<a href="#extendvote" class="hash-link" aria-label="Direct link to ExtendVote" title="Direct link to ExtendVote">​</a></h3><p><code>ExtendVote</code> allows an application to extend a pre-commit vote with arbitrary data. This process does NOT have be deterministic and the data returned can be unique to the validator process.</p><p>In the Cosmos-SDK this is implemented as a NoOp:</p><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">baseapp/abci_utils.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/baseapp/abci_utils.go#L274-L281" target="_blank">See full example on GitHub</a></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verifyvoteextension">VerifyVoteExtension<a href="#verifyvoteextension" class="hash-link" aria-label="Direct link to VerifyVoteExtension" title="Direct link to VerifyVoteExtension">​</a></h3><p><code>VerifyVoteExtension</code> allows an application to verify that the data returned by <code>ExtendVote</code> is valid. This process does NOT have be deterministic and the data returned can be unique to the validator process.</p><p>In the Cosmos-SDK this is implemented as a NoOp:</p><div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">baseapp/abci_utils.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:center;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/baseapp/abci_utils.go#L282-L288" target="_blank">See full example on GitHub</a></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/main/basics/gas-fees"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Gas and Fees</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/main/core/transactions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Transactions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#type-definition" class="table-of-contents__link toc-highlight">Type Definition</a></li><li><a href="#constructor" class="table-of-contents__link toc-highlight">Constructor</a></li><li><a href="#state-updates" class="table-of-contents__link toc-highlight">State Updates</a><ul><li><a href="#initchain-state-updates" class="table-of-contents__link toc-highlight">InitChain State Updates</a></li><li><a href="#checktx-state-updates" class="table-of-contents__link toc-highlight">CheckTx State Updates</a></li><li><a href="#prepareproposal-state-updates" class="table-of-contents__link toc-highlight">PrepareProposal State Updates</a></li><li><a href="#processproposal-state-updates" class="table-of-contents__link toc-highlight">ProcessProposal State Updates</a></li><li><a href="#finalizeblock-state-updates" class="table-of-contents__link toc-highlight">FinalizeBlock State Updates</a></li><li><a href="#commit-state-updates" class="table-of-contents__link toc-highlight">Commit State Updates</a></li></ul></li><li><a href="#paramstore" class="table-of-contents__link toc-highlight">ParamStore</a></li><li><a href="#service-routers" class="table-of-contents__link toc-highlight">Service Routers</a><ul><li><a href="#msg-service-router" class="table-of-contents__link toc-highlight"><code>Msg</code> Service Router</a></li><li><a href="#grpc-query-router" class="table-of-contents__link toc-highlight">gRPC Query Router</a></li></ul></li><li><a href="#main-abci-20-messages" class="table-of-contents__link toc-highlight">Main ABCI 2.0 Messages</a><ul><li><a href="#prepare-proposal" class="table-of-contents__link toc-highlight">Prepare Proposal</a></li><li><a href="#process-proposal" class="table-of-contents__link toc-highlight">Process Proposal</a></li><li><a href="#checktx" class="table-of-contents__link toc-highlight">CheckTx</a></li></ul></li><li><a href="#runtx-antehandler-runmsgs-posthandler" class="table-of-contents__link toc-highlight">RunTx, AnteHandler, RunMsgs, PostHandler</a><ul><li><a href="#runtx" class="table-of-contents__link toc-highlight">RunTx</a></li><li><a href="#antehandler" class="table-of-contents__link toc-highlight">AnteHandler</a></li><li><a href="#runmsgs" class="table-of-contents__link toc-highlight">RunMsgs</a></li><li><a href="#posthandler" class="table-of-contents__link toc-highlight">PostHandler</a></li></ul></li><li><a href="#other-abci-messages" class="table-of-contents__link toc-highlight">Other ABCI Messages</a><ul><li><a href="#initchain" class="table-of-contents__link toc-highlight">InitChain</a></li><li><a href="#finalizeblock" class="table-of-contents__link toc-highlight">FinalizeBlock</a></li><li><a href="#commit" class="table-of-contents__link toc-highlight">Commit</a></li><li><a href="#info" class="table-of-contents__link toc-highlight">Info</a></li><li><a href="#query" class="table-of-contents__link toc-highlight">Query</a></li><li><a href="#extendvote" class="table-of-contents__link toc-highlight">ExtendVote</a></li><li><a href="#verifyvoteextension" class="table-of-contents__link toc-highlight">VerifyVoteExtension</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://cosmos.network"><img src="/img/logo-bw.svg" alt="Cosmos Logo"></a></li></ul></div><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://hub.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cosmos Hub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.cometbft.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">CometBFT<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ibc.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBC Go<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/cosmosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://reddit.com/r/cosmosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/cosmosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/cosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/c/CosmosProject" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/cosmosproject" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p>The development of the Cosmos SDK is led primarily by <a href="https://interchain.io/ecosystem">Interchain Core Teams</a>. Funding for this development comes primarily from the Interchain Foundation, a Swiss non-profit.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.375ada2f.js"></script>
<script src="/assets/js/main.e8d6e5a5.js"></script>
</body>
</html>