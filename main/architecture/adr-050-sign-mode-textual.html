<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-architecture/adr-050-sign-mode-textual">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">ADR 050: SIGN_MODE_TEXTUAL | Cosmos SDK</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.cosmos.network/img/banner.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.cosmos.network/img/banner.jpg"><meta data-rh="true" property="og:url" content="https://docs.cosmos.network/main/architecture/adr-050-sign-mode-textual"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ADR 050: SIGN_MODE_TEXTUAL | Cosmos SDK"><meta data-rh="true" name="description" content="Changelog"><meta data-rh="true" property="og:description" content="Changelog"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://docs.cosmos.network/main/architecture/adr-050-sign-mode-textual"><link data-rh="true" rel="alternate" href="https://docs.cosmos.network/main/architecture/adr-050-sign-mode-textual" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.cosmos.network/main/architecture/adr-050-sign-mode-textual" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QLS2QSP47E-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Cosmos SDK" href="/opensearch.xml">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51029217-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.e98ee2b8.css">
<link rel="preload" href="/assets/js/runtime~main.375ada2f.js" as="script">
<link rel="preload" href="/assets/js/main.e8d6e5a5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://docs.cosmos.network" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo-sdk.svg" alt="Cosmos SDK Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-sdk.svg" alt="Cosmos SDK Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Cosmos SDK</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/main">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/main/architecture/adr-050-sign-mode-textual">Next</a></li><li><a class="dropdown__link" href="/v0.50/architecture/adr-050-sign-mode-textual">v0.50</a></li><li><a class="dropdown__link" href="/v0.47/architecture/adr-050-sign-mode-textual">v0.47</a></li><li><a href="https://docs.cosmos.network/v0.46/" target="_self" rel="noopener noreferrer" class="dropdown__link">v0.46<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://docs.cosmos.network/v0.45/" target="_self" rel="noopener noreferrer" class="dropdown__link">v0.45<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/cosmos/cosmos-sdk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="github-icon">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 0.300049C5.4 0.300049 0 5.70005 0 12.3001C0 17.6001 3.4 22.1001 8.2 23.7001C8.8 23.8001 9 23.4001 9 23.1001C9 22.8001 9 22.1001 9 21.1001C5.7 21.8001 5 19.5001 5 19.5001C4.5 18.1001 3.7 17.7001 3.7 17.7001C2.5 17.0001 3.7 17.0001 3.7 17.0001C4.9 17.1001 5.5 18.2001 5.5 18.2001C6.6 20.0001 8.3 19.5001 9 19.2001C9.1 18.4001 9.4 17.9001 9.8 17.6001C7.1 17.3001 4.3 16.3001 4.3 11.7001C4.3 10.4001 4.8 9.30005 5.5 8.50005C5.5 8.10005 5 6.90005 5.7 5.30005C5.7 5.30005 6.7 5.00005 9 6.50005C10 6.20005 11 6.10005 12 6.10005C13 6.10005 14 6.20005 15 6.50005C17.3 4.90005 18.3 5.30005 18.3 5.30005C19 7.00005 18.5 8.20005 18.4 8.50005C19.2 9.30005 19.6 10.4001 19.6 11.7001C19.6 16.3001 16.8 17.3001 14.1 17.6001C14.5 18.0001 14.9 18.7001 14.9 19.8001C14.9 21.4001 14.9 22.7001 14.9 23.1001C14.9 23.4001 15.1 23.8001 15.7 23.7001C20.5 22.1001 23.9 17.6001 23.9 12.3001C24 5.70005 18.6 0.300049 12 0.300049Z" fill="currentColor"/>
            </svg>
            </a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/main">Cosmos SDK Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/intro/overview">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/basics/app-anatomy">Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/core/baseapp">Core Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/building-modules/intro">Building Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/building-apps/app-go">Building Apps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/run-node/keyring">Running a Node, API and CLI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/migrations/intro">SDK Migrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/modules">SDK Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/packages">Packages</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/tooling">Tooling</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/main/architecture">ADRs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture">Architecture Decision Records (ADR)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/PROCESS">ADR Creation Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-002-docs-structure">ADR 002: SDK Documentation Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-003-dynamic-capability-store">ADR 3: Dynamic Capability Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-004-split-denomination-keys">ADR 004: Split Denomination Keys</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-006-secret-store-replacement">ADR 006: Secret Store Replacement</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-007-specialization-groups">ADR 007: Specialization Groups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-008-dCERT-group">ADR 008: Decentralized Computer Emergency Response Team (dCERT) Group</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-009-evidence-module">ADR 009: Evidence Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-010-modular-antehandler">ADR 010: Modular AnteHandler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-011-generalize-genesis-accounts">ADR 011: Generalize Genesis Accounts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-012-state-accessors">ADR 012: State Accessors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-013-metrics">ADR 013: Observability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-014-proportional-slashing">ADR 14: Proportional Slashing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-016-validator-consensus-key-rotation">ADR 016: Validator Consensus Key Rotation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-017-historical-header-module">ADR 17: Historical Header Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-018-extendable-voting-period">ADR 18: Extendable Voting Periods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-019-protobuf-state-encoding">ADR 019: Protocol Buffer State Encoding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-020-protobuf-transaction-encoding">ADR 020: Protocol Buffer Transaction Encoding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-021-protobuf-query-encoding">ADR 021: Protocol Buffer Query Encoding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-022-custom-panic-handling">ADR 022: Custom BaseApp panic handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-023-protobuf-naming">ADR 023: Protocol Buffer Naming and Versioning Conventions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-024-coin-metadata">ADR 024: Coin Metadata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-027-deterministic-protobuf-serialization">ADR 027: Deterministic Protobuf Serialization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-028-public-key-addresses">ADR 028: Public Key Addresses</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-029-fee-grant-module">ADR 029: Fee Grant Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-030-authz-module">ADR 030: Authorization Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-031-msg-service">ADR 031: Protobuf Msg Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-032-typed-events">ADR 032: Typed Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-033-protobuf-inter-module-comm">ADR 033: Protobuf-based Inter-Module Communication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-034-account-rekeying">ADR 034: Account Rekeying</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-035-rosetta-api-support">ADR 035: Rosetta API Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-036-arbitrary-signature">ADR 036: Arbitrary Message Signature Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-037-gov-split-vote">ADR 037: Governance split votes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-038-state-listening">ADR 038: KVStore state listening</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-039-epoched-staking">ADR 039: Epoched Staking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-040-storage-and-smt-state-commitments">ADR 040: Storage and SMT State Commitments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-041-in-place-store-migrations">ADR 041: In-Place Store Migrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-042-group-module">ADR 042: Group Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-043-nft-module">ADR 43: NFT Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-044-protobuf-updates-guidelines">ADR 044: Guidelines for Updating Protobuf Definitions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-045-check-delivertx-middlewares">ADR 045: BaseApp {Check,Deliver}Tx as Middlewares</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-046-module-params">ADR 046: Module Params</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-047-extend-upgrade-plan">ADR 047: Extend Upgrade Plan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-048-consensus-fees">ADR 048: Multi Tire Gas Price System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-049-state-sync-hooks">ADR 049: State Sync Hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-050-sign-mode-textual-annex1">ADR 050: SIGN_MODE_TEXTUAL: Annex 1 Value Renderers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-050-sign-mode-textual-annex2">ADR 050: SIGN_MODE_TEXTUAL: Annex 2 XXX</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/main/architecture/adr-050-sign-mode-textual">ADR 050: SIGN_MODE_TEXTUAL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-053-go-module-refactoring">ADR 053: Go Module Refactoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-054-semver-compatible-modules">ADR 054: Semver Compatible SDK Modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-055-orm">ADR 055: ORM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-057-app-wiring">ADR 057: App Wiring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-058-auto-generated-cli">ADR 058: Auto-Generated CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-059-test-scopes">ADR 059: Test Scopes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-060-abci-1.0">ADR 60: ABCI 1.0 Integration (Phase I)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-061-liquid-staking">ADR ADR-061: Liquid Staking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-062-collections-state-layer">ADR 062: Collections, a simplified storage layer for cosmos-sdk modules.</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-063-core-module-api">ADR 063: Core Module API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-064-abci-2.0">ADR 64: ABCI 2.0 Integration (Phase II)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-065-store-v2">ADR-065: Store V2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-067-simulator-v2">ADR 067: Simulator v2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/architecture/adr-template">ADR {ADR-NUMBER}:</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/rfc">RFCs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/main/spec">Specifications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a href="https://tutorials.cosmos.network" target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true">Resources</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://tutorials.cosmos.network" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Tutorials<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://pkg.go.dev/github.com/cosmos/cosmos-sdk" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">SDK API Reference<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://docs.cosmos.network/swagger/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">REST API Spec<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://github.com/cosmos/awesome-cosmos" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Awesome Cosmos<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://github.com/orgs/cosmos/discussions" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Support<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Cosmos SDK<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/v0.47/architecture/adr-050-sign-mode-textual">latest version</a></b> (<!-- -->v0.47<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><span class="breadcrumbs__link">ADRs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ADR 050: SIGN_MODE_TEXTUAL</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>ADR 050: SIGN_MODE_TEXTUAL</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog">Changelog<a href="#changelog" class="hash-link" aria-label="Direct link to Changelog" title="Direct link to Changelog">​</a></h2><ul><li>Dec 06, 2021: Initial Draft.</li><li>Feb 07, 2022: Draft read and concept-ACKed by the Ledger team.</li><li>May 16, 2022: Change status to Accepted.</li><li>Aug 11, 2022: Require signing over tx raw bytes.</li><li>Sep 07, 2022: Add custom <code>Msg</code>-renderers.</li><li>Sep 18, 2022: Structured format instead of lines of text</li><li>Nov 23, 2022: Specify CBOR encoding.</li><li>Dec 01, 2022: Link to examples in separate JSON file.</li><li>Dec 06, 2022: Re-ordering of envelope screens.</li><li>Dec 14, 2022: Mention exceptions for invertability.</li><li>Jan 23, 2023: Switch Screen.Text to Title+Content.</li><li>Mar 07, 2023: Change SignDoc from array to struct containing array.</li><li>Mar 20, 2023: Introduce a spec version initialized to 0.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="status">Status<a href="#status" class="hash-link" aria-label="Direct link to Status" title="Direct link to Status">​</a></h2><p>Accepted. Implementation started. Small value renderers details still need to be polished.</p><p>Spec version: 0.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a href="#abstract" class="hash-link" aria-label="Direct link to Abstract" title="Direct link to Abstract">​</a></h2><p>This ADR specifies SIGN_MODE_TEXTUAL, a new string-based sign mode that is targetted at signing with hardware devices.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a href="#context" class="hash-link" aria-label="Direct link to Context" title="Direct link to Context">​</a></h2><p>Protobuf-based SIGN_MODE_DIRECT was introduced in <a href="/main/architecture/adr-020-protobuf-transaction-encoding">ADR-020</a> and is intended to replace SIGN_MODE_LEGACY_AMINO_JSON in most situations, such as mobile wallets and CLI keyrings. However, the <a href="https://www.ledger.com/" target="_blank" rel="noopener noreferrer">Ledger</a> hardware wallet is still using SIGN_MODE_LEGACY_AMINO_JSON for displaying the sign bytes to the user. Hardware wallets cannot transition to SIGN_MODE_DIRECT as:</p><ul><li>SIGN_MODE_DIRECT is binary-based and thus not suitable for display to end-users. Technically, hardware wallets could simply display the sign bytes to the user. But this would be considered as blind signing, and is a security concern.</li><li>hardware cannot decode the protobuf sign bytes due to memory constraints, as the Protobuf definitions would need to be embedded on the hardware device.</li></ul><p>In an effort to remove Amino from the SDK, a new sign mode needs to be created for hardware devices. <a href="https://github.com/cosmos/cosmos-sdk/issues/6513" target="_blank" rel="noopener noreferrer">Initial discussions</a> propose a text-based sign mode, which this ADR formally specifies.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision">Decision<a href="#decision" class="hash-link" aria-label="Direct link to Decision" title="Direct link to Decision">​</a></h2><p>In SIGN_MODE_TEXTUAL, a transaction is rendered into a textual representation,
which is then sent to a secure device or subsystem for the user to review and sign.
Unlike <code>SIGN_MODE_DIRECT</code>, the transmitted data can be simply decoded into legible text
even on devices with limited processing and display.</p><p>The textual representation is a sequence of <em>screens</em>.
Each screen is meant to be displayed in its entirety (if possible) even on a small device like a Ledger.
A screen is roughly equivalent to a short line of text.
Large screens can be displayed in several pieces,
much as long lines of text are wrapped,
so no hard guidance is given, though 40 characters is a good target.
A screen is used to display a single key/value pair for scalar values
(or composite values with a compact notation, such as <code>Coins</code>)
or to introduce or conclude a larger grouping.</p><p>The text can contain the full range of Unicode code points, including control characters and nul.
The device is responsible for deciding how to display characters it cannot render natively.
See <a href="/main/architecture/adr-050-sign-mode-textual-annex2">annex 2</a> for guidance.</p><p>Screens have a non-negative indentation level to signal composite or nested structures.
Indentation level zero is the top level.
Indentation is displayed via some device-specific mechanism.
Message quotation notation is an appropriate model, such as
leading <code>&gt;</code> characters or vertical bars on more capable displays.</p><p>Some screens are marked as <em>expert</em> screens,
meant to be displayed only if the viewer chooses to opt in for the extra detail.
Expert screens are meant for information that is rarely useful,
or needs to be present only for signature integrity (see below).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="invertible-rendering">Invertible Rendering<a href="#invertible-rendering" class="hash-link" aria-label="Direct link to Invertible Rendering" title="Direct link to Invertible Rendering">​</a></h3><p>We require that the rendering of the transaction be invertible:
there must be a parsing function such that for every transaction,
when rendered to the textual representation,
parsing that representation yeilds a proto message equivalent
to the original under proto equality.</p><p>Note that this inverse function does not need to perform correct
parsing or error signaling for the whole domain of textual data.
Merely that the range of valid transactions be invertible under
the composition of rendering and parsing.</p><p>Note that the existence of an inverse function ensures that the
rendered text contains the full information of the original transaction,
not a hash or subset.</p><p>We make an exception for invertibility for data which are too large to
meaningfully display, such as byte strings longer than 32 bytes. We may then
selectively render them with a cryptographically-strong hash. In these cases,
it is still computationally infeasible to find a different transaction which
has the same rendering. However, we must ensure that the hash computation is
simple enough to be reliably executed independently, so at least the hash is
itself reasonably verifiable when the raw byte string is not.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="chain-state">Chain State<a href="#chain-state" class="hash-link" aria-label="Direct link to Chain State" title="Direct link to Chain State">​</a></h3><p>The rendering function (and parsing function) may depend on the current chain state.
This is useful for reading parameters, such as coin display metadata,
or for reading user-specific preferences such as language or address aliases.
Note that if the observed state changes between signature generation
and the transaction&#x27;s inclusion in a block, the delivery-time rendering
might differ. If so, the signature will be invalid and the transaction
will be rejected.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="signature-and-security">Signature and Security<a href="#signature-and-security" class="hash-link" aria-label="Direct link to Signature and Security" title="Direct link to Signature and Security">​</a></h3><p>For security, transaction signatures should have three properties:</p><ol><li><p>Given the transaction, signatures, and chain state, it must be possible to validate that the signatures matches the transaction,
to verify that the signers must have known their respective secret keys.</p></li><li><p>It must be computationally infeasible to find a substantially different transaction for which the given signatures are valid, given the same chain state.</p></li><li><p>The user should be able to give informed consent to the signed data via a simple, secure device with limited display capabilities.</p></li></ol><p>The correctness and security of <code>SIGN_MODE_TEXTUAL</code> is guaranteed by demonstrating an inverse function from the rendering to transaction protos.
This means that it is impossible for a different protocol buffer message to render to the same text.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-hash-malleability">Transaction Hash Malleability<a href="#transaction-hash-malleability" class="hash-link" aria-label="Direct link to Transaction Hash Malleability" title="Direct link to Transaction Hash Malleability">​</a></h3><p>When client software forms a transaction, the &quot;raw&quot; transaction (<code>TxRaw</code>) is serialized as a proto
and a hash of the resulting byte sequence is computed.
This is the <code>TxHash</code>, and is used by various services to track the submitted transaction through its lifecycle.
Various misbehavior is possible if one can generate a modified transaction with a different TxHash
but for which the signature still checks out.</p><p>SIGN_MODE_TEXTUAL prevents this transaction malleability by including the TxHash as an expert screen
in the rendering.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="signdoc">SignDoc<a href="#signdoc" class="hash-link" aria-label="Direct link to SignDoc" title="Direct link to SignDoc">​</a></h3><p>The SignDoc for <code>SIGN_MODE_TEXTUAL</code> is formed from a data structure like:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Screen </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Title </span><span class="token builtin">string</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// possibly size limited to, advised to 64 characters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Content </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// possibly size limited to, advised to 255 characters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Indent </span><span class="token builtin">uint8</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// size limited to something small like 16 or 32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Expert </span><span class="token builtin">bool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> SignDocTextual </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Screens </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">Screen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We do not plan to use protobuf serialization to form the sequence of bytes
that will be tranmitted and signed, in order to keep the decoder simple.
We will use <a href="https://cbor.io" target="_blank" rel="noopener noreferrer">CBOR</a> (<a href="https://www.rfc-editor.org/rfc/rfc8949.html" target="_blank" rel="noopener noreferrer">RFC 8949</a>) instead.
The encoding is defined by the following CDDL (<a href="https://www.rfc-editor.org/rfc/rfc8610" target="_blank" rel="noopener noreferrer">RFC 8610</a>):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">;;; CDDL (RFC 8610) Specification of SignDoc for SIGN_MODE_TEXTUAL.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;;; Must be encoded using CBOR deterministic encoding (RFC 8949, section 4.2.1).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; A Textual document is a struct containing one field: an array of screens.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sign_doc = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  screens_key: [* screen],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; The key is an integer to keep the encoding small.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">screens_key = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; A screen consists of a text string, an indentation, and the expert flag,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; represented as an integer-keyed map. All entries are optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; and MUST be omitted from the encoding if empty, zero, or false.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; Text defaults to the empty string, indent defaults to zero,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; and expert defaults to false.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">screen = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ? title_key: tstr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ? content_key: tstr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ? indent_key: uint,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ? expert_key: bool,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; Keys are small integers to keep the encoding small.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title_key = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content_key = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">indent_key = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expert_key = 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Defining the sign_doc as directly an array of screens has also been considered. However, given the possibility of future iterations of this specification, using a single-keyed struct has been chosen over the former proposal, as structs allow for easier backwards-compatibility.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="details">Details<a href="#details" class="hash-link" aria-label="Direct link to Details" title="Direct link to Details">​</a></h2><p>In the examples that follow, screens will be shown as lines of text,
indentation is indicated with a leading &#x27;&gt;&#x27;,
and expert screens are marked with a leading <code>*</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="encoding-of-the-transaction-envelope">Encoding of the Transaction Envelope<a href="#encoding-of-the-transaction-envelope" class="hash-link" aria-label="Direct link to Encoding of the Transaction Envelope" title="Direct link to Encoding of the Transaction Envelope">​</a></h3><p>We define &quot;transaction envelope&quot; as all data in a transaction that is not in the <code>TxBody.Messages</code> field. Transaction envelope includes fee, signer infos and memo, but don&#x27;t include <code>Msg</code>s. <code>//</code> denotes comments and are not shown on the Ledger device.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Chain ID: &lt;string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Account number: &lt;uint64&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sequence: &lt;uint64&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Address: &lt;string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Public Key: &lt;Any&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This transaction has &lt;int&gt; Message(s)                       // Pluralize &quot;Message&quot; only when int&gt;1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Message (&lt;int&gt;/&lt;int&gt;): &lt;Any&gt;                              // See value renderers for Any rendering.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End of Message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Memo: &lt;string&gt;                                              // Skipped if no memo set.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fee: &lt;coins&gt;                                                // See value renderers for coins rendering.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Fee payer: &lt;string&gt;                                        // Skipped if no fee_payer set.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Fee granter: &lt;string&gt;                                      // Skipped if no fee_granter set.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tip: &lt;coins&gt;                                                // Skippted if no tip.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tipper: &lt;string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Gas Limit: &lt;uint64&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Timeout Height: &lt;uint64&gt;                                   // Skipped if no timeout_height set.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Other signer: &lt;int&gt; SignerInfo                             // Skipped if the transaction only has 1 signer.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*&gt; Other signer (&lt;int&gt;/&lt;int&gt;): &lt;SignerInfo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*End of other signers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Extension options: &lt;int&gt; Any:                              // Skipped if no body extension options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*&gt; Extension options (&lt;int&gt;/&lt;int&gt;): &lt;Any&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*End of extension options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Non critical extension options: &lt;int&gt; Any:                 // Skipped if no body non critical extension options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*&gt; Non critical extension options (&lt;int&gt;/&lt;int&gt;): &lt;Any&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*End of Non critical extension options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Hash of raw bytes: &lt;hex_string&gt;                            // Hex encoding of bytes defined, to prevent tx hash malleability.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="encoding-of-the-transaction-body">Encoding of the Transaction Body<a href="#encoding-of-the-transaction-body" class="hash-link" aria-label="Direct link to Encoding of the Transaction Body" title="Direct link to Encoding of the Transaction Body">​</a></h3><p>Transaction Body is the <code>Tx.TxBody.Messages</code> field, which is an array of <code>Any</code>s, where each <code>Any</code> packs a <code>sdk.Msg</code>. Since <code>sdk.Msg</code>s are widely used, they have a slightly different encoding than usual array of <code>Any</code>s (Protobuf: <code>repeated google.protobuf.Any</code>) described in Annex 1.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">This transaction has &lt;int&gt; message:   // Optional &#x27;s&#x27; for &quot;message&quot; if there&#x27;s is &gt;1 sdk.Msgs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// For each Msg, print the following 2 lines:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Msg (&lt;int&gt;/&lt;int&gt;): &lt;string&gt;           // E.g. Msg (1/2): bank v1beta1 send coins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;value rendering of Msg struct&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End of transaction messages</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4><p>Given the following Protobuf message:</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">Grant</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">google</span><span class="token positional-class-name class-name punctuation" style="color:#393A34">.</span><span class="token positional-class-name class-name">protobuf</span><span class="token positional-class-name class-name punctuation" style="color:#393A34">.</span><span class="token positional-class-name class-name">Any</span><span class="token plain">       authorization </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cosmos_proto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accepts_interface</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cosmos.authz.v1beta1.Authorization&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">google</span><span class="token positional-class-name class-name punctuation" style="color:#393A34">.</span><span class="token positional-class-name class-name">protobuf</span><span class="token positional-class-name class-name punctuation" style="color:#393A34">.</span><span class="token positional-class-name class-name">Timestamp</span><span class="token plain"> expiration    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gogoproto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stdtime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gogoproto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nullable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">MsgGrant</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">option</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cosmos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">signer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;granter&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> granter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cosmos_proto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">scalar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cosmos.AddressString&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> grantee </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cosmos_proto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">scalar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cosmos.AddressString&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and a transaction containing 1 such <code>sdk.Msg</code>, we get the following encoding:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">This transaction has 1 message:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Msg (1/1): authz v1beta1 grant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Granter: cosmos1abc...def</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Grantee: cosmos1ghi...jkl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End of transaction messages</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="custom-msg-renderers">Custom <code>Msg</code> Renderers<a href="#custom-msg-renderers" class="hash-link" aria-label="Direct link to custom-msg-renderers" title="Direct link to custom-msg-renderers">​</a></h3><p>Application developers may choose to not follow default renderer value output for their own <code>Msg</code>s. In this case, they can implement their own custom <code>Msg</code> renderer. This is similar to <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-4430.md" target="_blank" rel="noopener noreferrer">EIP4430</a>, where the smart contract developer chooses the description string to be shown to the end user.</p><p>This is done by setting the <code>cosmos.msg.textual.v1.expert_custom_renderer</code> Protobuf option to a non-empty string. This option CAN ONLY be set on a Protobuf message representing transaction message object (implementing <code>sdk.Msg</code> interface).</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">MsgFooBar</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Optional comments to describe in human-readable language the formatting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// rules of the custom renderer.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">option</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cosmos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">textual</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">expert_custom_renderer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;unique algorithm identifier&gt;&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// proto fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When this option is set on a <code>Msg</code>, a registered function will transform the <code>Msg</code> into an array of one or more strings, which MAY use the key/value format (described in point #3) with the expert field prefix (described in point #5) and arbitrary indentation (point #6). These strings MAY be rendered from a <code>Msg</code> field using a default value renderer, or they may be generated from several fields using custom logic.</p><p>The <code>&lt;unique algorithm identifier&gt;</code> is a string convention chosen by the application developer and is used to identify the custom <code>Msg</code> renderer. For example, the documentation or specification of this custom algorithm can reference this identifier. This identifier CAN have a versioned suffix (e.g. <code>_v1</code>) to adapt for future changes (which would be consensus-breaking). We also recommend adding Protobuf comments to describe in human language the custom logic used.</p><p>Moreover, the renderer must provide 2 functions: one for formatting from Protobuf to string, and one for parsing string to Protobuf. These 2 functions are provided by the application developer. To satisfy point #1, the parse function MUST be the inverse of the formatting function. This property will not be checked by the SDK at runtime. However, we strongly recommend the application developer to include a comprehensive suite in their app repo to test invertibility, as to not introduce security bugs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="require-signing-over-the-txbody-and-authinfo-raw-bytes">Require signing over the <code>TxBody</code> and <code>AuthInfo</code> raw bytes<a href="#require-signing-over-the-txbody-and-authinfo-raw-bytes" class="hash-link" aria-label="Direct link to require-signing-over-the-txbody-and-authinfo-raw-bytes" title="Direct link to require-signing-over-the-txbody-and-authinfo-raw-bytes">​</a></h3><p>Recall that the transaction bytes merklelized on chain are the Protobuf binary serialization of <a href="hhttps://buf.build/cosmos/cosmos-sdk/docs/main:cosmos.tx.v1beta1#cosmos.tx.v1beta1.TxRaw" target="_blank" rel="noopener noreferrer">TxRaw</a>, which contains the <code>body_bytes</code> and <code>auth_info_bytes</code>. Moreover, the transaction hash is defined as the SHA256 hash of the <code>TxRaw</code> bytes. We require that the user signs over these bytes in SIGN_MODE_TEXTUAL, more specifically over the following string:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">*Hash of raw bytes: &lt;HEX(sha256(len(body_bytes) ++ body_bytes ++ len(auth_info_bytes) ++ auth_info_bytes))&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where:</p><ul><li><code>++</code> denotes concatenation,</li><li><code>HEX</code> is the hexadecimal representation of the bytes, all in capital letters, no <code>0x</code> prefix,</li><li>and <code>len()</code> is encoded as a Big-Endian uint64.</li></ul><p>This is to prevent transaction hash malleability. The point #1 about invertiblity assures that transaction <code>body</code> and <code>auth_info</code> values are not malleable, but the transaction hash still might be malleable with point #1 only, because the SIGN<em>MODE_TEXTUAL strings don&#x27;t follow the byte ordering defined in <code>body_bytes</code> and <code>auth_info_bytes</code>. Without this hash, a malicious validator or exchange could intercept a transaction, modify its transaction hash _after</em> the user signed it using SIGN_MODE_TEXTUAL (by tweaking the byte ordering inside <code>body_bytes</code> or <code>auth_info_bytes</code>), and then submit it to Tendermint.</p><p>By including this hash in the SIGN_MODE_TEXTUAL signing payload, we keep the same level of guarantees as <a href="/main/architecture/adr-020-protobuf-transaction-encoding">SIGN_MODE_DIRECT</a>.</p><p>These bytes are only shown in expert mode, hence the leading <code>*</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="updates-to-the-current-specification">Updates to the current specification<a href="#updates-to-the-current-specification" class="hash-link" aria-label="Direct link to Updates to the current specification" title="Direct link to Updates to the current specification">​</a></h2><p>The current specification is not set in stone, and future iterations are to be expected. We distinguish two categories of updates to this specification:</p><ol><li>Updates that require changes of the hardware device embedded application.</li><li>Updates that only modify the envelope and the value renderers.</li></ol><p>Updates in the 1st category include changes of the <code>Screen</code> struct or its corresponding CBOR encoding. This type of updates require a modification of the hardware signer application, to be able to decode and parse the new types. Backwards-compatibility must also be guaranteed, so that the new hardware application works with existing versions of the SDK. These updates require the coordination of multiple parties: SDK developers, hardware application developers (currently: Zondax), and client-side developers (e.g. CosmJS). Furthermore, a new submission of the hardware device application may be necessary, which, dependending on the vendor, can take some time. As such, we recommend to avoid this type of updates as much as possible.</p><p>Updates in the 2nd category include changes to any of the value renderers or to the transaction envelope. For example, the ordering of fields in the envelope can be swapped, or the timestamp formatting can be modified. Since SIGN_MODE_TEXTUAL sends <code>Screen</code>s to the hardware device, this type of change do not need a hardware wallet application update. They are however state-machine-breaking, and must be documented as such. They require the coordination of SDK developers with client-side developers (e.g. CosmJS), so that the updates are released on both sides close to each other in time.</p><p>We define a spec version, which is an integer that must be incremented on each update of either category. This spec version will be exposed by the SDK&#x27;s implementation, and can be communicated to clients. For example, SDK v0.50 might use the spec version 1, and SDK v0.51 might use 2; thanks to this versioning, clients can know how to craft SIGN_MODE_TEXTUAL transactions based on the target SDK version.</p><p>The current spec version is defined in the &quot;Status&quot; section, on the top of this document. It is initialized to <code>0</code> to allow flexibility in choosing how to define future versions, as it would allow adding a field either in the SignDoc Go struct or in Protobuf in a backwards-compatible way.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-formatting-by-the-hardware-device">Additional Formatting by the Hardware Device<a href="#additional-formatting-by-the-hardware-device" class="hash-link" aria-label="Direct link to Additional Formatting by the Hardware Device" title="Direct link to Additional Formatting by the Hardware Device">​</a></h2><p>See <a href="/main/architecture/adr-050-sign-mode-textual-annex2">annex 2</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h2><ol><li>A minimal MsgSend: <a href="https://github.com/cosmos/cosmos-sdk/blob/094abcd393379acbbd043996024d66cd65246fb1/tx/textual/internal/testdata/e2e.json#L2-L70" target="_blank" rel="noopener noreferrer">see transaction</a>.</li><li>A transaction with a bit of everything: <a href="https://github.com/cosmos/cosmos-sdk/blob/094abcd393379acbbd043996024d66cd65246fb1/tx/textual/internal/testdata/e2e.json#L71-L270" target="_blank" rel="noopener noreferrer">see transaction</a>.</li></ol><p>The examples below are stored in a JSON file with the following fields:</p><ul><li><code>proto</code>: the representation of the transaction in ProtoJSON,</li><li><code>screens</code>: the transaction rendered into SIGN_MODE_TEXTUAL screens,</li><li><code>cbor</code>: the sign bytes of the transaction, which is the CBOR encoding of the screens.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consequences">Consequences<a href="#consequences" class="hash-link" aria-label="Direct link to Consequences" title="Direct link to Consequences">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backwards-compatibility">Backwards Compatibility<a href="#backwards-compatibility" class="hash-link" aria-label="Direct link to Backwards Compatibility" title="Direct link to Backwards Compatibility">​</a></h3><p>SIGN_MODE_TEXTUAL is purely additive, and doesn&#x27;t break any backwards compatibility with other sign modes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="positive">Positive<a href="#positive" class="hash-link" aria-label="Direct link to Positive" title="Direct link to Positive">​</a></h3><ul><li>Human-friendly way of signing in hardware devices.</li><li>Once SIGN_MODE_TEXTUAL is shipped, SIGN_MODE_LEGACY_AMINO_JSON can be deprecated and removed. On the longer term, once the ecosystem has totally migrated, Amino can be totally removed.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="negative">Negative<a href="#negative" class="hash-link" aria-label="Direct link to Negative" title="Direct link to Negative">​</a></h3><ul><li>Some fields are still encoded in non-human-readable ways, such as public keys in hexadecimal.</li><li>New ledger app needs to be released, still unclear</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="neutral">Neutral<a href="#neutral" class="hash-link" aria-label="Direct link to Neutral" title="Direct link to Neutral">​</a></h3><ul><li>If the transaction is complex, the string array can be arbitrarily long, and some users might just skip some screens and blind sign.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="further-discussions">Further Discussions<a href="#further-discussions" class="hash-link" aria-label="Direct link to Further Discussions" title="Direct link to Further Discussions">​</a></h2><ul><li>Some details on value renderers need to be polished, see <a href="/main/architecture/adr-050-sign-mode-textual-annex1">Annex 1</a>.</li><li>Are ledger apps able to support both SIGN_MODE_LEGACY_AMINO_JSON and SIGN_MODE_TEXTUAL at the same time?</li><li>Open question: should we add a Protobuf field option to allow app developers to overwrite the textual representation of certain Protobuf fields and message? This would be similar to Ethereum&#x27;s <a href="https://github.com/ethereum/EIPs/pull/4430" target="_blank" rel="noopener noreferrer">EIP4430</a>, where the contract developer decides on the textual representation.</li><li>Internationalization.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2><ul><li><p><a href="/main/architecture/adr-050-sign-mode-textual-annex1">Annex 1</a></p></li><li><p>Initial discussion: <a href="https://github.com/cosmos/cosmos-sdk/issues/6513" target="_blank" rel="noopener noreferrer">https://github.com/cosmos/cosmos-sdk/issues/6513</a></p></li><li><p>Living document used in the working group: <a href="https://hackmd.io/fsZAO-TfT0CKmLDtfMcKeA?both" target="_blank" rel="noopener noreferrer">https://hackmd.io/fsZAO-TfT0CKmLDtfMcKeA?both</a></p></li><li><p>Working group meeting notes: <a href="https://hackmd.io/7RkGfv_rQAaZzEigUYhcXw" target="_blank" rel="noopener noreferrer">https://hackmd.io/7RkGfv_rQAaZzEigUYhcXw</a></p></li><li><p>Ethereum&#x27;s &quot;Described Transactions&quot; <a href="https://github.com/ethereum/EIPs/pull/4430" target="_blank" rel="noopener noreferrer">https://github.com/ethereum/EIPs/pull/4430</a></p></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/main/architecture/adr-050-sign-mode-textual-annex2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ADR 050: SIGN_MODE_TEXTUAL: Annex 2 XXX</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/main/architecture/adr-053-go-module-refactoring"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ADR 053: Go Module Refactoring</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#changelog" class="table-of-contents__link toc-highlight">Changelog</a></li><li><a href="#status" class="table-of-contents__link toc-highlight">Status</a></li><li><a href="#abstract" class="table-of-contents__link toc-highlight">Abstract</a></li><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#decision" class="table-of-contents__link toc-highlight">Decision</a><ul><li><a href="#invertible-rendering" class="table-of-contents__link toc-highlight">Invertible Rendering</a></li><li><a href="#chain-state" class="table-of-contents__link toc-highlight">Chain State</a></li><li><a href="#signature-and-security" class="table-of-contents__link toc-highlight">Signature and Security</a></li><li><a href="#transaction-hash-malleability" class="table-of-contents__link toc-highlight">Transaction Hash Malleability</a></li><li><a href="#signdoc" class="table-of-contents__link toc-highlight">SignDoc</a></li></ul></li><li><a href="#details" class="table-of-contents__link toc-highlight">Details</a><ul><li><a href="#encoding-of-the-transaction-envelope" class="table-of-contents__link toc-highlight">Encoding of the Transaction Envelope</a></li><li><a href="#encoding-of-the-transaction-body" class="table-of-contents__link toc-highlight">Encoding of the Transaction Body</a></li><li><a href="#custom-msg-renderers" class="table-of-contents__link toc-highlight">Custom <code>Msg</code> Renderers</a></li><li><a href="#require-signing-over-the-txbody-and-authinfo-raw-bytes" class="table-of-contents__link toc-highlight">Require signing over the <code>TxBody</code> and <code>AuthInfo</code> raw bytes</a></li></ul></li><li><a href="#updates-to-the-current-specification" class="table-of-contents__link toc-highlight">Updates to the current specification</a></li><li><a href="#additional-formatting-by-the-hardware-device" class="table-of-contents__link toc-highlight">Additional Formatting by the Hardware Device</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li><li><a href="#consequences" class="table-of-contents__link toc-highlight">Consequences</a><ul><li><a href="#backwards-compatibility" class="table-of-contents__link toc-highlight">Backwards Compatibility</a></li><li><a href="#positive" class="table-of-contents__link toc-highlight">Positive</a></li><li><a href="#negative" class="table-of-contents__link toc-highlight">Negative</a></li><li><a href="#neutral" class="table-of-contents__link toc-highlight">Neutral</a></li></ul></li><li><a href="#further-discussions" class="table-of-contents__link toc-highlight">Further Discussions</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://cosmos.network"><img src="/img/logo-bw.svg" alt="Cosmos Logo"></a></li></ul></div><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://hub.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cosmos Hub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.cometbft.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">CometBFT<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ibc.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBC Go<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/cosmosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://reddit.com/r/cosmosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/cosmosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/cosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/c/CosmosProject" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/cosmosproject" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p>The development of the Cosmos SDK is led primarily by <a href="https://interchain.io/ecosystem">Interchain Core Teams</a>. Funding for this development comes primarily from the Interchain Foundation, a Swiss non-profit.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.375ada2f.js"></script>
<script src="/assets/js/main.e8d6e5a5.js"></script>
</body>
</html>