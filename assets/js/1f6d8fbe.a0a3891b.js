"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[3002],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=o.createContext({}),l=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=l(e.components);return o.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,p=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=l(n),c=a,h=u["".concat(p,".").concat(c)]||u[c]||m[c]||i;return n?o.createElement(h,r(r({ref:t},d),{},{components:n})):o.createElement(h,r({ref:t},d))}));function c(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=u;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var l=2;l<i;l++)r[l]=n[l];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},57633:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var o=n(87462),a=(n(67294),n(3905));const i={},r="Upgrading Cosmos SDK",s={unversionedId:"migrations/upgrading",id:"version-v0.47/migrations/upgrading",title:"Upgrading Cosmos SDK",description:"This guide provides instructions for upgrading to specific versions of Cosmos SDK.",source:"@site/versioned_docs/version-v0.47/migrations/02-upgrading.md",sourceDirName:"migrations",slug:"/migrations/upgrading",permalink:"/v0.47/migrations/upgrading",draft:!1,tags:[],version:"v0.47",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"SDK Migrations",permalink:"/v0.47/migrations/intro"},next:{title:"List of Modules",permalink:"/v0.47/modules"}},p={},l=[{value:"v0.47.x",id:"v047x",level:2},{value:"Migration to CometBFT (Part 1)",id:"migration-to-cometbft-part-1",level:3},{value:"Simulation",id:"simulation",level:3},{value:"gRPC",id:"grpc",level:3},{value:"AppModule Interface",id:"appmodule-interface",level:3},{value:"SimApp",id:"simapp",level:3},{value:"App Wiring",id:"app-wiring",level:4},{value:"Constructor",id:"constructor",level:4},{value:"Encoding",id:"encoding",level:4},{value:"Export",id:"export",level:4},{value:"Replaces",id:"replaces",level:4},{value:"Protobuf",id:"protobuf",level:3},{value:"Gogoproto Import Paths",id:"gogoproto-import-paths",level:4},{value:"<code>{accepts,implements}_interface</code> proto annotations",id:"acceptsimplements_interface-proto-annotations",level:4},{value:"Transactions",id:"transactions",level:3},{value:"Broadcast Mode",id:"broadcast-mode",level:4},{value:"Modules",id:"modules",level:3},{value:"<code>**all**</code>",id:"all",level:4},{value:"<code>x/params</code>",id:"xparams",level:4},{value:"<code>x/crisis</code>",id:"xcrisis",level:4},{value:"<code>x/gov</code>",id:"xgov",level:4},{value:"Minimum Proposal Deposit At Time of Submission",id:"minimum-proposal-deposit-at-time-of-submission",level:5},{value:"New <code>Proposal.Proposer</code> field",id:"new-proposalproposer-field",level:5},{value:"<code>x/consensus</code>",id:"xconsensus",level:4},{value:"<code>app.go</code> changes",id:"appgo-changes",level:5},{value:"<code>x/nft</code>",id:"xnft",level:4},{value:"Ledger",id:"ledger",level:3}],d={toc:l};function m(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"upgrading-cosmos-sdk"},"Upgrading Cosmos SDK"),(0,a.kt)("p",null,"This guide provides instructions for upgrading to specific versions of Cosmos SDK."),(0,a.kt)("h2",{id:"v047x"},(0,a.kt)("a",{parentName:"h2",href:"https://github.com/cosmos/cosmos-sdk/releases/tag/v0.47.0"},"v0.47.x")),(0,a.kt)("h3",{id:"migration-to-cometbft-part-1"},"Migration to CometBFT (Part 1)"),(0,a.kt)("p",null,"The Cosmos SDK has migrated to CometBFT, as its default consensus engine.\nCometBFT is an implementation of the Tendermint consensus algorithm, and the successor of Tendermint Core.\nDue to the import changes, this is a breaking change. Chains need to remove ",(0,a.kt)("strong",{parentName:"p"},"entirely")," their imports of Tendermint Core in their codebase, from direct and indirects imports in their ",(0,a.kt)("inlineCode",{parentName:"p"},"go.mod"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Replace ",(0,a.kt)("inlineCode",{parentName:"li"},"github.com/tendermint/tendermint")," by ",(0,a.kt)("inlineCode",{parentName:"li"},"github.com/cometbft/cometbft")),(0,a.kt)("li",{parentName:"ul"},"Replace ",(0,a.kt)("inlineCode",{parentName:"li"},"github.com/tendermint/tm-db")," by ",(0,a.kt)("inlineCode",{parentName:"li"},"github.com/cometbft/cometbft-db")),(0,a.kt)("li",{parentName:"ul"},"Verify ",(0,a.kt)("inlineCode",{parentName:"li"},"github.com/tendermint/tendermint")," is not an indirect or direct dependency"),(0,a.kt)("li",{parentName:"ul"},"Run ",(0,a.kt)("inlineCode",{parentName:"li"},"make proto-gen"))),(0,a.kt)("p",null,"Other than that, the migration should be seamless.\nOn the SDK side, clean-up of variables, functions to reflect the new name will only happen from v0.48 (part 2)."),(0,a.kt)("p",null,"Note: It is possible that these steps must first be performed by your dependencies before you can perform them on your own codebase."),(0,a.kt)("h3",{id:"simulation"},"Simulation"),(0,a.kt)("p",null,"Remove ",(0,a.kt)("inlineCode",{parentName:"p"},"RandomizedParams")," from ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModuleSimulation")," interface. Previously, it used to generate random parameter changes during simulations, however, it does so through ParamChangeProposal which is now legacy. Since all modules were migrated, we can now safely remove this from ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModuleSimulation")," interface."),(0,a.kt)("p",null,"Moreover, to support the ",(0,a.kt)("inlineCode",{parentName:"p"},"MsgUpdateParams")," governance proposals for each modules, ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModuleSimulation")," now defines a ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModule.ProposalMsgs")," method in addition to ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModule.ProposalContents"),". That method defines the messages that can be used to submit a proposal and that should be tested in simulation."),(0,a.kt)("p",null,"When a module has no proposal messages or proposal content to be tested by simulation, the ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModule.ProposalMsgs")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModule.ProposalContents")," methods can be deleted."),(0,a.kt)("h3",{id:"grpc"},"gRPC"),(0,a.kt)("p",null,"A new gRPC service, ",(0,a.kt)("inlineCode",{parentName:"p"},"proto/cosmos/base/node/v1beta1/query.proto"),", has been introduced\nwhich exposes various operator configuration. App developers should be sure to\nregister the service with the gRPC-gateway service via\n",(0,a.kt)("inlineCode",{parentName:"p"},"nodeservice.RegisterGRPCGatewayRoutes")," in their application construction, which\nis typically found in ",(0,a.kt)("inlineCode",{parentName:"p"},"RegisterAPIRoutes"),"."),(0,a.kt)("h3",{id:"appmodule-interface"},"AppModule Interface"),(0,a.kt)("p",null,"Support for the ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModule")," ",(0,a.kt)("inlineCode",{parentName:"p"},"Querier"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Route")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"LegacyQuerier")," methods has been entirely removed from the ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModule"),"\ninterface. This removes and fully deprecates all legacy queriers. All modules no longer support the REST API previously\nknown as the LCD, and the ",(0,a.kt)("inlineCode",{parentName:"p"},"sdk.Msg#Route")," method won't be used anymore."),(0,a.kt)("p",null,"Most other existing ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModule")," methods have been moved to extension interfaces in preparation for the migration\nto the ",(0,a.kt)("inlineCode",{parentName:"p"},"cosmossdk.io/core/appmodule")," API in the next release. Most ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModule")," implementations should not be broken\nby this change."),(0,a.kt)("h3",{id:"simapp"},"SimApp"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"simapp")," package ",(0,a.kt)("strong",{parentName:"p"},"should not be imported in your own app"),". Instead, you should import the ",(0,a.kt)("inlineCode",{parentName:"p"},"runtime.AppI")," interface, that defines an ",(0,a.kt)("inlineCode",{parentName:"p"},"App"),", and use the ",(0,a.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/cosmos/cosmos-sdk/testutil/sims"},(0,a.kt)("inlineCode",{parentName:"a"},"simtestutil")," package")," for application testing."),(0,a.kt)("h4",{id:"app-wiring"},"App Wiring"),(0,a.kt)("p",null,"SimApp's ",(0,a.kt)("inlineCode",{parentName:"p"},"app_v2.go")," is using ",(0,a.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/building-apps/app-go-v2"},"App Wiring"),", the dependency injection framework of the Cosmos SDK.\nThis means that modules are injected directly into SimApp thanks to a ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/simapp/app_config.go"},"configuration file"),".\nThe previous behavior, without the dependency injection framework, is still present in ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/simapp/app.go"},(0,a.kt)("inlineCode",{parentName:"a"},"app.go"))," and is not going anywhere."),(0,a.kt)("p",null,"If you are using a ",(0,a.kt)("inlineCode",{parentName:"p"},"app.go")," without dependency injection, add the following lines to your ",(0,a.kt)("inlineCode",{parentName:"p"},"app.go")," in order to provide newer gRPC services:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"autocliv1.RegisterQueryServer(app.GRPCQueryRouter(), runtimeservices.NewAutoCLIQueryService(app.ModuleManager.Modules))\n\nreflectionSvc, err := runtimeservices.NewReflectionService()\nif err != nil {\n    panic(err)\n}\nreflectionv1.RegisterReflectionServiceServer(app.GRPCQueryRouter(), reflectionSvc)\n")),(0,a.kt)("h4",{id:"constructor"},"Constructor"),(0,a.kt)("p",null,"The constructor, ",(0,a.kt)("inlineCode",{parentName:"p"},"NewSimApp")," has been simplified:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"NewSimApp")," does not take encoding parameters (",(0,a.kt)("inlineCode",{parentName:"li"},"encodingConfig"),") as input, instead the encoding parameters are injected (when using app wiring), or directly created in the constructor. Instead, we can instantiate ",(0,a.kt)("inlineCode",{parentName:"li"},"SimApp")," for getting the encoding configuration."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"NewSimApp")," now uses ",(0,a.kt)("inlineCode",{parentName:"li"},"AppOptions")," for getting the home path (",(0,a.kt)("inlineCode",{parentName:"li"},"homePath"),") and the invariant checks period (",(0,a.kt)("inlineCode",{parentName:"li"},"invCheckPeriod"),"). These were unnecessary given as arguments as they were already present in the ",(0,a.kt)("inlineCode",{parentName:"li"},"AppOptions"),".")),(0,a.kt)("h4",{id:"encoding"},"Encoding"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"simapp.MakeTestEncodingConfig()")," was deprecated and has been removed. Instead you can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"TestEncodingConfig")," from the ",(0,a.kt)("inlineCode",{parentName:"p"},"types/module/testutil")," package.\nThis means you can replace your usage of ",(0,a.kt)("inlineCode",{parentName:"p"},"simapp.MakeTestEncodingConfig")," in tests to ",(0,a.kt)("inlineCode",{parentName:"p"},"moduletestutil.MakeTestEncodingConfig"),", which takes a series of relevant ",(0,a.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," as input (the module being tested and any potential dependencies)."),(0,a.kt)("h4",{id:"export"},"Export"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"ExportAppStateAndValidators")," takes an extra argument, ",(0,a.kt)("inlineCode",{parentName:"p"},"modulesToExport"),", which is a list of module names to export.\nThat argument should be passed to the module maanager ",(0,a.kt)("inlineCode",{parentName:"p"},"ExportGenesisFromModules")," method."),(0,a.kt)("h4",{id:"replaces"},"Replaces"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"GoLevelDB")," version must pinned to ",(0,a.kt)("inlineCode",{parentName:"p"},"v1.0.1-0.20210819022825-2ae1ddf74ef7")," in the application, following versions might cause unexpected behavior.\nThis can be done adding ",(0,a.kt)("inlineCode",{parentName:"p"},"replace github.com/syndtr/goleveldb => github.com/syndtr/goleveldb v1.0.1-0.20210819022825-2ae1ddf74ef7")," to the ",(0,a.kt)("inlineCode",{parentName:"p"},"go.mod")," file."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/cosmos/cosmos-sdk/issues/14949"},"issue #14949 on cosmos-sdk")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/ethereum/go-ethereum/pull/25413"},"issue #25413 on go-ethereum"))),(0,a.kt)("h3",{id:"protobuf"},"Protobuf"),(0,a.kt)("p",null,"The SDK has migrated from ",(0,a.kt)("inlineCode",{parentName:"p"},"gogo/protobuf")," (which is currently unmaintained), to our own maintained fork, ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/cosmos/gogoproto"},(0,a.kt)("inlineCode",{parentName:"a"},"cosmos/gogoproto")),"."),(0,a.kt)("p",null,"This means you should replace all imports of ",(0,a.kt)("inlineCode",{parentName:"p"},"github.com/gogo/protobuf")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"github.com/cosmos/gogoproto"),".\nThis allows you to remove the replace directive ",(0,a.kt)("inlineCode",{parentName:"p"},"replace github.com/gogo/protobuf => github.com/regen-network/protobuf v1.3.3-alpha.regen.1")," from your ",(0,a.kt)("inlineCode",{parentName:"p"},"go.mod")," file."),(0,a.kt)("p",null,"Please use the ",(0,a.kt)("inlineCode",{parentName:"p"},"ghcr.io/cosmos/proto-builder")," image (version >= ",(0,a.kt)("inlineCode",{parentName:"p"},"0.11.5"),") for generating protobuf files."),(0,a.kt)("p",null,"See which buf commit for ",(0,a.kt)("inlineCode",{parentName:"p"},"cosmos/cosmos-sdk")," to pin in your ",(0,a.kt)("inlineCode",{parentName:"p"},"buf.yaml")," file ",(0,a.kt)("a",{parentName:"p",href:"./proto/README.md"},"here"),"."),(0,a.kt)("h4",{id:"gogoproto-import-paths"},"Gogoproto Import Paths"),(0,a.kt)("p",null,"The SDK made a ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/cosmos/gogoproto/pull/32"},"patch fix")," on its gogoproto repository to require that each proto file's package name matches its OS import path (relatively to a protobuf root import path, usually the root ",(0,a.kt)("inlineCode",{parentName:"p"},"proto/")," folder, set by the ",(0,a.kt)("inlineCode",{parentName:"p"},"protoc -I")," flag)."),(0,a.kt)("p",null,"For example, assuming you put all your proto files in subfolders inside your root ",(0,a.kt)("inlineCode",{parentName:"p"},"proto/")," folder, then a proto file with package name ",(0,a.kt)("inlineCode",{parentName:"p"},"myapp.mymodule.v1")," should be found in the ",(0,a.kt)("inlineCode",{parentName:"p"},"proto/myapp/mymodule/v1/")," folder. If it is in another folder, the proto generation command will throw an error."),(0,a.kt)("p",null,"If you are using a custom folder structure for your proto files, please reorganize them so that their OS path matches their proto package name."),(0,a.kt)("p",null,"This is to allow the proto FileDescriptSets to be correctly registered, and this standardized OS import paths allows ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/tree/main/tools/hubl"},"Hubl")," to reflectively talk to any chain."),(0,a.kt)("h4",{id:"acceptsimplements_interface-proto-annotations"},(0,a.kt)("inlineCode",{parentName:"h4"},"{accepts,implements}_interface")," proto annotations"),(0,a.kt)("p",null,"The SDK is normalizing the strings inside the Protobuf ",(0,a.kt)("inlineCode",{parentName:"p"},"accepts_interface")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"implements_interface")," annotations. We require them to be fully-scoped names. They will soon be used by code generators like Pulsar and Telescope to match which messages can or cannot be packed inside ",(0,a.kt)("inlineCode",{parentName:"p"},"Any"),"s."),(0,a.kt)("p",null,"Here are the following replacements that you need to perform on your proto files:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},'- "Content"\n+ "cosmos.gov.v1beta1.Content"\n- "Authorization"\n+ "cosmos.authz.v1beta1.Authorization"\n- "sdk.Msg"\n+ "cosmos.base.v1beta1.Msg"\n- "AccountI"\n+ "cosmos.auth.v1beta1.AccountI"\n- "ModuleAccountI"\n+ "cosmos.auth.v1beta1.ModuleAccountI"\n- "FeeAllowanceI"\n+ "cosmos.feegrant.v1beta1.FeeAllowanceI"\n')),(0,a.kt)("p",null,"Please also check that in your own app's proto files that there are no single-word names for those two proto annotations. If so, then replace them with fully-qualified names, even though those names don't actually resolve to an actual protobuf entity."),(0,a.kt)("p",null,"For more information, see the ",(0,a.kt)("a",{parentName:"p",href:"./docs/docs/core/05-encoding.md"},"encoding guide"),"."),(0,a.kt)("h3",{id:"transactions"},"Transactions"),(0,a.kt)("h4",{id:"broadcast-mode"},"Broadcast Mode"),(0,a.kt)("p",null,"Broadcast mode ",(0,a.kt)("inlineCode",{parentName:"p"},"block")," was deprecated and has been removed. Please use ",(0,a.kt)("inlineCode",{parentName:"p"},"sync")," mode\ninstead. When upgrading your tests from ",(0,a.kt)("inlineCode",{parentName:"p"},"block")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"sync")," and checking for a\ntransaction code, you need to query the transaction first (with its hash) to get\nthe correct code."),(0,a.kt)("h3",{id:"modules"},"Modules"),(0,a.kt)("h4",{id:"all"},(0,a.kt)("inlineCode",{parentName:"h4"},"**all**")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"EventTypeMessage")," events, with ",(0,a.kt)("inlineCode",{parentName:"p"},"sdk.AttributeKeyModule")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"sdk.AttributeKeySender")," are now emitted directly at message excecution (in ",(0,a.kt)("inlineCode",{parentName:"p"},"baseapp"),").\nThis means that the following boilerplate should be removed from all your custom modules:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"ctx.EventManager().EmitEvent(\n    sdk.NewEvent(\n        sdk.EventTypeMessage,\n        sdk.NewAttribute(sdk.AttributeKeyModule, types.AttributeValueCategory),\n        sdk.NewAttribute(sdk.AttributeKeySender, `signer/sender`),\n    ),\n)\n")),(0,a.kt)("p",null,"The module name is assumed by ",(0,a.kt)("inlineCode",{parentName:"p"},"baseapp")," to be the second element of the message route: ",(0,a.kt)("inlineCode",{parentName:"p"},'"cosmos.bank.v1beta1.MsgSend" -> "bank"'),".\nIn case a module does not follow the standard message path, (e.g. IBC), it is advised to keep emitting the module name event.\n",(0,a.kt)("inlineCode",{parentName:"p"},"Baseapp")," only emits that event if the module has not already done so."),(0,a.kt)("h4",{id:"xparams"},(0,a.kt)("inlineCode",{parentName:"h4"},"x/params")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"params")," module was deprecated since v0.46. The Cosmos SDK has migrated away from ",(0,a.kt)("inlineCode",{parentName:"p"},"x/params")," for its own modules.\nCosmos SDK modules now store their parameters directly in its repective modules.\nThe ",(0,a.kt)("inlineCode",{parentName:"p"},"params")," module will be removed in ",(0,a.kt)("inlineCode",{parentName:"p"},"v0.48"),", as mentioned ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.46.1/UPGRADING.md#xparams"},"in v0.46 release"),". It is strongly encouraged to migrate away from ",(0,a.kt)("inlineCode",{parentName:"p"},"x/params")," before ",(0,a.kt)("inlineCode",{parentName:"p"},"v0.48"),"."),(0,a.kt)("p",null,"When performing a chain migration, the params table must be initizalied manually. This was done in the modules keepers in previous versions.\nHave a look at ",(0,a.kt)("inlineCode",{parentName:"p"},"simapp.RegisterUpgradeHandlers()")," for an example."),(0,a.kt)("h4",{id:"xcrisis"},(0,a.kt)("inlineCode",{parentName:"h4"},"x/crisis")),(0,a.kt)("p",null,"With the migrations of all modules away from ",(0,a.kt)("inlineCode",{parentName:"p"},"x/params"),", the crisis module now has a store.\nThe store must be created during a chain upgrade to v0.47.x."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"storetypes.StoreUpgrades{\n    Added: []string{\n        crisistypes.ModuleName,\n    },\n}\n")),(0,a.kt)("h4",{id:"xgov"},(0,a.kt)("inlineCode",{parentName:"h4"},"x/gov")),(0,a.kt)("h5",{id:"minimum-proposal-deposit-at-time-of-submission"},"Minimum Proposal Deposit At Time of Submission"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"gov")," module has been updated to support a minimum proposal deposit at submission time. It is determined by a new\nparameter called ",(0,a.kt)("inlineCode",{parentName:"p"},"MinInitialDepositRatio"),". When multiplied by the existing ",(0,a.kt)("inlineCode",{parentName:"p"},"MinDeposit")," parameter, it produces\nthe necessary proportion of coins needed at the proposal submission time. The motivation for this change is to prevent proposal spamming."),(0,a.kt)("p",null,"By default, the new ",(0,a.kt)("inlineCode",{parentName:"p"},"MinInitialDepositRatio")," parameter is set to zero during migration. The value of zero signifies that this\nfeature is disabled. If chains wish to utilize the minimum proposal deposits at time of submission, the migration logic needs to be\nmodified to set the new parameter to the desired value."),(0,a.kt)("h5",{id:"new-proposalproposer-field"},"New ",(0,a.kt)("inlineCode",{parentName:"h5"},"Proposal.Proposer")," field"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"Proposal")," proto has been updated with proposer field. For proposal state migraton developers can call ",(0,a.kt)("inlineCode",{parentName:"p"},"v4.AddProposerAddressToProposal")," in their upgrade handler to update all existing proposal and make them compatible and ",(0,a.kt)("strong",{parentName:"p"},"this migration is optional"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n    sdk "github.com/cosmos/cosmos-sdk/types"\n    "github.com/cosmos/cosmos-sdk/types/module"\n    v4 "github.com/cosmos/cosmos-sdk/x/gov/migrations/v4"\n    upgradetypes "github.com/cosmos/cosmos-sdk/x/upgrade/types"\n)\n\nfunc (app SimApp) RegisterUpgradeHandlers() {\n    app.UpgradeKeeper.SetUpgradeHandler(UpgradeName,\n        func(ctx sdk.Context, plan upgradetypes.Plan, fromVM module.VersionMap) (module.VersionMap, error) {\n            // this migration is optional\n            // add proposal ids with proposers which are active (deposit or voting period)\n            proposals := make(map[uint64]string)\n            proposals[1] = "cosmos1luyncewxk4lm24k6gqy8y5dxkj0klr4tu0lmnj" ...\n            v4.AddProposerAddressToProposal(ctx, sdk.NewKVStoreKey(v4.ModuleName), app.appCodec, proposals)\n            return app.ModuleManager.RunMigrations(ctx, app.Configurator(), fromVM)\n        })\n}\n\n')),(0,a.kt)("h4",{id:"xconsensus"},(0,a.kt)("inlineCode",{parentName:"h4"},"x/consensus")),(0,a.kt)("p",null,"Introducing a new ",(0,a.kt)("inlineCode",{parentName:"p"},"x/consensus")," module to handle managing Tendermint consensus\nparameters. For migration it is required to call a specific migration to migrate\nexisting parameters from the deprecated ",(0,a.kt)("inlineCode",{parentName:"p"},"x/params")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"x/consensus")," module. App\ndevelopers should ensure to call ",(0,a.kt)("inlineCode",{parentName:"p"},"baseapp.MigrateParams")," in their upgrade handler."),(0,a.kt)("p",null,"Example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"func (app SimApp) RegisterUpgradeHandlers() {\n    ----\x3e baseAppLegacySS := app.ParamsKeeper.Subspace(baseapp.Paramspace).WithKeyTable(paramstypes.ConsensusParamsKeyTable()) <----\n\n    app.UpgradeKeeper.SetUpgradeHandler(\n        UpgradeName,\n        func(ctx sdk.Context, _ upgradetypes.Plan, fromVM module.VersionMap) (module.VersionMap, error) {\n            // Migrate Tendermint consensus parameters from x/params module to a\n            // dedicated x/consensus module.\n            ----\x3e baseapp.MigrateParams(ctx, baseAppLegacySS, &app.ConsensusParamsKeeper) <----\n\n            // ...\n\n            return app.ModuleManager.RunMigrations(ctx, app.Configurator(), fromVM)\n        },\n    )\n\n  // ...\n}\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"x/params")," module should still be imported in your app.go in order to handle this migration."),(0,a.kt)("p",null,"Because the ",(0,a.kt)("inlineCode",{parentName:"p"},"x/consensus")," module is a new module, its store must be added while upgrading to v0.47.x:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"storetypes.StoreUpgrades{\n    Added: []string{\n        consensustypes.ModuleName,\n    },\n}\n")),(0,a.kt)("h5",{id:"appgo-changes"},(0,a.kt)("inlineCode",{parentName:"h5"},"app.go")," changes"),(0,a.kt)("p",null,"When using an ",(0,a.kt)("inlineCode",{parentName:"p"},"app.go")," without App Wiring, the following changes are required:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},"- bApp.SetParamStore(app.ParamsKeeper.Subspace(baseapp.Paramspace).WithKeyTable(paramstypes.ConsensusParamsKeyTable()))\n+ app.ConsensusParamsKeeper = consensusparamkeeper.NewKeeper(appCodec, keys[consensusparamstypes.StoreKey], authtypes.NewModuleAddress(govtypes.ModuleName).String())\n+ bApp.SetParamStore(&app.ConsensusParamsKeeper)\n")),(0,a.kt)("p",null,"When using App Wiring, the paramater store is automatically set for you."),(0,a.kt)("h4",{id:"xnft"},(0,a.kt)("inlineCode",{parentName:"h4"},"x/nft")),(0,a.kt)("p",null,"The SDK does not validate anymore the ",(0,a.kt)("inlineCode",{parentName:"p"},"classID")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"nftID")," of an NFT, for extra flexibility in your NFT implementation.\nThis means chain developers need to validate the ",(0,a.kt)("inlineCode",{parentName:"p"},"classID")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"nftID")," of an NFT."),(0,a.kt)("h3",{id:"ledger"},"Ledger"),(0,a.kt)("p",null,"Ledger support has been generalized to enable use of different apps and keytypes that use ",(0,a.kt)("inlineCode",{parentName:"p"},"secp256k1"),". The Ledger interface remains the same, but it can now be provided through the Keyring ",(0,a.kt)("inlineCode",{parentName:"p"},"Options"),", allowing higher-level chains to connect to different Ledger apps or use custom implementations. In addition, higher-level chains can provide custom key implementations around the Ledger public key, to enable greater flexibility with address generation and signing."),(0,a.kt)("p",null,"This is not a breaking change, as all values will default to use the standard Cosmos app implementation unless specified otherwise."))}m.isMDXComponent=!0}}]);