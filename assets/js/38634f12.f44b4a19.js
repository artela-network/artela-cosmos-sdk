"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[9252],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(n),c=o,h=u["".concat(s,".").concat(c)]||u[c]||m[c]||i;return n?a.createElement(h,r(r({ref:t},d),{},{components:n})):a.createElement(h,r({ref:t},d))}));function c(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},71479:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(87462),o=(n(67294),n(3905));const i={},r="Upgrading Cosmos SDK",l={unversionedId:"migrations/upgrading",id:"migrations/upgrading",title:"Upgrading Cosmos SDK",description:"This guide provides instructions for upgrading to specific versions of Cosmos SDK.",source:"@site/docs/migrations/02-upgrading.md",sourceDirName:"migrations",slug:"/migrations/upgrading",permalink:"/main/migrations/upgrading",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"SDK Migrations",permalink:"/main/migrations/intro"},next:{title:"List of Modules",permalink:"/main/modules"}},s={},p=[{value:"Unreleased",id:"unreleased",level:2},{value:"Migration to Collections",id:"migration-to-collections",level:3},{value:"v0.50.x",id:"v050x",level:2},{value:"Migration to CometBFT (Part 2)",id:"migration-to-cometbft-part-2",level:3},{value:"Enable Vote Extensions",id:"enable-vote-extensions",level:4},{value:"BaseApp",id:"baseapp",level:3},{value:"Events",id:"events",level:4},{value:"Config files",id:"config-files",level:3},{value:"gRPC-Web",id:"grpc-web",level:4},{value:"Database Support",id:"database-support",level:4},{value:"Protobuf",id:"protobuf",level:3},{value:"Stringer",id:"stringer",level:4},{value:"SimApp",id:"simapp",level:3},{value:"Module Assertions",id:"module-assertions",level:4},{value:"Module wiring",id:"module-wiring",level:4},{value:"Logger",id:"logger",level:4},{value:"Module Basics",id:"module-basics",level:4},{value:"AutoCLI",id:"autocli",level:4},{value:"Packages",id:"packages",level:3},{value:"Math",id:"math",level:4},{value:"Store",id:"store",level:4},{value:"Extract Store to a standalone module",id:"extract-store-to-a-standalone-module",level:5},{value:"Streaming",id:"streaming",level:5},{value:"Client",id:"client",level:4},{value:"Modules",id:"modules",level:3},{value:"<code>**all**</code>",id:"all",level:4},{value:"<code>x/auth</code>",id:"xauth",level:4},{value:"<code>x/capability</code>",id:"xcapability",level:4},{value:"<code>x/gov</code>",id:"xgov",level:4},{value:"Expedited Proposals",id:"expedited-proposals",level:5},{value:"Cancelling Proposals",id:"cancelling-proposals",level:5},{value:"<code>x/evidence</code>",id:"xevidence",level:4},{value:"Extract evidence to a standalone module",id:"extract-evidence-to-a-standalone-module",level:5},{value:"<code>x/nft</code>",id:"xnft",level:4},{value:"Extract nft to a standalone module",id:"extract-nft-to-a-standalone-module",level:5},{value:"x/feegrant",id:"xfeegrant",level:4},{value:"Extract feegrant to a standalone module",id:"extract-feegrant-to-a-standalone-module",level:5},{value:"<code>x/upgrade</code>",id:"xupgrade",level:4},{value:"Extract upgrade to a standalone module",id:"extract-upgrade-to-a-standalone-module",level:5},{value:"Tooling",id:"tooling",level:3},{value:"Rosetta",id:"rosetta",level:4},{value:"v0.47.x",id:"v047x",level:2},{value:"Migration to CometBFT (Part 1)",id:"migration-to-cometbft-part-1",level:3},{value:"Simulation",id:"simulation",level:3},{value:"gRPC",id:"grpc",level:3},{value:"AppModule Interface",id:"appmodule-interface",level:3},{value:"SimApp",id:"simapp-1",level:3},{value:"App Wiring",id:"app-wiring",level:4},{value:"Constructor",id:"constructor",level:4},{value:"Encoding",id:"encoding",level:4},{value:"Export",id:"export",level:4},{value:"Replaces",id:"replaces",level:4},{value:"Protobuf",id:"protobuf-1",level:3},{value:"Gogoproto Import Paths",id:"gogoproto-import-paths",level:4},{value:"<code>{accepts,implements}_interface</code> proto annotations",id:"acceptsimplements_interface-proto-annotations",level:4},{value:"Transactions",id:"transactions",level:3},{value:"Broadcast Mode",id:"broadcast-mode",level:4},{value:"Modules",id:"modules-1",level:3},{value:"<code>**all**</code>",id:"all-1",level:4},{value:"<code>x/params</code>",id:"xparams",level:4},{value:"<code>x/crisis</code>",id:"xcrisis",level:4},{value:"<code>x/gov</code>",id:"xgov-1",level:4},{value:"Minimum Proposal Deposit At Time of Submission",id:"minimum-proposal-deposit-at-time-of-submission",level:5},{value:"New <code>Proposal.Proposer</code> field",id:"new-proposalproposer-field",level:5},{value:"<code>x/consensus</code>",id:"xconsensus",level:4},{value:"<code>app.go</code> changes",id:"appgo-changes",level:5},{value:"<code>x/nft</code>",id:"xnft-1",level:4},{value:"Ledger",id:"ledger",level:3},{value:"v0.46.x",id:"v046x",level:2},{value:"Go API Changes",id:"go-api-changes",level:3},{value:"new packages",id:"new-packages",level:4},{value:"<code>x/authz</code>",id:"xauthz",level:4},{value:"Keyring",id:"keyring",level:3},{value:"PostHandler",id:"posthandler",level:3},{value:"IAVL",id:"iavl",level:3},{value:"Modules",id:"modules-2",level:3},{value:"<code>x/params</code>",id:"xparams-1",level:4},{value:"<code>x/gov</code>",id:"xgov-2",level:4},{value:"<code>x/staking</code>",id:"xstaking",level:4},{value:"Protobuf",id:"protobuf-2",level:3}],d={toc:p};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"upgrading-cosmos-sdk"},"Upgrading Cosmos SDK"),(0,o.kt)("p",null,"This guide provides instructions for upgrading to specific versions of Cosmos SDK.\nNote, always read the ",(0,o.kt)("strong",{parentName:"p"},"SimApp")," section for more information on application wiring updates."),(0,o.kt)("h2",{id:"unreleased"},"[Unreleased]"),(0,o.kt)("h3",{id:"migration-to-collections"},"Migration to Collections"),(0,o.kt)("p",null,"Most of Cosmos SDK modules have migrated to ",(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/packages/collections"},"collections"),".\nMany functions have been removed due to this changes as the API can be smaller thanks to collections.\nFor modules that have migrated, verify you are checking against ",(0,o.kt)("inlineCode",{parentName:"p"},"collections.ErrNotFound")," when applicable."),(0,o.kt)("h2",{id:"v050x"},(0,o.kt)("a",{parentName:"h2",href:"https://github.com/cosmos/cosmos-sdk/releases/tag/v0.50.0-alpha.0"},"v0.50.x")),(0,o.kt)("h3",{id:"migration-to-cometbft-part-2"},"Migration to CometBFT (Part 2)"),(0,o.kt)("p",null,"The Cosmos SDK has migrated in its previous versions, to CometBFT.\nSome functions have been renamed to reflect the naming change."),(0,o.kt)("p",null,"Following an exhaustive list:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"client.TendermintRPC")," -> ",(0,o.kt)("inlineCode",{parentName:"li"},"client.CometRPC")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"clitestutil.MockTendermintRPC")," -> ",(0,o.kt)("inlineCode",{parentName:"li"},"clitestutil.MockCometRPC")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"clitestutilgenutil.CreateDefaultTendermintConfig")," -> ",(0,o.kt)("inlineCode",{parentName:"li"},"clitestutilgenutil.CreateDefaultCometConfig")),(0,o.kt)("li",{parentName:"ul"},"Package ",(0,o.kt)("inlineCode",{parentName:"li"},"client/grpc/tmservice")," -> ",(0,o.kt)("inlineCode",{parentName:"li"},"client/grpc/cmtservice"))),(0,o.kt)("p",null,"Additionally, the commands and flags mentioning ",(0,o.kt)("inlineCode",{parentName:"p"},"tendermint")," have been renamed to ",(0,o.kt)("inlineCode",{parentName:"p"},"comet"),".\nHowever, these commands and flags are still supported for backward compatibility."),(0,o.kt)("p",null,"For backward compatibility, the ",(0,o.kt)("inlineCode",{parentName:"p"},"**/tendermint/**")," gRPC services are still supported."),(0,o.kt)("p",null,"Additionally, the SDK is starting its abstraction from CometBFT Go types thorought the codebase:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The usage of the CometBFT logger has been replaced by the Cosmos SDK logger interface (",(0,o.kt)("inlineCode",{parentName:"li"},"cosmossdk.io/log.Logger"),")."),(0,o.kt)("li",{parentName:"ul"},"The usage of ",(0,o.kt)("inlineCode",{parentName:"li"},"github.com/cometbft/cometbft/libs/bytes.HexByte")," has been replaced by ",(0,o.kt)("inlineCode",{parentName:"li"},"[]byte"),".")),(0,o.kt)("h4",{id:"enable-vote-extensions"},"Enable Vote Extensions"),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"This is an optional feature that is disabled by default.")),(0,o.kt)("p",null,"Once all the code changes required to implement Vote Extensions are in place,\nthey can be enabled by setting the consensus param ",(0,o.kt)("inlineCode",{parentName:"p"},"Abci.VoteExtensionsEnableHeight"),"\nto a value greater than zero."),(0,o.kt)("p",null,"In a new chain, this can be done in the ",(0,o.kt)("inlineCode",{parentName:"p"},"genesis.json")," file."),(0,o.kt)("p",null,"For existing chains this can be done in two ways:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"During an upgrade the value is set in an upgrade handler."),(0,o.kt)("li",{parentName:"ul"},"A governance proposal that changes the consensus param ",(0,o.kt)("strong",{parentName:"li"},"after a coordinated upgrade has taken place"),".")),(0,o.kt)("h3",{id:"baseapp"},"BaseApp"),(0,o.kt)("p",null,"All ABCI methods now accept a pointer to the request and response types defined\nby CometBFT. In addition, they also return errors. An ABCI method should only\nreturn errors in cases where a catastrophic failure has occurred and the application\nshould halt. However, this is abstracted away from the application developer. Any\nhandler that an application can define or set that returns an error, will gracefully\nby handled by ",(0,o.kt)("inlineCode",{parentName:"p"},"BaseApp")," on behalf of the application."),(0,o.kt)("p",null,"BaseApp calls of ",(0,o.kt)("inlineCode",{parentName:"p"},"BeginBlock")," & ",(0,o.kt)("inlineCode",{parentName:"p"},"Endblock")," are now private but are still exposed\nto the application to define via the ",(0,o.kt)("inlineCode",{parentName:"p"},"Manager")," type. ",(0,o.kt)("inlineCode",{parentName:"p"},"FinalizeBlock")," is public\nand should be used in order to test and run operations. This means that although\n",(0,o.kt)("inlineCode",{parentName:"p"},"BeginBlock")," & ",(0,o.kt)("inlineCode",{parentName:"p"},"Endblock")," no longer exist in the ABCI interface, they are automatically\ncalled by ",(0,o.kt)("inlineCode",{parentName:"p"},"BaseApp")," during ",(0,o.kt)("inlineCode",{parentName:"p"},"FinalizeBlock"),". Specifically, the order of operations\nis ",(0,o.kt)("inlineCode",{parentName:"p"},"BeginBlock")," -> ",(0,o.kt)("inlineCode",{parentName:"p"},"DeliverTx")," (for all txs) -> ",(0,o.kt)("inlineCode",{parentName:"p"},"EndBlock"),"."),(0,o.kt)("p",null,"ABCI++ 2.0 also brings ",(0,o.kt)("inlineCode",{parentName:"p"},"ExtendVote")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"VerifyVoteExtension")," ABCI methods. These\nmethods allow applications to extend and verify pre-commit votes. The Cosmos SDK\nallows an application to define handlers for these methods via ",(0,o.kt)("inlineCode",{parentName:"p"},"ExtendVoteHandler"),"\nand ",(0,o.kt)("inlineCode",{parentName:"p"},"VerifyVoteExtensionHandler")," respectively. Please see ",(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/v0.50/building-apps/vote-extensions"},"here"),"\nfor more info."),(0,o.kt)("h4",{id:"events"},"Events"),(0,o.kt)("p",null,"The log section of ",(0,o.kt)("inlineCode",{parentName:"p"},"abci.TxResult")," is not populated in the case of successful\nmsg(s) execution. Instead a new attribute is added to all messages indicating\nthe ",(0,o.kt)("inlineCode",{parentName:"p"},"msg_index")," which identifies which events and attributes relate the same\ntransaction."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"BeginBlock")," & ",(0,o.kt)("inlineCode",{parentName:"p"},"EndBlock")," Events are now emitted through ",(0,o.kt)("inlineCode",{parentName:"p"},"FinalizeBlock")," but have\nan added attribute, ",(0,o.kt)("inlineCode",{parentName:"p"},"mode=BeginBlock|EndBlock"),", to identify if the event belongs\nto ",(0,o.kt)("inlineCode",{parentName:"p"},"BeginBlock")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"EndBlock"),"."),(0,o.kt)("h3",{id:"config-files"},"Config files"),(0,o.kt)("p",null,"Confix is a new SDK tool for modifying and migrating configuration of the SDK.\nIt is the replacement of the ",(0,o.kt)("inlineCode",{parentName:"p"},"config.Cmd")," command from the ",(0,o.kt)("inlineCode",{parentName:"p"},"client/config")," package."),(0,o.kt)("p",null,"Use the following command to migrate your configuration:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"simd config migrate v0.50\n")),(0,o.kt)("p",null,"If you were using ",(0,o.kt)("inlineCode",{parentName:"p"},"<appd> config [key]")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"<appd> config [key] [value]")," to set and get values from the ",(0,o.kt)("inlineCode",{parentName:"p"},"client.toml"),", replace it with ",(0,o.kt)("inlineCode",{parentName:"p"},"<appd> config get client [key]")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"<appd> config set client [key] [value]"),". The extra verbosity is due to the extra functionalities added in config."),(0,o.kt)("p",null,"More information about ",(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/tooling/confix"},"confix")," and how to add it in your application binary in the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/tooling/confix"},"documentation"),"."),(0,o.kt)("h4",{id:"grpc-web"},"gRPC-Web"),(0,o.kt)("p",null,"gRPC-Web is now listening to the same address and port as the gRPC Gateway API server (default: ",(0,o.kt)("inlineCode",{parentName:"p"},"localhost:1317"),").\nThe possibility to listen to a different address has been removed, as well as its settings.\nUse ",(0,o.kt)("inlineCode",{parentName:"p"},"confix")," to clean-up your ",(0,o.kt)("inlineCode",{parentName:"p"},"app.toml"),". A nginx (or alike) reverse-proxy can be set to keep the previous behavior."),(0,o.kt)("h4",{id:"database-support"},"Database Support"),(0,o.kt)("p",null,"ClevelDB, BoltDB and BadgerDB are not supported anymore. To migrate from a unsupported database to a supported database please use a database migration tool."),(0,o.kt)("h3",{id:"protobuf"},"Protobuf"),(0,o.kt)("p",null,"With the deprecation of the Amino JSON codec defined in ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/gogoproto"},"cosmos/gogoproto")," in favor of the protoreflect powered x/tx/aminojson codec, module developers are encouraged verify that their messages have the correct protobuf annotations to deterministically produce identical output from both codecs."),(0,o.kt)("p",null,"For core SDK types equivalence is asserted by generative testing of ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-beta.0/tests/integration/rapidgen/rapidgen.go#L102"},"SignableTypes")," in ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-beta.0/tests/integration/tx/aminojson/aminojson_test.go#L94"},"TestAminoJSON_Equivalence"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"TODO: summarize proto annotation requirements.")),(0,o.kt)("h4",{id:"stringer"},"Stringer"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"gogoproto.goproto_stringer = false")," annotation has been removed from most proto files. This means that the ",(0,o.kt)("inlineCode",{parentName:"p"},"String()")," method is being generated for types that previously had this annotation. The generated ",(0,o.kt)("inlineCode",{parentName:"p"},"String()")," method uses ",(0,o.kt)("inlineCode",{parentName:"p"},"proto.CompactTextString")," for ",(0,o.kt)("em",{parentName:"p"},"stringifying")," structs.\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/pull/13850#issuecomment-1328889651"},"Verify")," the usage of the modified ",(0,o.kt)("inlineCode",{parentName:"p"},"String()")," methods and double-check that they are not used in state-machine code."),(0,o.kt)("h3",{id:"simapp"},"SimApp"),(0,o.kt)("p",null,"In this section we describe the changes made in Cosmos SDK' SimApp.\n",(0,o.kt)("strong",{parentName:"p"},"These changes are directly applicable to your application wiring.")),(0,o.kt)("h4",{id:"module-assertions"},"Module Assertions"),(0,o.kt)("p",null,"Previously, all modules were required to be set in ",(0,o.kt)("inlineCode",{parentName:"p"},"OrderBeginBlockers"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"OrderEndBlockers")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"OrderInitGenesis / OrderExportGenesis")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"app.go")," / ",(0,o.kt)("inlineCode",{parentName:"p"},"app_config.go"),". This is no longer the case, the assertion has been loosened to only require modules implementing, respectively, the ",(0,o.kt)("inlineCode",{parentName:"p"},"module.BeginBlockAppModule"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"module.EndBlockAppModule")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"module.HasGenesis")," interfaces."),(0,o.kt)("h4",{id:"module-wiring"},"Module wiring"),(0,o.kt)("p",null,"The following modules ",(0,o.kt)("inlineCode",{parentName:"p"},"NewKeeper")," function now take a ",(0,o.kt)("inlineCode",{parentName:"p"},"KVStoreService")," instead of a ",(0,o.kt)("inlineCode",{parentName:"p"},"StoreKey"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/auth")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/authz")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/bank")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/consensus")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/crisis")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/distribution")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/evidence")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/feegrant")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/gov")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/mint")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/nft")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/slashing")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/upgrade"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Users using ",(0,o.kt)("inlineCode",{parentName:"strong"},"depinject")," / app v2 do not need any changes, this is abstracted for them.")),(0,o.kt)("p",null,"Users manually wiring their chain need to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"runtime.NewKVStoreService")," method to create a ",(0,o.kt)("inlineCode",{parentName:"p"},"KVStoreService")," from a ",(0,o.kt)("inlineCode",{parentName:"p"},"StoreKey"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"app.ConsensusParamsKeeper = consensusparamkeeper.NewKeeper(\n  appCodec,\n- keys[consensusparamtypes.StoreKey]\n+ runtime.NewKVStoreService(keys[consensusparamtypes.StoreKey]),\n  authtypes.NewModuleAddress(govtypes.ModuleName).String(),\n)\n")),(0,o.kt)("h4",{id:"logger"},"Logger"),(0,o.kt)("p",null,"Replace all your CometBFT logger imports by ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmossdk.io/log"),"."),(0,o.kt)("p",null,"Additionally, ",(0,o.kt)("inlineCode",{parentName:"p"},"depinject")," / app v2 users must now supply a logger through the main ",(0,o.kt)("inlineCode",{parentName:"p"},"depinject.Supply")," function instead of passing it to ",(0,o.kt)("inlineCode",{parentName:"p"},"appBuilder.Build"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"appConfig = depinject.Configs(\n    AppConfig,\n    depinject.Supply(\n        // supply the application options\n        appOpts,\n+       logger,\n    ...\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"- app.App = appBuilder.Build(logger, db, traceStore, baseAppOptions...)\n+ app.App = appBuilder.Build(db, traceStore, baseAppOptions...)\n")),(0,o.kt)("p",null,"User manually wiring their chain need to add the logger argument when creating the ",(0,o.kt)("inlineCode",{parentName:"p"},"x/bank")," keeper."),(0,o.kt)("h4",{id:"module-basics"},"Module Basics"),(0,o.kt)("p",null,"Previously, the ",(0,o.kt)("inlineCode",{parentName:"p"},"ModuleBasics")," was a global variable that was used to register all modules's ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," implementation.\nThe global variable has been removed and the basic module manager can be now created from the module manager."),(0,o.kt)("p",null,"This is automatically done for ",(0,o.kt)("inlineCode",{parentName:"p"},"depinject")," / app v2 users, however for supplying different app module implementation, pass them via ",(0,o.kt)("inlineCode",{parentName:"p"},"depinject.Supply")," in the main ",(0,o.kt)("inlineCode",{parentName:"p"},"AppConfig")," (",(0,o.kt)("inlineCode",{parentName:"p"},"app_config.go"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"depinject.Supply(\n            // supply custom module basics\n            map[string]module.AppModuleBasic{\n                genutiltypes.ModuleName: genutil.NewAppModuleBasic(genutiltypes.DefaultMessageValidator),\n                govtypes.ModuleName: gov.NewAppModuleBasic(\n                    []govclient.ProposalHandler{\n                        paramsclient.ProposalHandler,\n                    },\n                ),\n            },\n        )\n")),(0,o.kt)("p",null,"Users manually wiring their chain need to use the new ",(0,o.kt)("inlineCode",{parentName:"p"},"module.NewBasicManagerFromManager")," function, after the module manager creation, and pass a ",(0,o.kt)("inlineCode",{parentName:"p"},"map[string]module.AppModuleBasic")," as argument for optionally overridding some module's ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModuleBasic"),"."),(0,o.kt)("h4",{id:"autocli"},"AutoCLI"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/building-modules/autocli"},(0,o.kt)("inlineCode",{parentName:"a"},"AutoCLI"))," has been implemented by the SDK for all its module CLI queries. This means chains must add the following in their ",(0,o.kt)("inlineCode",{parentName:"p"},"root.go")," to enable ",(0,o.kt)("inlineCode",{parentName:"p"},"AutoCLI")," in their application:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"if err := autoCliOpts.EnhanceRootCommand(rootCmd); err != nil {\n    panic(err)\n}\n")),(0,o.kt)("p",null,"Where ",(0,o.kt)("inlineCode",{parentName:"p"},"autoCliOpts")," is the autocli options of the app, containing all modules and codecs.\nThat value can injected by depinject (",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-beta.0/simapp/simd/cmd/root_v2.go#L49-L67"},"see root_v2.go"),") or manually provided by the app (",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-beta.0/simapp/app.go#L636-L655"},"see legacy app.go"),")."),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"Not doing this will result in all core SDK modules queries not to be included in the binary.")),(0,o.kt)("p",null,"Additionally ",(0,o.kt)("inlineCode",{parentName:"p"},"AutoCLI")," automatically adds the custom modules commands to the root command for all modules implementing the ",(0,o.kt)("a",{parentName:"p",href:"https://pkg.go.dev/cosmossdk.io/core/appmodule#AppModule"},(0,o.kt)("inlineCode",{parentName:"a"},"appmodule.AppModule"))," interface.\nThis means, after ensuring all the used modules implement this interface, the following can be removed from your ",(0,o.kt)("inlineCode",{parentName:"p"},"root.go"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"func txCommand() *cobra.Command {\n    ....\n- appd.ModuleBasics.AddTxCommands(cmd)\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"func queryCommand() *cobra.Command {\n    ....\n- appd.ModuleBasics.AddQueryCommands(cmd)\n}\n")),(0,o.kt)("h3",{id:"packages"},"Packages"),(0,o.kt)("h4",{id:"math"},"Math"),(0,o.kt)("p",null,"References to ",(0,o.kt)("inlineCode",{parentName:"p"},"types/math.go")," which contained aliases for math types aliasing the ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmossdk.io/math")," package have been removed.\nImport directly the ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmossdk.io/math")," package instead."),(0,o.kt)("h4",{id:"store"},"Store"),(0,o.kt)("p",null,"References to ",(0,o.kt)("inlineCode",{parentName:"p"},"types/store.go")," which contained aliases for store types have been remapped to point to appropriate ",(0,o.kt)("inlineCode",{parentName:"p"},"store/types"),", hence the ",(0,o.kt)("inlineCode",{parentName:"p"},"types/store.go")," file is no longer needed and has been removed."),(0,o.kt)("h5",{id:"extract-store-to-a-standalone-module"},"Extract Store to a standalone module"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"store")," module is extracted to have a separate go.mod file which allows it be a standalone module.\nAll the store imports are now renamed to use ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmossdk.io/store")," instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"github.com/cosmos/cosmos-sdk/store")," across the SDK."),(0,o.kt)("h5",{id:"streaming"},"Streaming"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/architecture/adr-038-state-listening"},"ADR-38")," has been implemented in the SDK."),(0,o.kt)("p",null,"To continue using state streaming, replace ",(0,o.kt)("inlineCode",{parentName:"p"},"streaming.LoadStreamingServices")," by the following in your ",(0,o.kt)("inlineCode",{parentName:"p"},"app.go"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"if err := app.RegisterStreamingServices(appOpts, app.kvStoreKeys()); err != nil {\n    panic(err)\n}\n")),(0,o.kt)("h4",{id:"client"},"Client"),(0,o.kt)("p",null,"The return type of the interface method ",(0,o.kt)("inlineCode",{parentName:"p"},"TxConfig.SignModeHandler()")," has been changed from ",(0,o.kt)("inlineCode",{parentName:"p"},"x/auth/signing.SignModeHandler")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"x/tx/signing.HandlerMap"),". This change is transparent to most users as the ",(0,o.kt)("inlineCode",{parentName:"p"},"TxConfig")," interface is typically implemented by private ",(0,o.kt)("inlineCode",{parentName:"p"},"x/auth/tx.config")," struct (as returned by ",(0,o.kt)("inlineCode",{parentName:"p"},"auth.NewTxConfig"),") which has been updated to return the new type.  If users have implemented their own ",(0,o.kt)("inlineCode",{parentName:"p"},"TxConfig")," interface, they will need to update their implementation to return the new type."),(0,o.kt)("h3",{id:"modules"},"Modules"),(0,o.kt)("h4",{id:"all"},(0,o.kt)("inlineCode",{parentName:"h4"},"**all**")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/rfc/rfc-001-tx-validation"},"RFC 001")," has defined a simplification of the message validation process for modules.\nThe ",(0,o.kt)("inlineCode",{parentName:"p"},"sdk.Msg")," interface has been updated to not require the implementation of the ",(0,o.kt)("inlineCode",{parentName:"p"},"ValidateBasic")," method.\nIt is now recommended to validate message directly in the message server. When the validation is performed in the message server, the ",(0,o.kt)("inlineCode",{parentName:"p"},"ValidateBasic")," method on a message is no longer required and can be removed.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Messages no longer need to implement the ",(0,o.kt)("inlineCode",{parentName:"p"},"LegacyMsg")," interface and implementations of ",(0,o.kt)("inlineCode",{parentName:"p"},"GetSignBytes")," can be deleted. Because of this change, global legacy Amino codec definitions and their registration in ",(0,o.kt)("inlineCode",{parentName:"p"},"init()")," can safely be removed as well.  ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," interface has been simplifed. Defining ",(0,o.kt)("inlineCode",{parentName:"p"},"GetTxCmd() *cobra.Command")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"GetQueryCmd() *cobra.Command")," is no longer required. The module manager detects when module commands are defined. If AutoCLI is enabled, ",(0,o.kt)("inlineCode",{parentName:"p"},"EnhanceRootCommand()")," will add the auto-generated commands to the root command, unless a custom module command is defined and register that one instead.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The following modules' ",(0,o.kt)("inlineCode",{parentName:"p"},"Keeper")," methods now take in a ",(0,o.kt)("inlineCode",{parentName:"p"},"context.Context")," instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"sdk.Context"),'. Any module that has an interfaces for them (like "expected keepers") will need to update and re-generate mocks if needed:'),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/authz")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/bank")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/mint")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/crisis")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/distribution")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/evidence")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/gov")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/slashing")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/upgrade"))))),(0,o.kt)("h4",{id:"xauth"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/auth")),(0,o.kt)("p",null,"For ante handler construction via ",(0,o.kt)("inlineCode",{parentName:"p"},"ante.NewAnteHandler"),", the field ",(0,o.kt)("inlineCode",{parentName:"p"},"ante.HandlerOptions.SignModeHandler")," has been updated to ",(0,o.kt)("inlineCode",{parentName:"p"},"x/tx/signing/HandlerMap")," from ",(0,o.kt)("inlineCode",{parentName:"p"},"x/auth/signing/SignModeHandler"),".  Callers typically fetch this value from ",(0,o.kt)("inlineCode",{parentName:"p"},"client.TxConfig.SignModeHandler()")," (which is also changed) so this change should be transparent to most users."),(0,o.kt)("h4",{id:"xcapability"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/capability")),(0,o.kt)("p",null,"Capability has been moved to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/ibc-go"},"IBC-GO"),". IBC v8 will contain the necessary changes to incorporate the new module location."),(0,o.kt)("h4",{id:"xgov"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/gov")),(0,o.kt)("h5",{id:"expedited-proposals"},"Expedited Proposals"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"gov")," v1 module now supports expedited governance proposals. When a proposal is expedited, the voting period will be shortened to ",(0,o.kt)("inlineCode",{parentName:"p"},"ExpeditedVotingPeriod")," parameter. An expedited proposal must have an higher voting threshold than a classic proposal, that threshold is defined with the ",(0,o.kt)("inlineCode",{parentName:"p"},"ExpeditedThreshold")," parameter."),(0,o.kt)("h5",{id:"cancelling-proposals"},"Cancelling Proposals"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"gov")," module now supports cancelling governance proposals. When a proposal is canceled, all the deposits of the proposal are either burnt or sent to ",(0,o.kt)("inlineCode",{parentName:"p"},"ProposalCancelDest")," address. The deposits burn rate will be determined by a new parameter called ",(0,o.kt)("inlineCode",{parentName:"p"},"ProposalCancelRatio")," parameter."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"1. deposits * proposal_cancel_ratio will be burned or sent to `ProposalCancelDest` address , if `ProposalCancelDest` is empty then deposits will be burned.\n2. deposits * (1 - proposal_cancel_ratio) will be sent to depositors.\n")),(0,o.kt)("p",null,"By default, the new ",(0,o.kt)("inlineCode",{parentName:"p"},"ProposalCancelRatio")," parameter is set to ",(0,o.kt)("inlineCode",{parentName:"p"},"0.5")," during migration and ",(0,o.kt)("inlineCode",{parentName:"p"},"ProposalCancelDest")," is set to empty string (i.e. burnt)."),(0,o.kt)("h4",{id:"xevidence"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/evidence")),(0,o.kt)("h5",{id:"extract-evidence-to-a-standalone-module"},"Extract evidence to a standalone module"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"x/evidence")," module is extracted to have a separate go.mod file which allows it be a standalone module.\nAll the evidence imports are now renamed to use ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmossdk.io/x/evidence")," instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"github.com/cosmos/cosmos-sdk/x/evidence")," across the SDK."),(0,o.kt)("h4",{id:"xnft"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/nft")),(0,o.kt)("h5",{id:"extract-nft-to-a-standalone-module"},"Extract nft to a standalone module"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"x/nft")," module is extracted to have a separate go.mod file which allows it to be a standalone module.\nAll the evidence imports are now renamed to use ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmossdk.io/x/nft")," instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"github.com/cosmos/cosmos-sdk/x/nft")," across the SDK."),(0,o.kt)("h4",{id:"xfeegrant"},"x/feegrant"),(0,o.kt)("h5",{id:"extract-feegrant-to-a-standalone-module"},"Extract feegrant to a standalone module"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"x/feegrant")," module is extracted to have a separate go.mod file which allows it to be a standalone module.\nAll the feegrant imports are now renamed to use ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmossdk.io/x/feegrant")," instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"github.com/cosmos/cosmos-sdk/x/feegrant")," across the SDK."),(0,o.kt)("h4",{id:"xupgrade"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/upgrade")),(0,o.kt)("h5",{id:"extract-upgrade-to-a-standalone-module"},"Extract upgrade to a standalone module"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"x/upgrade")," module is extracted to have a separate go.mod file which allows it to be a standalone module.\nAll the upgrade imports are now renamed to use ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmossdk.io/x/upgrade")," instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"github.com/cosmos/cosmos-sdk/x/upgrade")," across the SDK."),(0,o.kt)("h3",{id:"tooling"},"Tooling"),(0,o.kt)("h4",{id:"rosetta"},"Rosetta"),(0,o.kt)("p",null,"Rosetta has moved to it's own ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/rosetta"},"repo")," and not imported by the Cosmos SDK SimApp by default.\nAny user who is interested on using the tool can connect it standalone to any node without the need to add it as part of the node binary.\nThe rosetta tool also allows multi chain connections.  "),(0,o.kt)("h2",{id:"v047x"},(0,o.kt)("a",{parentName:"h2",href:"https://github.com/cosmos/cosmos-sdk/releases/tag/v0.47.0"},"v0.47.x")),(0,o.kt)("h3",{id:"migration-to-cometbft-part-1"},"Migration to CometBFT (Part 1)"),(0,o.kt)("p",null,"The Cosmos SDK has migrated to CometBFT, as its default consensus engine.\nCometBFT is an implementation of the Tendermint consensus algorithm, and the successor of Tendermint Core.\nDue to the import changes, this is a breaking change. Chains need to remove ",(0,o.kt)("strong",{parentName:"p"},"entirely")," their imports of Tendermint Core in their codebase, from direct and indirects imports in their ",(0,o.kt)("inlineCode",{parentName:"p"},"go.mod"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Replace ",(0,o.kt)("inlineCode",{parentName:"li"},"github.com/tendermint/tendermint")," by ",(0,o.kt)("inlineCode",{parentName:"li"},"github.com/cometbft/cometbft")),(0,o.kt)("li",{parentName:"ul"},"Replace ",(0,o.kt)("inlineCode",{parentName:"li"},"github.com/tendermint/tm-db")," by ",(0,o.kt)("inlineCode",{parentName:"li"},"github.com/cometbft/cometbft-db")),(0,o.kt)("li",{parentName:"ul"},"Verify ",(0,o.kt)("inlineCode",{parentName:"li"},"github.com/tendermint/tendermint")," is not an indirect or direct dependency"),(0,o.kt)("li",{parentName:"ul"},"Run ",(0,o.kt)("inlineCode",{parentName:"li"},"make proto-gen"))),(0,o.kt)("p",null,"Other than that, the migration should be seamless.\nOn the SDK side, clean-up of variables, functions to reflect the new name will only happen from v0.50 (part 2)."),(0,o.kt)("p",null,"Note: It is possible that these steps must first be performed by your dependencies before you can perform them on your own codebase."),(0,o.kt)("h3",{id:"simulation"},"Simulation"),(0,o.kt)("p",null,"Remove ",(0,o.kt)("inlineCode",{parentName:"p"},"RandomizedParams")," from ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModuleSimulation")," interface. Previously, it used to generate random parameter changes during simulations, however, it does so through ParamChangeProposal which is now legacy. Since all modules were migrated, we can now safely remove this from ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModuleSimulation")," interface."),(0,o.kt)("p",null,"Moreover, to support the ",(0,o.kt)("inlineCode",{parentName:"p"},"MsgUpdateParams")," governance proposals for each modules, ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModuleSimulation")," now defines a ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModule.ProposalMsgs")," method in addition to ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModule.ProposalContents"),". That method defines the messages that can be used to submit a proposal and that should be tested in simulation."),(0,o.kt)("p",null,"When a module has no proposal messages or proposal content to be tested by simulation, the ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModule.ProposalMsgs")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModule.ProposalContents")," methods can be deleted."),(0,o.kt)("h3",{id:"grpc"},"gRPC"),(0,o.kt)("p",null,"A new gRPC service, ",(0,o.kt)("inlineCode",{parentName:"p"},"proto/cosmos/base/node/v1beta1/query.proto"),", has been introduced\nwhich exposes various operator configuration. App developers should be sure to\nregister the service with the gRPC-gateway service via\n",(0,o.kt)("inlineCode",{parentName:"p"},"nodeservice.RegisterGRPCGatewayRoutes")," in their application construction, which\nis typically found in ",(0,o.kt)("inlineCode",{parentName:"p"},"RegisterAPIRoutes"),"."),(0,o.kt)("h3",{id:"appmodule-interface"},"AppModule Interface"),(0,o.kt)("p",null,"Support for the ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModule")," ",(0,o.kt)("inlineCode",{parentName:"p"},"Querier"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Route")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"LegacyQuerier")," methods has been entirely removed from the ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModule"),"\ninterface. This removes and fully deprecates all legacy queriers. All modules no longer support the REST API previously\nknown as the LCD, and the ",(0,o.kt)("inlineCode",{parentName:"p"},"sdk.Msg#Route")," method won't be used anymore."),(0,o.kt)("p",null,"Most other existing ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModule")," methods have been moved to extension interfaces in preparation for the migration\nto the ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmossdk.io/core/appmodule")," API in the next release. Most ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModule")," implementations should not be broken\nby this change."),(0,o.kt)("h3",{id:"simapp-1"},"SimApp"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"simapp")," package ",(0,o.kt)("strong",{parentName:"p"},"should not be imported in your own app"),". Instead, you should import the ",(0,o.kt)("inlineCode",{parentName:"p"},"runtime.AppI")," interface, that defines an ",(0,o.kt)("inlineCode",{parentName:"p"},"App"),", and use the ",(0,o.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/cosmos/cosmos-sdk/testutil/sims"},(0,o.kt)("inlineCode",{parentName:"a"},"simtestutil")," package")," for application testing."),(0,o.kt)("h4",{id:"app-wiring"},"App Wiring"),(0,o.kt)("p",null,"SimApp's ",(0,o.kt)("inlineCode",{parentName:"p"},"app_v2.go")," is using ",(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/building-apps/app-go-v2"},"App Wiring"),", the dependency injection framework of the Cosmos SDK.\nThis means that modules are injected directly into SimApp thanks to a ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/simapp/app_config.go"},"configuration file"),".\nThe previous behavior, without the dependency injection framework, is still present in ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/simapp/app.go"},(0,o.kt)("inlineCode",{parentName:"a"},"app.go"))," and is not going anywhere."),(0,o.kt)("p",null,"If you are using a ",(0,o.kt)("inlineCode",{parentName:"p"},"app.go")," without dependency injection, add the following lines to your ",(0,o.kt)("inlineCode",{parentName:"p"},"app.go")," in order to provide newer gRPC services:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"autocliv1.RegisterQueryServer(app.GRPCQueryRouter(), runtimeservices.NewAutoCLIQueryService(app.ModuleManager.Modules))\n\nreflectionSvc, err := runtimeservices.NewReflectionService()\nif err != nil {\n    panic(err)\n}\nreflectionv1.RegisterReflectionServiceServer(app.GRPCQueryRouter(), reflectionSvc)\n")),(0,o.kt)("h4",{id:"constructor"},"Constructor"),(0,o.kt)("p",null,"The constructor, ",(0,o.kt)("inlineCode",{parentName:"p"},"NewSimApp")," has been simplified:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"NewSimApp")," does not take encoding parameters (",(0,o.kt)("inlineCode",{parentName:"li"},"encodingConfig"),") as input, instead the encoding parameters are injected (when using app wiring), or directly created in the constructor. Instead, we can instantiate ",(0,o.kt)("inlineCode",{parentName:"li"},"SimApp")," for getting the encoding configuration."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"NewSimApp")," now uses ",(0,o.kt)("inlineCode",{parentName:"li"},"AppOptions")," for getting the home path (",(0,o.kt)("inlineCode",{parentName:"li"},"homePath"),") and the invariant checks period (",(0,o.kt)("inlineCode",{parentName:"li"},"invCheckPeriod"),"). These were unnecessary given as arguments as they were already present in the ",(0,o.kt)("inlineCode",{parentName:"li"},"AppOptions"),".")),(0,o.kt)("h4",{id:"encoding"},"Encoding"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"simapp.MakeTestEncodingConfig()")," was deprecated and has been removed. Instead you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"TestEncodingConfig")," from the ",(0,o.kt)("inlineCode",{parentName:"p"},"types/module/testutil")," package.\nThis means you can replace your usage of ",(0,o.kt)("inlineCode",{parentName:"p"},"simapp.MakeTestEncodingConfig")," in tests to ",(0,o.kt)("inlineCode",{parentName:"p"},"moduletestutil.MakeTestEncodingConfig"),", which takes a series of relevant ",(0,o.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," as input (the module being tested and any potential dependencies)."),(0,o.kt)("h4",{id:"export"},"Export"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"ExportAppStateAndValidators")," takes an extra argument, ",(0,o.kt)("inlineCode",{parentName:"p"},"modulesToExport"),", which is a list of module names to export.\nThat argument should be passed to the module maanager ",(0,o.kt)("inlineCode",{parentName:"p"},"ExportGenesisFromModules")," method."),(0,o.kt)("h4",{id:"replaces"},"Replaces"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"GoLevelDB")," version must pinned to ",(0,o.kt)("inlineCode",{parentName:"p"},"v1.0.1-0.20210819022825-2ae1ddf74ef7")," in the application, following versions might cause unexpected behavior.\nThis can be done adding ",(0,o.kt)("inlineCode",{parentName:"p"},"replace github.com/syndtr/goleveldb => github.com/syndtr/goleveldb v1.0.1-0.20210819022825-2ae1ddf74ef7")," to the ",(0,o.kt)("inlineCode",{parentName:"p"},"go.mod")," file."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/cosmos/cosmos-sdk/issues/14949"},"issue #14949 on cosmos-sdk")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/ethereum/go-ethereum/pull/25413"},"issue #25413 on go-ethereum"))),(0,o.kt)("h3",{id:"protobuf-1"},"Protobuf"),(0,o.kt)("p",null,"The SDK has migrated from ",(0,o.kt)("inlineCode",{parentName:"p"},"gogo/protobuf")," (which is currently unmaintained), to our own maintained fork, ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/gogoproto"},(0,o.kt)("inlineCode",{parentName:"a"},"cosmos/gogoproto")),"."),(0,o.kt)("p",null,"This means you should replace all imports of ",(0,o.kt)("inlineCode",{parentName:"p"},"github.com/gogo/protobuf")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"github.com/cosmos/gogoproto"),".\nThis allows you to remove the replace directive ",(0,o.kt)("inlineCode",{parentName:"p"},"replace github.com/gogo/protobuf => github.com/regen-network/protobuf v1.3.3-alpha.regen.1")," from your ",(0,o.kt)("inlineCode",{parentName:"p"},"go.mod")," file."),(0,o.kt)("p",null,"Please use the ",(0,o.kt)("inlineCode",{parentName:"p"},"ghcr.io/cosmos/proto-builder")," image (version >= ",(0,o.kt)("inlineCode",{parentName:"p"},"0.11.5"),") for generating protobuf files."),(0,o.kt)("p",null,"See which buf commit for ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmos/cosmos-sdk")," to pin in your ",(0,o.kt)("inlineCode",{parentName:"p"},"buf.yaml")," file ",(0,o.kt)("a",{parentName:"p",href:"./proto/README.md"},"here"),"."),(0,o.kt)("h4",{id:"gogoproto-import-paths"},"Gogoproto Import Paths"),(0,o.kt)("p",null,"The SDK made a ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/gogoproto/pull/32"},"patch fix")," on its gogoproto repository to require that each proto file's package name matches its OS import path (relatively to a protobuf root import path, usually the root ",(0,o.kt)("inlineCode",{parentName:"p"},"proto/")," folder, set by the ",(0,o.kt)("inlineCode",{parentName:"p"},"protoc -I")," flag)."),(0,o.kt)("p",null,"For example, assuming you put all your proto files in subfolders inside your root ",(0,o.kt)("inlineCode",{parentName:"p"},"proto/")," folder, then a proto file with package name ",(0,o.kt)("inlineCode",{parentName:"p"},"myapp.mymodule.v1")," should be found in the ",(0,o.kt)("inlineCode",{parentName:"p"},"proto/myapp/mymodule/v1/")," folder. If it is in another folder, the proto generation command will throw an error."),(0,o.kt)("p",null,"If you are using a custom folder structure for your proto files, please reorganize them so that their OS path matches their proto package name."),(0,o.kt)("p",null,"This is to allow the proto FileDescriptSets to be correctly registered, and this standardized OS import paths allows ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/tree/main/tools/hubl"},"Hubl")," to reflectively talk to any chain."),(0,o.kt)("h4",{id:"acceptsimplements_interface-proto-annotations"},(0,o.kt)("inlineCode",{parentName:"h4"},"{accepts,implements}_interface")," proto annotations"),(0,o.kt)("p",null,"The SDK is normalizing the strings inside the Protobuf ",(0,o.kt)("inlineCode",{parentName:"p"},"accepts_interface")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"implements_interface")," annotations. We require them to be fully-scoped names. They will soon be used by code generators like Pulsar and Telescope to match which messages can or cannot be packed inside ",(0,o.kt)("inlineCode",{parentName:"p"},"Any"),"s."),(0,o.kt)("p",null,"Here are the following replacements that you need to perform on your proto files:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},'- "Content"\n+ "cosmos.gov.v1beta1.Content"\n- "Authorization"\n+ "cosmos.authz.v1beta1.Authorization"\n- "sdk.Msg"\n+ "cosmos.base.v1beta1.Msg"\n- "AccountI"\n+ "cosmos.auth.v1beta1.AccountI"\n- "ModuleAccountI"\n+ "cosmos.auth.v1beta1.ModuleAccountI"\n- "FeeAllowanceI"\n+ "cosmos.feegrant.v1beta1.FeeAllowanceI"\n')),(0,o.kt)("p",null,"Please also check that in your own app's proto files that there are no single-word names for those two proto annotations. If so, then replace them with fully-qualified names, even though those names don't actually resolve to an actual protobuf entity."),(0,o.kt)("p",null,"For more information, see the ",(0,o.kt)("a",{parentName:"p",href:"./docs/docs/core/05-encoding.md"},"encoding guide"),"."),(0,o.kt)("h3",{id:"transactions"},"Transactions"),(0,o.kt)("h4",{id:"broadcast-mode"},"Broadcast Mode"),(0,o.kt)("p",null,"Broadcast mode ",(0,o.kt)("inlineCode",{parentName:"p"},"block")," was deprecated and has been removed. Please use ",(0,o.kt)("inlineCode",{parentName:"p"},"sync")," mode\ninstead. When upgrading your tests from ",(0,o.kt)("inlineCode",{parentName:"p"},"block")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"sync")," and checking for a\ntransaction code, you need to query the transaction first (with its hash) to get\nthe correct code."),(0,o.kt)("h3",{id:"modules-1"},"Modules"),(0,o.kt)("h4",{id:"all-1"},(0,o.kt)("inlineCode",{parentName:"h4"},"**all**")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"EventTypeMessage")," events, with ",(0,o.kt)("inlineCode",{parentName:"p"},"sdk.AttributeKeyModule")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"sdk.AttributeKeySender")," are now emitted directly at message excecution (in ",(0,o.kt)("inlineCode",{parentName:"p"},"baseapp"),").\nThis means that the following boilerplate should be removed from all your custom modules:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"ctx.EventManager().EmitEvent(\n    sdk.NewEvent(\n        sdk.EventTypeMessage,\n        sdk.NewAttribute(sdk.AttributeKeyModule, types.AttributeValueCategory),\n        sdk.NewAttribute(sdk.AttributeKeySender, `signer/sender`),\n    ),\n)\n")),(0,o.kt)("p",null,"The module name is assumed by ",(0,o.kt)("inlineCode",{parentName:"p"},"baseapp")," to be the second element of the message route: ",(0,o.kt)("inlineCode",{parentName:"p"},'"cosmos.bank.v1beta1.MsgSend" -> "bank"'),".\nIn case a module does not follow the standard message path, (e.g. IBC), it is advised to keep emitting the module name event.\n",(0,o.kt)("inlineCode",{parentName:"p"},"Baseapp")," only emits that event if the module has not already done so."),(0,o.kt)("h4",{id:"xparams"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/params")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"params")," module was deprecated since v0.46. The Cosmos SDK has migrated away from ",(0,o.kt)("inlineCode",{parentName:"p"},"x/params")," for its own modules.\nCosmos SDK modules now store their parameters directly in its repective modules.\nThe ",(0,o.kt)("inlineCode",{parentName:"p"},"params")," module will be removed in ",(0,o.kt)("inlineCode",{parentName:"p"},"v0.50"),", as mentioned ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.46.1/UPGRADING.md#xparams"},"in v0.46 release"),". It is strongly encouraged to migrate away from ",(0,o.kt)("inlineCode",{parentName:"p"},"x/params")," before ",(0,o.kt)("inlineCode",{parentName:"p"},"v0.50"),"."),(0,o.kt)("p",null,"When performing a chain migration, the params table must be initizalied manually. This was done in the modules keepers in previous versions.\nHave a look at ",(0,o.kt)("inlineCode",{parentName:"p"},"simapp.RegisterUpgradeHandlers()")," for an example."),(0,o.kt)("h4",{id:"xcrisis"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/crisis")),(0,o.kt)("p",null,"With the migrations of all modules away from ",(0,o.kt)("inlineCode",{parentName:"p"},"x/params"),", the crisis module now has a store.\nThe store must be created during a chain upgrade to v0.47.x."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"storetypes.StoreUpgrades{\n            Added: []string{\n                crisistypes.ModuleName,\n            },\n}\n")),(0,o.kt)("h4",{id:"xgov-1"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/gov")),(0,o.kt)("h5",{id:"minimum-proposal-deposit-at-time-of-submission"},"Minimum Proposal Deposit At Time of Submission"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"gov")," module has been updated to support a minimum proposal deposit at submission time. It is determined by a new\nparameter called ",(0,o.kt)("inlineCode",{parentName:"p"},"MinInitialDepositRatio"),". When multiplied by the existing ",(0,o.kt)("inlineCode",{parentName:"p"},"MinDeposit")," parameter, it produces\nthe necessary proportion of coins needed at the proposal submission time. The motivation for this change is to prevent proposal spamming."),(0,o.kt)("p",null,"By default, the new ",(0,o.kt)("inlineCode",{parentName:"p"},"MinInitialDepositRatio")," parameter is set to zero during migration. The value of zero signifies that this\nfeature is disabled. If chains wish to utilize the minimum proposal deposits at time of submission, the migration logic needs to be\nmodified to set the new parameter to the desired value."),(0,o.kt)("h5",{id:"new-proposalproposer-field"},"New ",(0,o.kt)("inlineCode",{parentName:"h5"},"Proposal.Proposer")," field"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"Proposal")," proto has been updated with proposer field. For proposal state migraton developers can call ",(0,o.kt)("inlineCode",{parentName:"p"},"v4.AddProposerAddressToProposal")," in their upgrade handler to update all existing proposal and make them compatible and ",(0,o.kt)("strong",{parentName:"p"},"this migration is optional"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},'import (\n    sdk "github.com/cosmos/cosmos-sdk/types"\n    "github.com/cosmos/cosmos-sdk/types/module"\n    v4 "github.com/cosmos/cosmos-sdk/x/gov/migrations/v4"\n    upgradetypes "github.com/cosmos/cosmos-sdk/x/upgrade/types"\n)\n\nfunc (app SimApp) RegisterUpgradeHandlers() {\n    app.UpgradeKeeper.SetUpgradeHandler(UpgradeName,\n        func(ctx sdk.Context, plan upgradetypes.Plan, fromVM module.VersionMap) (module.VersionMap, error) {\n            // this migration is optional\n            // add proposal ids with proposers which are active (deposit or voting period)\n            proposals := make(map[uint64]string)\n            proposals[1] = "cosmos1luyncewxk4lm24k6gqy8y5dxkj0klr4tu0lmnj" ...\n            v4.AddProposerAddressToProposal(ctx, sdk.NewKVStoreKey(v4.ModuleName), app.appCodec, proposals)\n            return app.ModuleManager.RunMigrations(ctx, app.Configurator(), fromVM)\n        })\n}\n\n')),(0,o.kt)("h4",{id:"xconsensus"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/consensus")),(0,o.kt)("p",null,"Introducing a new ",(0,o.kt)("inlineCode",{parentName:"p"},"x/consensus")," module to handle managing Tendermint consensus\nparameters. For migration it is required to call a specific migration to migrate\nexisting parameters from the deprecated ",(0,o.kt)("inlineCode",{parentName:"p"},"x/params")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"x/consensus")," module. App\ndevelopers should ensure to call ",(0,o.kt)("inlineCode",{parentName:"p"},"baseapp.MigrateParams")," in their upgrade handler."),(0,o.kt)("p",null,"Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"func (app SimApp) RegisterUpgradeHandlers() {\n    ----\x3e baseAppLegacySS := app.ParamsKeeper.Subspace(baseapp.Paramspace).WithKeyTable(paramstypes.ConsensusParamsKeyTable()) <----\n\n    app.UpgradeKeeper.SetUpgradeHandler(\n        UpgradeName,\n        func(ctx sdk.Context, _ upgradetypes.Plan, fromVM module.VersionMap) (module.VersionMap, error) {\n            // Migrate Tendermint consensus parameters from x/params module to a\n            // dedicated x/consensus module.\n            ----\x3e baseapp.MigrateParams(ctx, baseAppLegacySS, &app.ConsensusParamsKeeper) <----\n\n            // ...\n\n            return app.ModuleManager.RunMigrations(ctx, app.Configurator(), fromVM)\n        },\n    )\n\n  // ...\n}\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"x/params")," module should still be imported in your app.go in order to handle this migration."),(0,o.kt)("p",null,"Because the ",(0,o.kt)("inlineCode",{parentName:"p"},"x/consensus")," module is a new module, its store must be added while upgrading to v0.47.x:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"storetypes.StoreUpgrades{\n            Added: []string{\n                consensustypes.ModuleName,\n            },\n}\n")),(0,o.kt)("h5",{id:"appgo-changes"},(0,o.kt)("inlineCode",{parentName:"h5"},"app.go")," changes"),(0,o.kt)("p",null,"When using an ",(0,o.kt)("inlineCode",{parentName:"p"},"app.go")," without App Wiring, the following changes are required:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"- bApp.SetParamStore(app.ParamsKeeper.Subspace(baseapp.Paramspace).WithKeyTable(paramstypes.ConsensusParamsKeyTable()))\n+ app.ConsensusParamsKeeper = consensusparamkeeper.NewKeeper(appCodec, keys[consensusparamstypes.StoreKey], authtypes.NewModuleAddress(govtypes.ModuleName).String())\n+ bApp.SetParamStore(&app.ConsensusParamsKeeper)\n")),(0,o.kt)("p",null,"When using App Wiring, the paramater store is automatically set for you."),(0,o.kt)("h4",{id:"xnft-1"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/nft")),(0,o.kt)("p",null,"The SDK does not validate anymore the ",(0,o.kt)("inlineCode",{parentName:"p"},"classID")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"nftID")," of an NFT, for extra flexibility in your NFT implementation.\nThis means chain developers need to validate the ",(0,o.kt)("inlineCode",{parentName:"p"},"classID")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"nftID")," of an NFT."),(0,o.kt)("h3",{id:"ledger"},"Ledger"),(0,o.kt)("p",null,"Ledger support has been generalized to enable use of different apps and keytypes that use ",(0,o.kt)("inlineCode",{parentName:"p"},"secp256k1"),". The Ledger interface remains the same, but it can now be provided through the Keyring ",(0,o.kt)("inlineCode",{parentName:"p"},"Options"),", allowing higher-level chains to connect to different Ledger apps or use custom implementations. In addition, higher-level chains can provide custom key implementations around the Ledger public key, to enable greater flexibility with address generation and signing."),(0,o.kt)("p",null,"This is not a breaking change, as all values will default to use the standard Cosmos app implementation unless specified otherwise."),(0,o.kt)("h2",{id:"v046x"},(0,o.kt)("a",{parentName:"h2",href:"https://github.com/cosmos/cosmos-sdk/releases/tag/v0.46.0"},"v0.46.x")),(0,o.kt)("h3",{id:"go-api-changes"},"Go API Changes"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"replace google.golang.org/grpc")," directive can be removed from the ",(0,o.kt)("inlineCode",{parentName:"p"},"go.mod"),", it is no more required to block the version."),(0,o.kt)("p",null,"A few packages that were deprecated in the previous version are now removed."),(0,o.kt)("p",null,"For instance, the REST API, deprecated in v0.45, is now removed. If you have not migrated yet, please follow the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/v0.45/migrations/rest.html"},"instructions"),"."),(0,o.kt)("p",null,"To improve clarity of the API, some renaming and improvements has been done:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Package"),(0,o.kt)("th",{parentName:"tr",align:null},"Previous"),(0,o.kt)("th",{parentName:"tr",align:null},"Current"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"simapp")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"encodingConfig.Marshaler")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"encodingConfig.Codec"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"simapp")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"FundAccount"),", ",(0,o.kt)("inlineCode",{parentName:"td"},"FundModuleAccount")),(0,o.kt)("td",{parentName:"tr",align:null},"Functions moved to ",(0,o.kt)("inlineCode",{parentName:"td"},"x/bank/testutil"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"types")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"AccAddressFromHex")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"AccAddressFromHexUnsafe"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"x/auth")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"MempoolFeeDecorator")),(0,o.kt)("td",{parentName:"tr",align:null},"Use ",(0,o.kt)("inlineCode",{parentName:"td"},"DeductFeeDecorator")," instead")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"x/bank")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"AddressFromBalancesStore")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"AddressAndDenomFromBalancesStore"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"x/gov")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"keeper.DeleteDeposits")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"keeper.DeleteAndBurnDeposits"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"x/gov")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"keeper.RefundDeposits")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"keeper.RefundAndDeleteDeposits"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"x/{mod}")),(0,o.kt)("td",{parentName:"tr",align:null},"package ",(0,o.kt)("inlineCode",{parentName:"td"},"legacy")),(0,o.kt)("td",{parentName:"tr",align:null},"package ",(0,o.kt)("inlineCode",{parentName:"td"},"migrations"))))),(0,o.kt)("p",null,"For the exhaustive list of API renaming, please refer to the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/main/CHANGELOG.md"},"CHANGELOG"),"."),(0,o.kt)("h4",{id:"new-packages"},"new packages"),(0,o.kt)("p",null,"Additionally, new packages have been introduced in order to further split the codebase. Aliases are available for a new API breaking migration, but it is encouraged to migrate to this new packages:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"errors")," should replace ",(0,o.kt)("inlineCode",{parentName:"li"},"types/errors")," when registering errors or wrapping SDK errors."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"math")," contains the ",(0,o.kt)("inlineCode",{parentName:"li"},"Int")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"Uint")," types that are used in the SDK."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/nft")," an NFT base module."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x/group")," a group module allowing to create DAOs, multisig and policies. Greatly composes with ",(0,o.kt)("inlineCode",{parentName:"li"},"x/authz"),".")),(0,o.kt)("h4",{id:"xauthz"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/authz")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"authz.NewMsgGrant")," ",(0,o.kt)("inlineCode",{parentName:"li"},"expiration")," is now a pointer. When ",(0,o.kt)("inlineCode",{parentName:"li"},"nil")," is used, then no expiration will be set (grant won't expire)."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"authz.NewGrant")," takes a new argument: block time, to correctly validate expire time.")),(0,o.kt)("h3",{id:"keyring"},"Keyring"),(0,o.kt)("p",null,"The keyring has been refactored in v0.46."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"Unsafe*")," interfaces have been removed from the keyring package. Please use interface casting if you wish to access those unsafe functions."),(0,o.kt)("li",{parentName:"ul"},"The keys' implementation has been refactored to be serialized as proto."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"keyring.NewInMemory")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"keyring.New")," takes now a ",(0,o.kt)("inlineCode",{parentName:"li"},"codec.Codec"),"."),(0,o.kt)("li",{parentName:"ul"},"Take ",(0,o.kt)("inlineCode",{parentName:"li"},"keyring.Record")," instead of ",(0,o.kt)("inlineCode",{parentName:"li"},"Info")," as first argument in:",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"  * `MkConsKeyOutput`\n  * `MkValKeyOutput`\n  * `MkAccKeyOutput`\n"))),(0,o.kt)("li",{parentName:"ul"},"Rename:",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"  * `SavePubKey` to `SaveOfflineKey` and remove the `algo` argument.\n  * `NewMultiInfo`, `NewLedgerInfo`  to `NewLegacyMultiInfo`, `newLegacyLedgerInfo` respectively.\n  * `NewOfflineInfo` to `newLegacyOfflineInfo` and move it to `migration_test.go`.\n")))),(0,o.kt)("h3",{id:"posthandler"},"PostHandler"),(0,o.kt)("p",null,"A ",(0,o.kt)("inlineCode",{parentName:"p"},"postHandler")," is like an ",(0,o.kt)("inlineCode",{parentName:"p"},"antehandler"),", but is run ",(0,o.kt)("em",{parentName:"p"},"after")," the ",(0,o.kt)("inlineCode",{parentName:"p"},"runMsgs")," execution. It is in the same store branch that ",(0,o.kt)("inlineCode",{parentName:"p"},"runMsgs"),", meaning that both ",(0,o.kt)("inlineCode",{parentName:"p"},"runMsgs")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"postHandler"),". This allows to run a custom logic after the execution of the messages."),(0,o.kt)("h3",{id:"iavl"},"IAVL"),(0,o.kt)("p",null,'v0.19.0 IAVL introduces a new "fast" index. This index represents the latest state of the\nIAVL laid out in a format that preserves data locality by key. As a result, it allows for faster queries and iterations\nsince data can now be read in lexicographical order that is frequent for Cosmos-SDK chains.'),(0,o.kt)("p",null,"The first time the chain is started after the upgrade, the aforementioned index is created. The creation process\nmight take time and depends on the size of the latest state of the chain. For example, Osmosis takes around 15 minutes to rebuild the index."),(0,o.kt)("p",null,'While the index is being created, node operators can observe the following in the logs:\n"Upgrading IAVL storage for faster queries + execution on the live state. This may take a while". The store\nkey is appended to the message. The message is printed for every module that has a non-transient store.\nAs a result, it gives a good indication of the progress of the upgrade.'),(0,o.kt)("p",null,"There is also downgrade and re-upgrade protection. If a node operator chooses to downgrade to IAVL pre-fast index, and then upgrade again, the index is rebuilt from scratch. This implementation detail should not be relevant in most cases. It was added as a safeguard against operator\nmistakes."),(0,o.kt)("h3",{id:"modules-2"},"Modules"),(0,o.kt)("h4",{id:"xparams-1"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/params")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"x/params")," module has been depreacted in favour of each module housing and providing way to modify their parameters. Each module that has parameters that are changable during runtime have an authority, the authority can be a module or user account. The Cosmos SDK team recommends migrating modules away from using the param module. An example of how this could look like can be found ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/cosmos/cosmos-sdk/pull/12363"},"here"),". "),(0,o.kt)("li",{parentName:"ul"},"The Param module will be maintained until April 18, 2023. At this point the module will reach end of life and be removed from the Cosmos SDK.")),(0,o.kt)("h4",{id:"xgov-2"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/gov")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"gov")," module has been greatly improved. The previous API has been moved to ",(0,o.kt)("inlineCode",{parentName:"p"},"v1beta1")," while the new implementation is called ",(0,o.kt)("inlineCode",{parentName:"p"},"v1"),"."),(0,o.kt)("p",null,"In order to submit a proposal with ",(0,o.kt)("inlineCode",{parentName:"p"},"submit-proposal")," you now need to pass a ",(0,o.kt)("inlineCode",{parentName:"p"},"proposal.json")," file.\nYou can still use the old way by using ",(0,o.kt)("inlineCode",{parentName:"p"},"submit-legacy-proposal"),". This is not recommended.\nMore information can be found in the gov module ",(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/v0.46/modules/gov/07_client.html"},"client documentation"),"."),(0,o.kt)("h4",{id:"xstaking"},(0,o.kt)("inlineCode",{parentName:"h4"},"x/staking")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"staking module")," added a new message type to cancel unbonding delegations. Users that have unbonded by accident or wish to cancel a undelegation can now specify the amount and valdiator they would like to cancel the unbond from"),(0,o.kt)("h3",{id:"protobuf-2"},"Protobuf"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"third_party/proto")," folder that existed in ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/tree/v0.45.3/third_party/proto"},"previous version")," now does not contains directly the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/tree/release/v0.46.x/third_party/proto"},"proto files"),"."),(0,o.kt)("p",null,"Instead, the SDK uses ",(0,o.kt)("a",{parentName:"p",href:"https://buf.build"},(0,o.kt)("inlineCode",{parentName:"a"},"buf")),". Clients should have their own ",(0,o.kt)("a",{parentName:"p",href:"https://docs.buf.build/configuration/v1/buf-yaml"},(0,o.kt)("inlineCode",{parentName:"a"},"buf.yaml"))," with ",(0,o.kt)("inlineCode",{parentName:"p"},"buf.build/cosmos/cosmos-sdk")," as dependency, in order to avoid having to copy paste these files."),(0,o.kt)("p",null,"The protos can as well be downloaded using ",(0,o.kt)("inlineCode",{parentName:"p"},"buf export buf.build/cosmos/cosmos-sdk:8cb30a2c4de74dc9bd8d260b1e75e176 --output <some_folder>"),"."),(0,o.kt)("p",null,"Cosmos message protobufs should be extended with ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmos.msg.v1.signer"),": "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-protobuf"},'message MsgSetWithdrawAddress {\n  option (cosmos.msg.v1.signer) = "delegator_address"; ++\n\n  option (gogoproto.equal)           = false;\n  option (gogoproto.goproto_getters) = false;\n\n  string delegator_address = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string withdraw_address  = 2 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n}\n')),(0,o.kt)("p",null,"When clients interract with a node they are required to set a codec in in the grpc.Dial. More information can be found in this ",(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/v0.46/run-node/interact-node.html#programmatically-via-go"},"doc"),"."))}m.isMDXComponent=!0}}]);