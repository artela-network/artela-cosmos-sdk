"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[8622],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>u});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),d=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=d(e.components);return a.createElement(s.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),c=d(t),u=i,h=c["".concat(s,".").concat(u)]||c[u]||m[u]||o;return t?a.createElement(h,l(l({ref:n},p),{},{components:t})):a.createElement(h,l({ref:n},p))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,l=new Array(o);l[0]=c;var r={};for(var s in n)hasOwnProperty.call(n,s)&&(r[s]=n[s]);r.originalType=e,r.mdxType="string"==typeof e?e:i,l[1]=r;for(var d=2;d<o;d++)l[d]=t[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},22168:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var a=t(87462),i=(t(67294),t(3905));const o={sidebar_position:1},l="Module Manager",r={unversionedId:"building-modules/module-manager",id:"version-v0.47/building-modules/module-manager",title:"Module Manager",description:"Cosmos SDK modules need to implement the AppModule interfaces, in order to be managed by the application's module manager. The module manager plays an important role in message and query routing, and allows application developers to set the order of execution of a variety of functions like BeginBlocker and EndBlocker.",source:"@site/versioned_docs/version-v0.47/building-modules/01-module-manager.md",sourceDirName:"building-modules",slug:"/building-modules/module-manager",permalink:"/v0.47/building-modules/module-manager",draft:!1,tags:[],version:"v0.47",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Introduction to Cosmos SDK Modules",permalink:"/v0.47/building-modules/intro"},next:{title:"Messages and Queries",permalink:"/v0.47/building-modules/messages-and-queries"}},s={},d=[{value:"Application Module Interfaces",id:"application-module-interfaces",level:2},{value:"<code>AppModuleBasic</code>",id:"appmodulebasic",level:3},{value:"<code>HasName</code>",id:"hasname",level:3},{value:"<code>HasGenesisBasics</code>",id:"hasgenesisbasics",level:3},{value:"<code>AppModuleGenesis</code>",id:"appmodulegenesis",level:3},{value:"<code>HasGenesis</code>",id:"hasgenesis",level:3},{value:"<code>AppModule</code>",id:"appmodule",level:3},{value:"<code>HasInvariants</code>",id:"hasinvariants",level:3},{value:"<code>HasServices</code>",id:"hasservices",level:3},{value:"<code>HasConsensusVersion</code>",id:"hasconsensusversion",level:3},{value:"<code>BeginBlockAppModule</code>",id:"beginblockappmodule",level:3},{value:"<code>EndBlockAppModule</code>",id:"endblockappmodule",level:3},{value:"Implementing the Application Module Interfaces",id:"implementing-the-application-module-interfaces",level:3},{value:"Module Managers",id:"module-managers",level:2},{value:"<code>BasicManager</code>",id:"basicmanager",level:3},{value:"<code>Manager</code>",id:"manager",level:3}],p={toc:d};function m(e){let{components:n,...t}=e;return(0,i.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"module-manager"},"Module Manager"),(0,i.kt)("admonition",{title:"Synopsis",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Cosmos SDK modules need to implement the ",(0,i.kt)("a",{parentName:"p",href:"#application-module-interfaces"},(0,i.kt)("inlineCode",{parentName:"a"},"AppModule")," interfaces"),", in order to be managed by the application's ",(0,i.kt)("a",{parentName:"p",href:"#module-manager"},"module manager"),". The module manager plays an important role in ",(0,i.kt)("a",{parentName:"p",href:"/v0.47/core/baseapp#routing"},(0,i.kt)("inlineCode",{parentName:"a"},"message")," and ",(0,i.kt)("inlineCode",{parentName:"a"},"query")," routing"),", and allows application developers to set the order of execution of a variety of functions like ",(0,i.kt)("a",{parentName:"p",href:"/v0.47/basics/app-anatomy#begingblocker-and-endblocker"},(0,i.kt)("inlineCode",{parentName:"a"},"BeginBlocker")," and ",(0,i.kt)("inlineCode",{parentName:"a"},"EndBlocker")),".")),(0,i.kt)("admonition",{title:"Pre-requisite Readings",type:"note"},(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/intro"},"Introduction to Cosmos SDK Modules")))),(0,i.kt)("h2",{id:"application-module-interfaces"},"Application Module Interfaces"),(0,i.kt)("p",null,"Application module interfaces exist to facilitate the composition of modules together to form a functional Cosmos SDK application.\nThere are 4 main application module interfaces:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#appmodulebasic"},(0,i.kt)("inlineCode",{parentName:"a"},"AppModuleBasic"))," for independent module functionalities."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#appmodule"},(0,i.kt)("inlineCode",{parentName:"a"},"AppModule"))," for inter-dependent module functionalities (except genesis-related functionalities)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#appmodulegenesis"},(0,i.kt)("inlineCode",{parentName:"a"},"AppModuleGenesis"))," for inter-dependent genesis-related module functionalities."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"GenesisOnlyAppModule"),": Defines an ",(0,i.kt)("inlineCode",{parentName:"li"},"AppModule")," that only has import/export functionality")),(0,i.kt)("p",null,"The above interfaces are mostly embedding smaller interfaces (extension interfaces), that defines specific functionalities:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"HasName"),": Allows the module to provide its own name for legacy purposes."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#hasgenesisbasics"},(0,i.kt)("inlineCode",{parentName:"a"},"HasGenesisBasics")),": The legacy interface for stateless genesis methods."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#hasgenesis"},(0,i.kt)("inlineCode",{parentName:"a"},"HasGenesis")),": The extension interface for stateful genesis methods."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#hasinvariants"},(0,i.kt)("inlineCode",{parentName:"a"},"HasInvariants")),": The extension interface for registering invariants."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#hasservices"},(0,i.kt)("inlineCode",{parentName:"a"},"HasServices")),": The extension interface for modules to register services."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#hasconsensusversion"},(0,i.kt)("inlineCode",{parentName:"a"},"HasConsensusVersion")),": The extension interface for declaring a module consensus version."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#beginblockappmodule"},(0,i.kt)("inlineCode",{parentName:"a"},"BeginBlockAppModule")),": The extension interface that contains information about the ",(0,i.kt)("inlineCode",{parentName:"li"},"AppModule")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"BeginBlock"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#endblockappmodule"},(0,i.kt)("inlineCode",{parentName:"a"},"EndBlockAppModule")),": The extension interface that contains information about the ",(0,i.kt)("inlineCode",{parentName:"li"},"AppModule")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"EndBlock"),".")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," interface exists to define independent methods of the module, i.e. those that do not depend on other modules in the application. This allows for the construction of the basic application structure early in the application definition, generally in the ",(0,i.kt)("inlineCode",{parentName:"p"},"init()")," function of the ",(0,i.kt)("a",{parentName:"p",href:"/v0.47/basics/app-anatomy#core-application-file"},"main application file"),"."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule")," interface exists to define inter-dependent module methods. Many modules need to interact with other modules, typically through ",(0,i.kt)("a",{parentName:"p",href:"/v0.47/building-modules/keeper"},(0,i.kt)("inlineCode",{parentName:"a"},"keeper"),"s"),", which means there is a need for an interface where modules list their ",(0,i.kt)("inlineCode",{parentName:"p"},"keeper"),"s and other methods that require a reference to another module's object. ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule")," interface extension, such as ",(0,i.kt)("inlineCode",{parentName:"p"},"BeginBlockAppModule")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"EndBlockAppModule"),", also enables the module manager to set the order of execution between module's methods like ",(0,i.kt)("inlineCode",{parentName:"p"},"BeginBlock")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"EndBlock"),", which is important in cases where the order of execution between modules matters in the context of the application."),(0,i.kt)("p",null,"The usage of extension interfaces allows modules to define only the functionalities they need. For example, a module that does not need an ",(0,i.kt)("inlineCode",{parentName:"p"},"EndBlock")," does not need to define the ",(0,i.kt)("inlineCode",{parentName:"p"},"EndBlockAppModule")," interface and thus the ",(0,i.kt)("inlineCode",{parentName:"p"},"EndBlock")," method. ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleGenesis")," are voluntarily small interfaces, that can take advantage of the ",(0,i.kt)("inlineCode",{parentName:"p"},"Module")," patterns without having to define many placeholder functions."),(0,i.kt)("h3",{id:"appmodulebasic"},(0,i.kt)("inlineCode",{parentName:"h3"},"AppModuleBasic")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," interface defines the independent methods modules need to implement."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L49-L59\n")),(0,i.kt)("p",null,"Let us go through the methods:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterLegacyAminoCodec(*codec.LegacyAmino)"),": Registers the ",(0,i.kt)("inlineCode",{parentName:"li"},"amino")," codec for the module, which is used to marshal and unmarshal structs to/from ",(0,i.kt)("inlineCode",{parentName:"li"},"[]byte")," in order to persist them in the module's ",(0,i.kt)("inlineCode",{parentName:"li"},"KVStore"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterInterfaces(codectypes.InterfaceRegistry)"),": Registers a module's interface types and their concrete implementations as ",(0,i.kt)("inlineCode",{parentName:"li"},"proto.Message"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterGRPCGatewayRoutes(client.Context, *runtime.ServeMux)"),": Registers gRPC routes for the module."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"GetTxCmd()"),": Returns the root ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/module-interfaces#tx"},(0,i.kt)("inlineCode",{parentName:"a"},"Tx")," command")," for the module. The subcommands of this root command are used by end-users to generate new transactions containing ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/messages-and-queries#queries"},(0,i.kt)("inlineCode",{parentName:"a"},"message"),"s")," defined in the module."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"GetQueryCmd()"),": Return the root ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/module-interfaces#query"},(0,i.kt)("inlineCode",{parentName:"a"},"query")," command")," for the module. The subcommands of this root command are used by end-users to generate new queries to the subset of the state defined by the module.")),(0,i.kt)("p",null,"All the ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," of an application are managed by the ",(0,i.kt)("a",{parentName:"p",href:"#basicmanager"},(0,i.kt)("inlineCode",{parentName:"a"},"BasicManager")),"."),(0,i.kt)("h3",{id:"hasname"},(0,i.kt)("inlineCode",{parentName:"h3"},"HasName")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L61-L66\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"HasName")," is an interface that has a method ",(0,i.kt)("inlineCode",{parentName:"li"},"Name()"),". This method returns the name of the module as a ",(0,i.kt)("inlineCode",{parentName:"li"},"string"),".")),(0,i.kt)("h3",{id:"hasgenesisbasics"},(0,i.kt)("inlineCode",{parentName:"h3"},"HasGenesisBasics")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L68-L72\n")),(0,i.kt)("p",null,"Let us go through the methods:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"DefaultGenesis(codec.JSONCodec)"),": Returns a default ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/genesis#genesisstate"},(0,i.kt)("inlineCode",{parentName:"a"},"GenesisState"))," for the module, marshalled to ",(0,i.kt)("inlineCode",{parentName:"li"},"json.RawMessage"),". The default ",(0,i.kt)("inlineCode",{parentName:"li"},"GenesisState")," need to be defined by the module developer and is primarily used for testing."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ValidateGenesis(codec.JSONCodec, client.TxEncodingConfig, json.RawMessage)"),": Used to validate the ",(0,i.kt)("inlineCode",{parentName:"li"},"GenesisState")," defined by a module, given in its ",(0,i.kt)("inlineCode",{parentName:"li"},"json.RawMessage")," form. It will usually unmarshall the ",(0,i.kt)("inlineCode",{parentName:"li"},"json")," before running a custom ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/genesis#validategenesis"},(0,i.kt)("inlineCode",{parentName:"a"},"ValidateGenesis"))," function defined by the module developer.")),(0,i.kt)("h3",{id:"appmodulegenesis"},(0,i.kt)("inlineCode",{parentName:"h3"},"AppModuleGenesis")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleGenesis")," interface is a simple embedding of the ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"HasGenesis")," interfaces."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L156-L160\n")),(0,i.kt)("p",null,"It does not have its own manager, and exists separately from ",(0,i.kt)("a",{parentName:"p",href:"#appmodule"},(0,i.kt)("inlineCode",{parentName:"a"},"AppModule"))," only for modules that exist only to implement genesis functionalities, so that they can be managed without having to implement all of ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule"),"'s methods."),(0,i.kt)("h3",{id:"hasgenesis"},(0,i.kt)("inlineCode",{parentName:"h3"},"HasGenesis")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"HasGenesis")," interface is an extension interface of ",(0,i.kt)("inlineCode",{parentName:"p"},"HasGenesisBasics"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L162-L167\n")),(0,i.kt)("p",null,"Let us go through the two added methods:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"InitGenesis(sdk.Context, codec.JSONCodec, json.RawMessage)"),": Initializes the subset of the state managed by the module. It is called at genesis (i.e. when the chain is first started)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ExportGenesis(sdk.Context, codec.JSONCodec)"),": Exports the latest subset of the state managed by the module to be used in a new genesis file. ",(0,i.kt)("inlineCode",{parentName:"li"},"ExportGenesis")," is called for each module when a new chain is started from the state of an existing chain.")),(0,i.kt)("h3",{id:"appmodule"},(0,i.kt)("inlineCode",{parentName:"h3"},"AppModule")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule")," interface defines a module. Modules can declare their functionalities by implementing extensions interfaces."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L169-L173\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"AppModule"),"s are managed by the ",(0,i.kt)("a",{parentName:"p",href:"#manager"},"module manager"),", which checks which extension interfaces are implemented by the module."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Previously the ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule")," interface was containing all the methods that are defined in the extensions interfaces. This was leading to much boilerplate for modules that did not need all the functionalities.")),(0,i.kt)("h3",{id:"hasinvariants"},(0,i.kt)("inlineCode",{parentName:"h3"},"HasInvariants")),(0,i.kt)("p",null,"This interface defines one method. It allows to checks if a module can register invariants."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L175-L179\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterInvariants(sdk.InvariantRegistry)"),": Registers the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/invariants"},(0,i.kt)("inlineCode",{parentName:"a"},"invariants"))," of the module. If an invariant deviates from its predicted value, the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/invariants#registry"},(0,i.kt)("inlineCode",{parentName:"a"},"InvariantRegistry"))," triggers appropriate logic (most often the chain will be halted).")),(0,i.kt)("h3",{id:"hasservices"},(0,i.kt)("inlineCode",{parentName:"h3"},"HasServices")),(0,i.kt)("p",null,"This interface defines one method. It allows to checks if a module can register invariants."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L181-L185\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterServices(Configurator)"),": Allows a module to register services.")),(0,i.kt)("h3",{id:"hasconsensusversion"},(0,i.kt)("inlineCode",{parentName:"h3"},"HasConsensusVersion")),(0,i.kt)("p",null,"This interface defines one method for checking a module consensus version."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L187-L194\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ConsensusVersion() uint64"),": Returns the consensus version of the module.")),(0,i.kt)("h3",{id:"beginblockappmodule"},(0,i.kt)("inlineCode",{parentName:"h3"},"BeginBlockAppModule")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"BeginBlockAppModule")," is an extension interface from ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule"),". All modules that have an ",(0,i.kt)("inlineCode",{parentName:"p"},"BeginBlock")," method implement this interface."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L196-L200\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"BeginBlock(sdk.Context, abci.RequestBeginBlock)"),": This method gives module developers the option to implement logic that is automatically triggered at the beginning of each block. Implement empty if no logic needs to be triggered at the beginning of each block for this module.")),(0,i.kt)("h3",{id:"endblockappmodule"},(0,i.kt)("inlineCode",{parentName:"h3"},"EndBlockAppModule")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"EndBlockAppModule")," is an extension interface from ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule"),". All modules that have an ",(0,i.kt)("inlineCode",{parentName:"p"},"EndBlock")," method implement this interface."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L202-L206\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"EndBlock(sdk.Context, abci.RequestEndBlock)"),": This method gives module developers the option to implement logic that is automatically triggered at the end of each block. This is also where the module can inform the underlying consensus engine of validator set changes (e.g. the ",(0,i.kt)("inlineCode",{parentName:"li"},"staking")," module). Implement empty if no logic needs to be triggered at the end of each block for this module.")),(0,i.kt)("h3",{id:"implementing-the-application-module-interfaces"},"Implementing the Application Module Interfaces"),(0,i.kt)("p",null,"Typically, the various application module interfaces are implemented in a file called ",(0,i.kt)("inlineCode",{parentName:"p"},"module.go"),", located in the module's folder (e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"./x/module/module.go"),")."),(0,i.kt)("p",null,"Almost every module needs to implement the ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule")," interfaces. If the module is only used for genesis, it will implement ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleGenesis")," instead of ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule"),". The concrete type that implements the interface can add parameters that are required for the implementation of the various methods of the interface. For example, the ",(0,i.kt)("inlineCode",{parentName:"p"},"Route()")," function often calls a ",(0,i.kt)("inlineCode",{parentName:"p"},"NewMsgServerImpl(k keeper)")," function defined in ",(0,i.kt)("inlineCode",{parentName:"p"},"keeper/msg_server.go")," and therefore needs to pass the module's ",(0,i.kt)("a",{parentName:"p",href:"/v0.47/building-modules/keeper"},(0,i.kt)("inlineCode",{parentName:"a"},"keeper"))," as a parameter."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"// example\ntype AppModule struct {\n    AppModuleBasic\n    keeper       Keeper\n}\n")),(0,i.kt)("p",null,"In the example above, you can see that the ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule")," concrete type references an ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleBasic"),", and not an ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleGenesis"),". That is because ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleGenesis")," only needs to be implemented in modules that focus on genesis-related functionalities. In most modules, the concrete ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule")," type will have a reference to an ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," and implement the two added methods of ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleGenesis")," directly in the ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule")," type."),(0,i.kt)("p",null,"If no parameter is required (which is often the case for ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleBasic"),"), just declare an empty concrete type like so:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"type AppModuleBasic struct{}\n")),(0,i.kt)("h2",{id:"module-managers"},"Module Managers"),(0,i.kt)("p",null,"Module managers are used to manage collections of ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule"),"."),(0,i.kt)("h3",{id:"basicmanager"},(0,i.kt)("inlineCode",{parentName:"h3"},"BasicManager")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"BasicManager")," is a structure that lists all the ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModuleBasic")," of an application:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L74-L84\n")),(0,i.kt)("p",null,"It implements the following methods:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"NewBasicManager(modules ...AppModuleBasic)"),": Constructor function. It takes a list of the application's ",(0,i.kt)("inlineCode",{parentName:"li"},"AppModuleBasic")," and builds a new ",(0,i.kt)("inlineCode",{parentName:"li"},"BasicManager"),". This function is generally called in the ",(0,i.kt)("inlineCode",{parentName:"li"},"init()")," function of ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/basics/app-anatomy#core-application-file"},(0,i.kt)("inlineCode",{parentName:"a"},"app.go"))," to quickly initialize the independent elements of the application's modules (click ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/cosmos/gaia/blob/main/app/app.go#L59-L74"},"here")," to see an example)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterLegacyAminoCodec(cdc *codec.LegacyAmino)"),": Registers the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/core/encoding#amino"},(0,i.kt)("inlineCode",{parentName:"a"},"codec.LegacyAmino"),"s")," of each of the application's ",(0,i.kt)("inlineCode",{parentName:"li"},"AppModuleBasic"),". This function is usually called early on in the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/basics/app-anatomy#constructor"},"application's construction"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterInterfaces(registry codectypes.InterfaceRegistry)"),": Registers interface types and implementations of each of the application's ",(0,i.kt)("inlineCode",{parentName:"li"},"AppModuleBasic"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"DefaultGenesis(cdc codec.JSONCodec)"),": Provides default genesis information for modules in the application by calling the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/genesis#defaultgenesis"},(0,i.kt)("inlineCode",{parentName:"a"},"DefaultGenesis(cdc codec.JSONCodec)"))," function of each module. It only calls the modules that implements the ",(0,i.kt)("inlineCode",{parentName:"li"},"HasGenesisBasics")," interfaces."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ValidateGenesis(cdc codec.JSONCodec, txEncCfg client.TxEncodingConfig, genesis map[string]json.RawMessage)"),": Validates the genesis information modules by calling the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/genesis#validategenesis"},(0,i.kt)("inlineCode",{parentName:"a"},"ValidateGenesis(codec.JSONCodec, client.TxEncodingConfig, json.RawMessage)"))," function of modules implementing the ",(0,i.kt)("inlineCode",{parentName:"li"},"HasGenesisBasics")," interface."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterGRPCGatewayRoutes(clientCtx client.Context, rtr *runtime.ServeMux)"),": Registers gRPC routes for modules."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"AddTxCommands(rootTxCmd *cobra.Command)"),": Adds modules' transaction commands to the application's ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/core/cli#transaction-commands"},(0,i.kt)("inlineCode",{parentName:"a"},"rootTxCommand")),". This function is usually called function from the ",(0,i.kt)("inlineCode",{parentName:"li"},"main.go")," function of the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/core/cli"},"application's command-line interface"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"AddQueryCommands(rootQueryCmd *cobra.Command)"),": Adds modules' query commands to the application's ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/core/cli#query-commands"},(0,i.kt)("inlineCode",{parentName:"a"},"rootQueryCommand")),". This function is usually called function from the ",(0,i.kt)("inlineCode",{parentName:"li"},"main.go")," function of the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/core/cli"},"application's command-line interface"),".")),(0,i.kt)("h3",{id:"manager"},(0,i.kt)("inlineCode",{parentName:"h3"},"Manager")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Manager")," is a structure that holds all the ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule")," of an application, and defines the order of execution between several key components of these modules:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/types/module/module.go#L246-L273\n")),(0,i.kt)("p",null,"The module manager is used throughout the application whenever an action on a collection of modules is required. It implements the following methods:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"NewManager(modules ...AppModule)"),": Constructor function. It takes a list of the application's ",(0,i.kt)("inlineCode",{parentName:"li"},"AppModule"),"s and builds a new ",(0,i.kt)("inlineCode",{parentName:"li"},"Manager"),". It is generally called from the application's main ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/basics/app-anatomy#constructor-function"},"constructor function"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SetOrderInitGenesis(moduleNames ...string)"),": Sets the order in which the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/genesis#initgenesis"},(0,i.kt)("inlineCode",{parentName:"a"},"InitGenesis"))," function of each module will be called when the application is first started. This function is generally called from the application's main ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/basics/app-anatomy#constructor-function"},"constructor function"),".\nTo initialize modules successfully, module dependencies should be considered. For example, the ",(0,i.kt)("inlineCode",{parentName:"li"},"genutil")," module must occur after ",(0,i.kt)("inlineCode",{parentName:"li"},"staking")," module so that the pools are properly initialized with tokens from genesis accounts, the ",(0,i.kt)("inlineCode",{parentName:"li"},"genutils")," module must also occur after ",(0,i.kt)("inlineCode",{parentName:"li"},"auth")," so that it can access the params from auth, ",(0,i.kt)("inlineCode",{parentName:"li"},"capability")," module should be initialized before all other modules so that it can initialize any capabilities."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SetOrderExportGenesis(moduleNames ...string)"),": Sets the order in which the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/genesis#exportgenesis"},(0,i.kt)("inlineCode",{parentName:"a"},"ExportGenesis"))," function of each module will be called in case of an export. This function is generally called from the application's main ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/basics/app-anatomy#constructor-function"},"constructor function"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SetOrderBeginBlockers(moduleNames ...string)"),": Sets the order in which the ",(0,i.kt)("inlineCode",{parentName:"li"},"BeginBlock()")," function of each module will be called at the beginning of each block. This function is generally called from the application's main ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/basics/app-anatomy#constructor-function"},"constructor function"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SetOrderEndBlockers(moduleNames ...string)"),": Sets the order in which the ",(0,i.kt)("inlineCode",{parentName:"li"},"EndBlock()")," function of each module will be called at the end of each block. This function is generally called from the application's main ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/basics/app-anatomy#constructor-function"},"constructor function"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SetOrderMigrations(moduleNames ...string)"),": Sets the order of migrations to be run. If not set then migrations will be run with an order defined in ",(0,i.kt)("inlineCode",{parentName:"li"},"DefaultMigrationsOrder"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterInvariants(ir sdk.InvariantRegistry)"),": Registers the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/invariants"},"invariants")," of module implementing the ",(0,i.kt)("inlineCode",{parentName:"li"},"HasInvariants")," interface."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterRoutes(router sdk.Router, queryRouter sdk.QueryRouter, legacyQuerierCdc *codec.LegacyAmino)"),": Registers legacy ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/messages-and-queries#messages"},(0,i.kt)("inlineCode",{parentName:"a"},"Msg"))," and ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/query-services#legacy-queriers"},(0,i.kt)("inlineCode",{parentName:"a"},"querier"))," routes."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterServices(cfg Configurator)"),": Registers the services of modules implementing the ",(0,i.kt)("inlineCode",{parentName:"li"},"HasServices")," interface."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"InitGenesis(ctx sdk.Context, cdc codec.JSONCodec, genesisData map[string]json.RawMessage)"),": Calls the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/genesis#initgenesis"},(0,i.kt)("inlineCode",{parentName:"a"},"InitGenesis"))," function of each module when the application is first started, in the order defined in ",(0,i.kt)("inlineCode",{parentName:"li"},"OrderInitGenesis"),". Returns an ",(0,i.kt)("inlineCode",{parentName:"li"},"abci.ResponseInitChain")," to the underlying consensus engine, which can contain validator updates."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ExportGenesis(ctx sdk.Context, cdc codec.JSONCodec)"),": Calls the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/genesis#exportgenesis"},(0,i.kt)("inlineCode",{parentName:"a"},"ExportGenesis"))," function of each module, in the order defined in ",(0,i.kt)("inlineCode",{parentName:"li"},"OrderExportGenesis"),". The export constructs a genesis file from a previously existing state, and is mainly used when a hard-fork upgrade of the chain is required."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ExportGenesisForModules(ctx sdk.Context, cdc codec.JSONCodec, modulesToExport []string)"),": Behaves the same as ",(0,i.kt)("inlineCode",{parentName:"li"},"ExportGenesis"),", except takes a list of modules to export."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"BeginBlock(ctx sdk.Context, req abci.RequestBeginBlock)"),": At the beginning of each block, this function is called from ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/core/baseapp#beginblock"},(0,i.kt)("inlineCode",{parentName:"a"},"BaseApp"))," and, in turn, calls the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/beginblock-endblock"},(0,i.kt)("inlineCode",{parentName:"a"},"BeginBlock"))," function of each modules implementing the ",(0,i.kt)("inlineCode",{parentName:"li"},"BeginBlockAppModule")," interface, in the order defined in ",(0,i.kt)("inlineCode",{parentName:"li"},"OrderBeginBlockers"),". It creates a child ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/core/context"},"context")," with an event manager to aggregate ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/core/events"},"events")," emitted from all modules. The function returns an ",(0,i.kt)("inlineCode",{parentName:"li"},"abci.ResponseBeginBlock")," which contains the aforementioned events."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"EndBlock(ctx sdk.Context, req abci.RequestEndBlock)"),": At the end of each block, this function is called from ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/core/baseapp#endblock"},(0,i.kt)("inlineCode",{parentName:"a"},"BaseApp"))," and, in turn, calls the ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/building-modules/beginblock-endblock"},(0,i.kt)("inlineCode",{parentName:"a"},"EndBlock"))," function of each modules implementing the ",(0,i.kt)("inlineCode",{parentName:"li"},"EndBlockAppModule")," interface, in the order defined in ",(0,i.kt)("inlineCode",{parentName:"li"},"OrderEndBlockers"),". It creates a child ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/core/context"},"context")," with an event manager to aggregate ",(0,i.kt)("a",{parentName:"li",href:"/v0.47/core/events"},"events")," emitted from all modules. The function returns an ",(0,i.kt)("inlineCode",{parentName:"li"},"abci.ResponseEndBlock")," which contains the aforementioned events, as well as validator set updates (if any).")),(0,i.kt)("p",null,"Here's an example of a concrete integration within an ",(0,i.kt)("inlineCode",{parentName:"p"},"simapp"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/simapp/app.go#L386-L432\n")),(0,i.kt)("p",null,"This is the same example from ",(0,i.kt)("inlineCode",{parentName:"p"},"runtime")," (the package that powers app v2):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/runtime/module.go#L77\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.47.0-rc1/runtime/module.go#L87\n")))}m.isMDXComponent=!0}}]);