"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[5369],{3905:(e,t,i)=>{i.d(t,{Zo:()=>h,kt:()=>p});var a=i(67294);function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function s(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?o(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function r(e,t){if(null==e)return{};var i,a,n=function(e,t){if(null==e)return{};var i,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)i=o[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)i=o[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var l=a.createContext({}),d=function(e){var t=a.useContext(l),i=t;return e&&(i="function"==typeof e?e(t):s(s({},t),e)),i},h=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var i=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,h=r(e,["components","mdxType","originalType","parentName"]),u=d(i),p=n,m=u["".concat(l,".").concat(p)]||u[p]||c[p]||o;return i?a.createElement(m,s(s({ref:t},h),{},{components:i})):a.createElement(m,s({ref:t},h))}));function p(e,t){var i=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=i.length,s=new Array(o);s[0]=u;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r.mdxType="string"==typeof e?e:n,s[1]=r;for(var d=2;d<o;d++)s[d]=i[d];return a.createElement.apply(null,s)}return a.createElement.apply(null,i)}u.displayName="MDXCreateElement"},59877:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var a=i(87462),n=(i(67294),i(3905));const o={},s="ADR ADR-061: Liquid Staking",r={unversionedId:"architecture/adr-061-liquid-staking",id:"version-v0.47/architecture/adr-061-liquid-staking",title:"ADR ADR-061: Liquid Staking",description:"Changelog",source:"@site/versioned_docs/version-v0.47/architecture/adr-061-liquid-staking.md",sourceDirName:"architecture",slug:"/architecture/adr-061-liquid-staking",permalink:"/v0.47/architecture/adr-061-liquid-staking",draft:!1,tags:[],version:"v0.47",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ADR 60: ABCI 1.0 Integration",permalink:"/v0.47/architecture/adr-060-abci-1.0"},next:{title:"ADR {ADR-NUMBER}:",permalink:"/v0.47/architecture/adr-template"}},l={},d=[{value:"Changelog",id:"changelog",level:2},{value:"Status",id:"status",level:2},{value:"Abstract",id:"abstract",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"<code>MsgTokenizeShares</code>",id:"msgtokenizeshares",level:3},{value:"<code>MsgRedeemTokensforShares</code>",id:"msgredeemtokensforshares",level:3},{value:"<code>MsgTransferTokenizeShareRecord</code>",id:"msgtransfertokenizesharerecord",level:3},{value:"<code>MsgExemptDelegation</code>",id:"msgexemptdelegation",level:3},{value:"Consequences",id:"consequences",level:2},{value:"Backwards Compatibility",id:"backwards-compatibility",level:3},{value:"Positive",id:"positive",level:3}],h={toc:d};function c(e){let{components:t,...i}=e;return(0,n.kt)("wrapper",(0,a.Z)({},h,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"adr-adr-061-liquid-staking"},"ADR ADR-061: Liquid Staking"),(0,n.kt)("h2",{id:"changelog"},"Changelog"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"2022-09-10: Initial Draft (@zmanian)")),(0,n.kt)("h2",{id:"status"},"Status"),(0,n.kt)("p",null,"PROPOSED"),(0,n.kt)("h2",{id:"abstract"},"Abstract"),(0,n.kt)("p",null,"Add a semi-fungible liquid staking primitive to the default Cosmos SDK staking module. This upgrades proof of stake to enable safe designs with lower overall monetary issuance and integration with numerous liquid staking protocols like Stride, Persistence, Quicksilver, Lido etc."),(0,n.kt)("h2",{id:"context"},"Context"),(0,n.kt)("p",null,"The original release of the Cosmos Hub featured the implementation of a ground breaking proof of stake mechanism featuring delegation, slashing, in protocol reward distribution and adaptive issuance. This design was state of the art for 2016 and has been deployed without major changes by many L1 blockchains."),(0,n.kt)("p",null,"As both Proof of Stake and blockchain use cases have matured, this design has aged poorly and should no longer be considered a good baseline Proof of Stake issuance. In the world of application specific blockchains, there cannot be a one size fits all blockchain but the Cosmos SDK does endeavour to provide a good baseline implementation and one that is suitable for the Cosmos Hub."),(0,n.kt)("p",null,"The most important deficiency of the legacy staking design is that it composes poorly with on chain protocols for trading, lending, derivatives that are referred to collectively as DeFi. The legacy staking implementation starves these applications of liquidity by increasing the risk free rate adaptively. It basically makes DeFi and staking security somewhat incompatible. "),(0,n.kt)("p",null,"The Osmosis team has adopted the idea of Superfluid and Interfluid staking where assets that are participating in DeFi appliactions can also be used in proof of stake. This requires tight integration with an enshrined set of DeFi applications and thus is unsuitable for the Cosmos SDK."),(0,n.kt)("p",null,"It's also important to note that Interchain Accounts are available in the default IBC implementation and can be used to ",(0,n.kt)("a",{parentName:"p",href:"https://www.investopedia.com/terms/h/hypothecation.asp#toc-what-is-rehypothecation"},"rehypothecate")," delegations. Thus liquid staking is already possible and these changes merely improve the UX of liquid staking. Centralized exchanges also rehypothecate staked assets, posing challenges for decentralization. This ADR takes the position that adoption of in-protocol liquid staking is the preferable outcome and provides new levers to incentivize decentralization of stake. "),(0,n.kt)("p",null,"These changes to the staking module have been in development for more than a year and have seen substantial industry adoption who plan to build staking UX. The internal economics at Informal team has also done a review of the impacts of these changes and this review led to the development of the exempt delegation system. This system provides governance with a tuneable parameter for modulating the risks of principal agent problem called the exemption factor. "),(0,n.kt)("h2",{id:"decision"},"Decision"),(0,n.kt)("p",null,"We implement the semi-fungible liquid staking system and exemption factor system within the cosmos sdk. Though registered as fungible assets, these tokenized shares have extremely limited fungibility, only among the specific delegation record that was created when shares were tokenized. These assets can be used for OTC trades but composability with DeFi is limited. The primary expected use case is improving the user experience of liquid staking providers."),(0,n.kt)("p",null,"A new governance parameter is introduced that defines the ratio of exempt to issued tokenized shares. This is called the exemption factor. A larger exemption factor allows more tokenized shares to be issued for a smaller amount of exempt delegations. If governance is comfortable with how the liquid staking market is evolving, it makes sense to increase this value."),(0,n.kt)("p",null,"Min self delegation is removed from the staking system with the expectation that it will be replaced by the exempt delegations system. The exempt delegation system allows multiple accounts to demonstrate economic alignment with the validator operator as team members, partners etc. without co-mingling funds. Delegation exemption will likely be required to grow the validators' business under widespread adoption of liquid staking once governance has adjusted the exemption factor."),(0,n.kt)("p",null,"When shares are tokenized, the underlying shares are transfered to a module account and rewards go to the module account for the TokenizedShareRecord. "),(0,n.kt)("p",null,"There is no longer a mechanism to override the validators vote for TokenizedShares."),(0,n.kt)("h3",{id:"msgtokenizeshares"},(0,n.kt)("inlineCode",{parentName:"h3"},"MsgTokenizeShares")),(0,n.kt)("p",null,"The MsgTokenizeShares message is used to create tokenize delegated tokens. This message can be executed by any delegator who has positive amount of delegation and after execution the specific amount of delegation disappear from the account and share tokens are provided. Share tokens are denominated in the validator and record id of the underlying delegation."),(0,n.kt)("p",null,"A user may tokenize some or all of their delegation."),(0,n.kt)("p",null,"They will receive shares with the denom of ",(0,n.kt)("inlineCode",{parentName:"p"},"cosmosvaloper1xxxx/5")," where 5 is the record id for the validator operator."),(0,n.kt)("p",null,"MsgTokenizeShares fails if the account is a VestingAccount. Users will have to move vested tokens to a new account and endure the unbonding period. We view this as an acceptable tradeoff vs. the complex book keeping required to track vested tokens."),(0,n.kt)("p",null,"The total amount of outstanding tokenized shares for the validator is checked against the sum of exempt delegations multiplied by the exemption factor. If the tokenized shares exceeds this limit, execution fails."),(0,n.kt)("p",null,"MsgTokenizeSharesResponse provides the number of tokens generated and their denom."),(0,n.kt)("h3",{id:"msgredeemtokensforshares"},(0,n.kt)("inlineCode",{parentName:"h3"},"MsgRedeemTokensforShares")),(0,n.kt)("p",null,"The MsgRedeemTokensforShares message is used to redeem the delegation from share tokens. This message can be executed by any user who owns share tokens. After execution delegations will appear to the user."),(0,n.kt)("h3",{id:"msgtransfertokenizesharerecord"},(0,n.kt)("inlineCode",{parentName:"h3"},"MsgTransferTokenizeShareRecord")),(0,n.kt)("p",null,"The MsgTransferTokenizeShareRecord message is used to transfer the ownership of rewards generated from the tokenized amount of delegation. The tokenize share record is created when a user tokenize his/her delegation and deleted when the full amount of share tokens are redeemed."),(0,n.kt)("p",null,"This is designed to work with liquid staking designs that do not redeem the tokenized shares and may instead want to keep the shares tokenized."),(0,n.kt)("h3",{id:"msgexemptdelegation"},(0,n.kt)("inlineCode",{parentName:"h3"},"MsgExemptDelegation")),(0,n.kt)("p",null,"The MsgExemptDelegation message is used to exempt a delegation to a validator. If the exemption factor is greater than 0, this will allow more delegation shares to be issued from the validator."),(0,n.kt)("p",null,"This design allows the chain to force an amount of self-delegation by validators participating in liquid staking schemes."),(0,n.kt)("h2",{id:"consequences"},"Consequences"),(0,n.kt)("h3",{id:"backwards-compatibility"},"Backwards Compatibility"),(0,n.kt)("p",null,"By setting the exemption factor to zero, this module works like legacy staking. The only substantial change is the removal of min-self-bond and without any tokenized shares, there is no incentive to exempt delegation. "),(0,n.kt)("h3",{id:"positive"},"Positive"),(0,n.kt)("p",null,"This approach should enable integration with liquid staking providers and improved user experience. It provides a pathway to security under non-exponential issuance policies in the baseline staking module."))}c.isMDXComponent=!0}}]);