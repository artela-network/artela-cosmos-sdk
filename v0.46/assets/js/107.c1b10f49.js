(window.webpackJsonp=window.webpackJsonp||[]).push([[107],{630:function(e,a,t){"use strict";t.r(a);var s=t(1),r=Object(s.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"adr-046-module-params"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#adr-046-module-params"}},[e._v("#")]),e._v(" ADR 046: Module Params")]),e._v(" "),t("h2",{attrs:{id:"changelog"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#changelog"}},[e._v("#")]),e._v(" Changelog")]),e._v(" "),t("ul",[t("li",[e._v("Sep 22, 2021: Initial Draft")])]),e._v(" "),t("h2",{attrs:{id:"status"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#status"}},[e._v("#")]),e._v(" Status")]),e._v(" "),t("p",[e._v("Proposed")]),e._v(" "),t("h2",{attrs:{id:"abstract"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[e._v("#")]),e._v(" Abstract")]),e._v(" "),t("p",[e._v("This ADR describes an alternative approach to how Cosmos SDK modules use, interact,\nand store their respective parameters.")]),e._v(" "),t("h2",{attrs:{id:"context"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[e._v("#")]),e._v(" Context")]),e._v(" "),t("p",[e._v("Currently, in the Cosmos SDK, modules that require the use of parameters use the\n"),t("code",[e._v("x/params")]),e._v(" module. The "),t("code",[e._v("x/params")]),e._v(" works by having modules define parameters,\ntypically via a simple "),t("code",[e._v("Params")]),e._v(" structure, and registering that structure in\nthe "),t("code",[e._v("x/params")]),e._v(" module via a unique "),t("code",[e._v("Subspace")]),e._v(" that belongs to the respective\nregistering module. The registering module then has unique access to its respective\n"),t("code",[e._v("Subspace")]),e._v(". Through this "),t("code",[e._v("Subspace")]),e._v(", the module can get and set its "),t("code",[e._v("Params")]),e._v("\nstructure.")]),e._v(" "),t("p",[e._v("In addition, the Cosmos SDK's "),t("code",[e._v("x/gov")]),e._v(" module has direct support for changing\nparameters on-chain via a "),t("code",[e._v("ParamChangeProposal")]),e._v(" governance proposal type, where\nstakeholders can vote on suggested parameter changes.")]),e._v(" "),t("p",[e._v("There are various tradeoffs to using the "),t("code",[e._v("x/params")]),e._v(' module to manage individual\nmodule parameters. Namely, managing parameters essentially comes for "free" in\nthat developers only need to define the '),t("code",[e._v("Params")]),e._v(" struct, the "),t("code",[e._v("Subspace")]),e._v(", and the\nvarious auxiliary functions, e.g. "),t("code",[e._v("ParamSetPairs")]),e._v(", on the "),t("code",[e._v("Params")]),e._v(" type. However,\nthere are some notable drawbacks. These drawbacks include the fact that parameters\nare serialized in state via JSON which is extremely slow. In addition, parameter\nchanges via "),t("code",[e._v("ParamChangeProposal")]),e._v(" governance proposals have no way of reading from\nor writing to state. In other words, it is currently not possible to have any\nstate transitions in the application during an attempt to change param(s).")]),e._v(" "),t("h2",{attrs:{id:"decision"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#decision"}},[e._v("#")]),e._v(" Decision")]),e._v(" "),t("p",[e._v("We will build off of the alignment of "),t("code",[e._v("x/gov")]),e._v(" and "),t("code",[e._v("x/authz")]),e._v(" work per\n"),t("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/pull/9810",target:"_blank",rel:"noopener noreferrer"}},[e._v("#9810"),t("OutboundLink")],1),e._v(". Namely, module developers\nwill create one or more unique parameter data structures that must be serialized\nto state. The Param data structures must implement "),t("code",[e._v("sdk.Msg")]),e._v(" interface with respective\nProtobuf Msg service method which will validate and update the parameters with all\nnecessary changes. The "),t("code",[e._v("x/gov")]),e._v(" module via the work done in\n"),t("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/pull/9810",target:"_blank",rel:"noopener noreferrer"}},[e._v("#9810"),t("OutboundLink")],1),e._v(", will dispatch Param\nmessages, which will be handled by Protobuf Msg services.")]),e._v(" "),t("p",[e._v("Note, it is up to developers to decide how to structure their parameters and\nthe respective "),t("code",[e._v("sdk.Msg")]),e._v(" messages. Consider the parameters currently defined in\n"),t("code",[e._v("x/auth")]),e._v(" using the "),t("code",[e._v("x/params")]),e._v(" module for parameter management:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBQYXJhbXMgewogIHVpbnQ2NCBtYXhfbWVtb19jaGFyYWN0ZXJzICAgICAgID0gMTsKICB1aW50NjQgdHhfc2lnX2xpbWl0ICAgICAgICAgICAgICA9IDI7CiAgdWludDY0IHR4X3NpemVfY29zdF9wZXJfYnl0ZSAgICAgPSAzOwogIHVpbnQ2NCBzaWdfdmVyaWZ5X2Nvc3RfZWQyNTUxOSAgID0gNDsKICB1aW50NjQgc2lnX3ZlcmlmeV9jb3N0X3NlY3AyNTZrMSA9IDU7Cn0K"}}),e._v(" "),t("p",[e._v("Developers can choose to either create a unique data structure for every field in\n"),t("code",[e._v("Params")]),e._v(" or they can create a single "),t("code",[e._v("Params")]),e._v(" structure as outlined above in the\ncase of "),t("code",[e._v("x/auth")]),e._v(".")]),e._v(" "),t("p",[e._v("In the former, "),t("code",[e._v("x/params")]),e._v(", approach, a "),t("code",[e._v("sdk.Msg")]),e._v(" would need to be created for every single\nfield along with a handler. This can become burdensome if there are a lot of\nparameter fields. In the latter case, there is only a single data structure and\nthus only a single message handler, however, the message handler might have to be\nmore sophisticated in that it might need to understand what parameters are being\nchanged vs what parameters are untouched.")]),e._v(" "),t("p",[e._v("Params change proposals are made using the "),t("code",[e._v("x/gov")]),e._v(" module. Execution is done through\n"),t("code",[e._v("x/authz")]),e._v(" authorization to the root "),t("code",[e._v("x/gov")]),e._v(" module's account.")]),e._v(" "),t("p",[e._v("Continuing to use "),t("code",[e._v("x/auth")]),e._v(", we demonstrate a more complete example:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBQYXJhbXMgc3RydWN0IHsKCU1heE1lbW9DaGFyYWN0ZXJzICAgICAgdWludDY0CglUeFNpZ0xpbWl0ICAgICAgICAgICAgIHVpbnQ2NAoJVHhTaXplQ29zdFBlckJ5dGUgICAgICB1aW50NjQKCVNpZ1ZlcmlmeUNvc3RFRDI1NTE5ICAgdWludDY0CglTaWdWZXJpZnlDb3N0U2VjcDI1NmsxIHVpbnQ2NAp9Cgp0eXBlIE1zZ1VwZGF0ZVBhcmFtcyBzdHJ1Y3QgewoJTWF4TWVtb0NoYXJhY3RlcnMgICAgICB1aW50NjQKCVR4U2lnTGltaXQgICAgICAgICAgICAgdWludDY0CglUeFNpemVDb3N0UGVyQnl0ZSAgICAgIHVpbnQ2NAoJU2lnVmVyaWZ5Q29zdEVEMjU1MTkgICB1aW50NjQKCVNpZ1ZlcmlmeUNvc3RTZWNwMjU2azEgdWludDY0Cn0KCnR5cGUgTXNnVXBkYXRlUGFyYW1zUmVzcG9uc2Ugc3RydWN0IHt9CgpmdW5jIChtcyBtc2dTZXJ2ZXIpIFVwZGF0ZVBhcmFtcyhnb0N0eCBjb250ZXh0LkNvbnRleHQsIG1zZyAqdHlwZXMuTXNnVXBkYXRlUGFyYW1zKSAoKnR5cGVzLk1zZ1VwZGF0ZVBhcmFtc1Jlc3BvbnNlLCBlcnJvcikgewogIGN0eCA6PSBzZGsuVW53cmFwU0RLQ29udGV4dChnb0N0eCkKCiAgLy8gdmVyaWZpY2F0aW9uIGxvZ2ljLi4uCgogIC8vIHBlcnNpc3QgcGFyYW1zCiAgcGFyYW1zIDo9IFBhcmFtc0Zyb21Nc2cobXNnKQogIG1zLlNhdmVQYXJhbXMoY3R4LCBwYXJhbXMpCgogIHJldHVybiAmYW1wO3R5cGVzLk1zZ1VwZGF0ZVBhcmFtc1Jlc3BvbnNle30sIG5pbAp9CgpmdW5jIFBhcmFtc0Zyb21Nc2cobXNnICp0eXBlcy5Nc2dVcGRhdGVQYXJhbXMpIFBhcmFtcyB7CiAgLy8gLi4uCn0K"}}),e._v(" "),t("p",[e._v("A gRPC "),t("code",[e._v("Service")]),e._v(" query should also be provided, for example:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"c2VydmljZSBRdWVyeSB7CiAgLy8gLi4uCiAgCiAgcnBjIFBhcmFtcyhRdWVyeVBhcmFtc1JlcXVlc3QpIHJldHVybnMgKFF1ZXJ5UGFyYW1zUmVzcG9uc2UpIHsKICAgIG9wdGlvbiAoZ29vZ2xlLmFwaS5odHRwKS5nZXQgPSAmcXVvdDsvY29zbW9zLyZsdDttb2R1bGUmZ3Q7L3YxYmV0YTEvcGFyYW1zJnF1b3Q7OwogIH0KfQoKbWVzc2FnZSBRdWVyeVBhcmFtc1Jlc3BvbnNlIHsKICBQYXJhbXMgcGFyYW1zID0gMSBbKGdvZ29wcm90by5udWxsYWJsZSkgPSBmYWxzZV07Cn0K"}}),e._v(" "),t("h2",{attrs:{id:"consequences"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#consequences"}},[e._v("#")]),e._v(" Consequences")]),e._v(" "),t("p",[e._v("As a result of implementing the module parameter methodology, we gain the ability\nfor module parameter changes to be stateful and extensible to fit nearly every\napplication's use case. We will be able to emit events (and trigger hooks registered\nto that events using the work proposed in "),t("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/discussions/9656",target:"_blank",rel:"noopener noreferrer"}},[e._v("even hooks"),t("OutboundLink")],1),e._v("),\ncall other Msg service methods or perform migration.\nIn addition, there will be significant gains in performance when it comes to reading\nand writing parameters from and to state, especially if a specific set of parameters\nare read on a consistent basis.")]),e._v(" "),t("p",[e._v("However, this methodology will require developers to implement more types and\nMsg service metohds which can become burdensome if many parameters exist. In addition,\ndevelopers are required to implement persistance logics of module parameters.\nHowever, this should be trivial.")]),e._v(" "),t("h3",{attrs:{id:"backwards-compatibility"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility"}},[e._v("#")]),e._v(" Backwards Compatibility")]),e._v(" "),t("p",[e._v("The new method for working with module parameters is naturally not backwards\ncompatible with the existing "),t("code",[e._v("x/params")]),e._v(" module. However, the "),t("code",[e._v("x/params")]),e._v(" will\nremain in the Cosmos SDK and will be marked as deprecated with no additional\nfunctionality being added apart from potential bug fixes. Note, the "),t("code",[e._v("x/params")]),e._v("\nmodule may be removed entirely in a future release.")]),e._v(" "),t("h3",{attrs:{id:"positive"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#positive"}},[e._v("#")]),e._v(" Positive")]),e._v(" "),t("ul",[t("li",[e._v("Module parameters are serialized more efficiently")]),e._v(" "),t("li",[e._v("Modules are able to react on parameters changes and perform additional actions.")]),e._v(" "),t("li",[e._v("Special events can be emitted, allowing hooks to be triggered.")])]),e._v(" "),t("h3",{attrs:{id:"negative"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#negative"}},[e._v("#")]),e._v(" Negative")]),e._v(" "),t("ul",[t("li",[e._v("Module parameters becomes slightly more burdensome for module developers:\n"),t("ul",[t("li",[e._v("Modules are now responsible for persisting and retrieving parameter state")]),e._v(" "),t("li",[e._v("Modules are now required to have unique message handlers to handle parameter\nchanges per unique parameter data structure.")])])])]),e._v(" "),t("h3",{attrs:{id:"neutral"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#neutral"}},[e._v("#")]),e._v(" Neutral")]),e._v(" "),t("ul",[t("li",[e._v("Requires "),t("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/pull/9810",target:"_blank",rel:"noopener noreferrer"}},[e._v("#9810"),t("OutboundLink")],1),e._v(" to be reviewed\nand merged.")])]),e._v(" "),t("h2",{attrs:{id:"references"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),t("ul",[t("li",[e._v("https://github.com/cosmos/cosmos-sdk/pull/9810")]),e._v(" "),t("li",[e._v("https://github.com/cosmos/cosmos-sdk/issues/9438")]),e._v(" "),t("li",[e._v("https://github.com/cosmos/cosmos-sdk/discussions/9913")])])],1)}),[],!1,null,null,null);a.default=r.exports}}]);